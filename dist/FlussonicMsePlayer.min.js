!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FlussonicMsePlayer=t():e.FlussonicMsePlayer=t()}(window,function(){return n=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.enableLogs=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=n(19);function o(){}var i={trace:o,debug:o,log:o,warn:o,info:o,error:o},s=i;var a=(0,n.getSelfScope)();function u(i){var s=a.console[i];return s?function(){for(var e,t,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];r[0]&&(r[0]=(e=i,t=r[0],t="["+e+"] > "+t)),r&&s.apply(a.console,r)}:o}t.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":r(e))){!function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];n.forEach(function(e){s[e]=t[e]?t[e].bind(t):u(e)})}(e,"trace","debug","log","info","warn","error");try{s.log()}catch(e){s=i}}else s=i},t.logger=s},function(e,t,n){"use strict";e.exports=function(t,n,r,o){var i,s=self||window;try{try{try{i=new s.Blob([t])}catch(e){(i=new(s.BlobBuilder||s.WebKitBlobBuilder||s.MozBlobBuilder||s.MSBlobBuilder)).append(t),i=i.getBlob()}var e=s.URL||s.webkitURL,a=e.createObjectURL(i),u=new s[n](a,r);return e.revokeObjectURL(a),u}catch(e){return new s[n]("data:application/javascript,".concat(encodeURIComponent(t)),r)}}catch(e){if(!o)throw Error("Inline worker is not supported");return new s[n](o,r)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorMsg=t.replaceHttpByWS=t.checkVideoProgress=void 0,t.getMediaSource=r,t.isAndroid=o,t.isSupportedMSE=function(){if(o())return!1;var e=r(),t=window.SourceBuffer||window.WebKitSourceBuffer,e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.4d401f,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!e&&!!t},t.base64ToArrayBuffer=function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})},t.RawDataToUint8Array=function(e){return new Uint8Array(e)},t.getTrackId=i,t.getRealUtcFromData=s,t.doArrayBuffer=function(e){e.isInit||(this.utc=s(e.data),this.lastLoadedUTC=this.utc)},t.debugData=a,t.pad2=c,t.humanTime=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(!(0<e))return"";var n=e,r=new Date;r.setTime(1e3*n);e=!(!1===t),n=e?r.getHours():r.getUTCHours(),t=e?r.getMinutes():r.getUTCMinutes(),r=e?r.getSeconds():r.getUTCSeconds();return c(n)+":"+c(t)+":"+c(r)},t.logDM=function(e,t){t&&g.logger.log("%c "+t.type+" "+("event"===t.type?t.event:"mse_init_segment"),"background: aquamarine;",t)},t.showDispatchError=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";"data"in e&&e.data instanceof ArrayBuffer&&g.logger.error("Data:",a(e.data));g.logger.error(u(e),t),this.media&&"error"in this.media&&g.logger.error("MediaError:",this.media.error);++d>=this.opts.errorsBeforeStop&&(d=0,this.stopPromise=this.stop());this.onError&&this.onError(t,e)};var g=n(0);function r(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function o(){return-1!==navigator.userAgent.indexOf("Android")}function i(e){return e[47]}function s(e){return(e[92]<<24|e[93]<<16|e[94]<<8|e[95])+(e[96]<<24|e[97]<<16|e[98]<<8|e[99])/1e6}function a(e){e=new Uint8Array(e);return{trackId:e[47],utc:s(e),view:e}}t.checkVideoProgress=function(f,m){return function(){var e,t,n,r,o,i=f.currentTime,s=f.buffered,a=f.buffered.length;if(m)for(var u=m.sb.sourceBuffer,c=Object.keys(u),d=i-30,l=c.length-1;0<=l;l--){var h=c[l],p=u[h];!p||0<(h=p.buffered).length&&d>h.start(0)&&(function(e,t,n){try{for(var r=0;r<e.buffered.length;r++){var o=e.buffered.start(r),i=e.buffered.end(r),s=Math.max(o,t),a=Math.min(i,n);if(.5<Math.min(a,i)-s)return e.updating||e.remove(s,a)}}catch(e){g.logger.warn("removeBufferRange failed",e)}}(p,0,d),0,0)}m.media.readyState<=2&&2===m.media.networkState?m.onStartStalling():2<m.media.readyState&&m.onEndStalling(),a&&(e=s.end(a-1),t=Math.abs(e-i),m.playerStatsObject&&(m.playerStatsObject.bytes=m.sb.totalBytesCollected,m.playerStatsObject.updated_at=Date.now(),m.playing&&(!m.playbackSegmentStart||(o=m.playerStatsObject.application)&&(n=(r=m.media.getVideoPlaybackQuality()).corruptedVideoFrames,s=r.droppedVideoFrames,r=r.totalVideoFrames,o=o.live_duration,o+=m.playerStatsObject.updated_at-m.playbackSegmentStart,m.addPlayerStat("live_duration",!1,o),m.addPlayerStat("total_video_frames",!1,r),m.addPlayerStat("dropped_video_frames",!1,s),m.addPlayerStat("corrupted_video_frames",!1,n)),m.playbackSegmentStart=m.playerStatsObject.updated_at),m.addStat({updated_at:m.playerStatsObject.updated_at,bytes:m.sb.totalBytesCollected})),t<=m.opts.maxBufferDelay||(g.logger.log("nudge",i,"->",a?e:"-",i-e),f.currentTime=e-.2))}},t.replaceHttpByWS=function(e){return e.replace(/^http/,"ws")};var u=t.errorMsg=function(e){return"Error "+e.name+": "+e.message+"\n"+e.stack};function c(e){return e<=9?"0"+e:""+e}var d=0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VIDEO="video",t.AUDIO="audio"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_SOURCE_SOURCE_OPEN:"sourceopen",MEDIA_SOURCE_SOURCE_ENDED:"sourceended",MEDIA_SOURCE_SOURCE_CLOSE:"sourceclose",MEDIA_ELEMENT_PLAY:"play",MEDIA_ELEMENT_PAUSE:"pause",MEDIA_ELEMENT_PROGRESS:"progress",MEDIA_ELEMENT_EMPTIED:"emptied",MEDIA_ELEMENT_SUSPEND:"suspend",MEDIA_ELEMENT_STALLED:"stalled",MEDIA_ELEMENT_WAITING:"waiting",MEDIA_ELEMENT_RATECHANGE:"ratechange",MEDIA_ELEMENT_PLAYING:"playing",WS_OPEN:"open",WS_MESSAGE:"message",WS_ERROR:"error",WS_CLOSE:"close",BUFFER_UPDATE_END:"updateend",BUFFER_ERROR:"onerror",BUFFER_ABORT:"onabort"},e.exports=t.default},function(e,t,n){e.exports=n(6)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(7),n=(r=o)&&r.__esModule?r:{default:r};t.default=n.default,e.exports=t.default},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e};function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=m(o(8)),s=m(o(20)),u=m(o(21)),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(o(2)),d=o(0),l=o(22),h=o(3),p=m(o(4)),f=m(o(23));function m(e){return e&&e.__esModule?e:{default:e}}var g=h.VIDEO,y=h.AUDIO,n=(v.replaceHttpByWS=function(e){return c.replaceHttpByWS(e)},v.isSupported=function(){return c.isSupportedMSE()},n(v,null,[{key:"version",get:function(){return"22.7.1"}}]),v.prototype.play=function(e,t){var n=this;if(d.logger.log("[mse-player]: play()"),this.playing)d.logger.log("MSE is already playing");else{if(!this.ws||!this.ws.websocket||this._pause)return this._play(e,t).then(function(){n.playing=!0,n._stop=!1,n.pendingTracks&&(n.setTracks(n.pendingTracks),n.pendingTracks=void 0)}).catch(function(e){n.onPlayerError(e),d.logger.error("[mse-player]: got error on play",e),n.playing=!1});d.logger.log("[mse-player]: websocket already opened")}},v.prototype.stop=function(){var e=this;this.playPromise?(this.onEvent({key:Date.now(),data:{event:"play_stop"}}),this.playerStatsObject.closed_at=Date.now(),this.addStat({closed_at:this.playerStatsObject.closed_at}),this.opts.statsSendEnable&&(this.statsWorkerStarted=!1),this.playPromise.catch(function(){return e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),e._stop?void d.logger.log("[mse-player]: already stopped"):e.onMediaDetaching()}).finally(function(){return e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),e._stop?void d.logger.log("[mse-player]: already stopped"):e.onMediaDetaching()})):d.logger.log("[mse-player]: no playPromise exists, nothing to stop"),this.firstStart=!0,delete this.uuid},v.prototype.pause=function(){if(!function(){return!(!(!this._pause&&this.playing&&this.media&&this.ws&&this.mediaSource)||this.mediaSource&&"open"!==this.mediaSource.readyState||!this.playPromise)}.bind(this)())return d.logger.log("[mse:playback] can not do pause");var e=function(){if(this.ws.pause(),this.media.pause(),this._pause=!0,this.playing=!1,this.addPlayerStat("pause_count"),this.pauseStarted=Date.now(),this.onPause)try{this.onPause()}catch(e){d.logger.error("Error "+e.name+":"+e.message+"\n"+e.stack)}}.bind(this);this.playPromise.then(e,e).catch(e,e)},v.prototype.restart=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]?void 0:this.sb.lastLoadedUTC;this.playing=!1,this.ws.destroy(),this.ws.init(),this.ws.start(this.url,e,this.videoTrack,this.audioTrack),this.addPlayerStat("reconnect_count"),this.onEndStalling()},v.prototype.retryConnection=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.retry>=this.opts.connectionRetries?clearInterval(this.retryConnectionTimer):(d.logger.log("%cconnectionRetry:","background: orange;","Retrying "+(this.retry+1)),this.mediaSource=void 0,this.init(),this.ws.destroy(),this.sb.destroy(),this.play(t,n).then(function(){e.onEndStalling()}),this.retry=this.retry+1)},v.prototype.setTracks=function(e){var n,t,r,o,i=this,s=e;if(this.mediaInfo){if("lowest"===s)s=this.autoTrackSelection(!1);else if("highest"===s)s=this.autoTrackSelection(!0);else if(!Array.isArray(s))return void d.logger.error('tracks should be an Array instance: ["v1", "a1"]');this.playing?(n=this.mediaInfo.streams?"streams":"tracks",t=s.filter(function(t){var e=i.mediaInfo[n].find(function(e){return t===e.track_id});return!!e&&e.content===g}).join(""),(r=s.filter(function(t){var e=i.mediaInfo[n].find(function(e){return t===e.track_id});return e?!!e&&e.content===y:null}).join("")).length||t.length||(d.logger.warn("No such stream tracks! Setting to default parameters"),o=this.getVideoTracks(),(e=this.getAudioTracks()).length?r=e[0].track_id:d.logger.warn("No audio tracks"),o.length?t=o[0].track_id:d.logger.warn("No video tracks")),r.length||(this.sb.sourceBuffer.audio&&this.sb.removeSourceBuffer(),this.media.muted=!0,d.logger.warn("No audio tracks")),t.length&&r.length&&this.mediaSource.sourceBuffers.length<=1&&(this.stop(),this.media.muted=!1,this.play()),this.onStartStalling(),this.ws.setTracks(t,r),this.addPlayerStat("bitrate_change_count"),this.videoTrack=t,this.audioTrack=r,this._setTracksFlag=!0,this.waitForInitFrame=!0):this.pendingTracks=s}else d.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},v.prototype.autoTrackSelection=function(e){if(this.mediaInfo){var t,n,r,o,i,s=this.getVideoTracks(),a=this.getAudioTracks(),u=void 0,c=void 0;e?(n=t=void 0,s[0].bitrate?n="bitrate":s[0].pixel_width&&(n="pixel_width"),t=s[0][n],u=s[0].track_id,s.forEach(function(e){e[n]>t&&(t=e[n],u=e.track_id)}),a.length&&(c=a[0].track_id,a.forEach(function(e){e.sample_rate>t&&(c=e.track_id)}))):(o=r=void 0,s[0].bitrate?o="bitrate":s[0].pixel_width&&(o="pixel_width"),r=s[0][o],u=s[0].track_id,s.forEach(function(e){e[o]<r&&(r=e[o],u=e.track_id)}),a.length&&(i=void 0,i=a[0].sample_rate,c=a[0].track_id,a.forEach(function(e){e.sample_rate<i&&(i=e.sample_rate,c=e.track_id)})));a=[];return u&&u.length&&a.push(u),c&&c.length&&a.push(c),a}d.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},v.prototype._play=function(r,o){var i=this;return this.liveError=!1,new Promise(function(e,t){if(d.logger.log("_play",r,o),i.playing){var n="[mse-player] _play: terminate because already has been playing";return d.logger.log(n),e({message:n})}if(i._pause)return i.ws&&!1===i.ws.opened?(d.logger.log("WebSocket Closed, trying to restart it"),i._pause=!1,void i.restart(!0)):(d.logger.log("WebSocket is in opened state, resuming"),i._pause=!1,i._resume(),!i.pauseStarted||(n=i.playerStatsObject.application)&&(n=n.pause_duration,n+=Date.now()-i.pauseStarted,i.addPlayerStat("pause_duration",!1,n),delete i.pauseStarted),i.playPromise=i.media.play(),d.logger.log("_play: terminate because _paused and should resume"),i.playPromise);if(i.resetStats(),i.playerStatsObject.opened_at=Date.now(),i.uuid=i.generateUUID(),i.addStat({opened_at:i.playerStatsObject.opened_at,id:i.uuid}),i.videoTrack=r,i.audioTrack=o,i._pause=!1,i.mediaSource||i.onAttachMedia({media:i.media}).then(function(){i.onsoa=i._play.bind(i,r,o),i.sb.setMediaSource(i.mediaSource),i.mediaSource.addEventListener(p.default.MEDIA_SOURCE_SOURCE_OPEN,i.onsoa),d.logger.warn("mediaSource did not create"),i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t}),i.mediaSource&&"open"!==i.mediaSource.readyState)return d.logger.warn('readyState is not "open", it\'s currently ',i.mediaSource.readyState),i.shouldPlay=!0,i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,void(i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t);new Promise(function(e,t){return!i.media.autoplay||!0===i.media.muted||i.opts.retryMuted?e():!i.onAutoplay||function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod","Safari"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?(i.media.muted=!0,e()):(i.onAutoplay(function(){return i.media.muted=!1,e()}),void t())}).then(function(){i.ws.start(i.url,i.playTime,i.videoTrack,i.audioTrack).then(function(){return i.playPromise=i.media.play(),i.playPromise.then(function(){i.onStartStalling(),i.startProgressTimer(),i.resolveThenMediaSourceOpen&&(i._stop=!1,i.resolveThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0,clearInterval(i.retryConnectionTimer),i.retry=0),i.onEvent({key:Date.now(),data:{event:"play_started"}})}).catch(function(e){d.logger.log("playPromise rejection.",e),i.ws.connectionPromise&&i.ws.connectionPromise.then(function(){return i.ws.destroy()}),i.opts.retryMuted&&0==i.media.muted&&(i.onMuted&&i.onMuted(),i.media.muted=!0,i._play(r,o)),i.onPlayerError({error:"play_promise_reject",err:e}),i.rejectThenMediaSourceOpen&&(i.rejectThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0),i.opts.retryMuted||i.stop(),!i.opts.onCrashTryVideoOnly||(e=i.mediaInfo.activeStreams.video)&&i._play(e)}),i.playPromise})})})},v.prototype.init=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._pause=!1,this.playing=!1,this.shouldPlay=!1,this.audioTrack="",this.videoTrack="",this.endProgressTimer(),e||this.onEvent({key:Date.now(),data:{event:"play_init",userInfo:window.navigator.userAgent,playerInfo:"MSEPlayer"+(v.version?"@"+v.version:"")}})},v.prototype._resume=function(){this.ws.resume(),this.onEvent({key:Date.now(),data:{event:"play_websocket_resume"}})},v.prototype.onMediaDetaching=function(){var e=this;if(this.stopRunning)d.logger.warn("stop is running.");else{if(this.stopRunning=!0,this.handlerMediaDetaching.bind(this),!this.playPromise)return this.handlerMediaDetaching();this.playPromise.catch(function(){return e.handlerMediaDetaching()}).finally(function(){return e.handlerMediaDetaching()})}},v.prototype.handlerMediaDetaching=function(){var n=this;return d.logger.info("media source detaching"),new Promise(function(e,t){if(n.removeMediaSource(),!n.media)return t("no media to detach");n.removeListeners(),n.oncvp=null,n.mediaSource=null,n.init(!0),n.ws.destroy(),n.sb.destroy(),n.media.onemptied=function(){return d.logger.log("[mse-player]: media emptied"),n.stopRunning=!1,n._stop=!0,delete n.playPromise,e()}})},v.prototype.removeMediaSource=function(){var e=this,t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(e){d.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}t.removeEventListener(p.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),t.removeEventListener(p.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),t.removeEventListener(p.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),this.onmso=null,this.onmse=null,this.onmsc=null}function n(){e.media.src="",e.media.load(),e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0)}this.playPromise&&this.playPromise.then(function(){n()}).catch(function(){n()})},v.prototype.onMediaElementEmptied=function(e){return this.onMediaElementEmptied&&this.media&&(this.media.removeEventListener(p.default.MEDIA_ELEMENT_EMPTIED,this.onMediaElementEmptied),this._onmee=void 0),e},v.prototype.onAttachMedia=function(e){var t=this;this.media=e.media;e=this.media;if(!(e instanceof HTMLMediaElement))throw new Error(f.default.NOT_HTML_MEDIA_ELEMENT);if(e){var n=this.mediaSource=new MediaSource;if(this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener(p.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),n.addEventListener(p.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),e.src=URL.createObjectURL(n),this.eventLog=function(e){t.onEvent&&t.onEvent(e)},this.addListeners(),!this.liveError)return new Promise(function(e){t.onmso=t.onMediaSourceOpen.bind(t,e),n.addEventListener(p.default.MEDIA_SOURCE_SOURCE_OPEN,t.onmso)});this.player=void 0}},v.prototype.onMediaSourceOpen=function(e){e();e=this.mediaSource;e&&e.removeEventListener(p.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),URL.revokeObjectURL(this.media.src),this.shouldPlay&&(this.shouldPlay=!1,d.logger.info("readyState now is "+this.mediaSource.readyState+", and will be played",this.audioTrack,this.videoTrack),this._play(this.audioTrack,this.videoTrack))},v.prototype.onDisconnect=function(e){this.onEvent({key:Date.now(),data:{event:"play_diconnected"}}),this.opts.onDisconnect&&this.opts.onDisconnect(e)},v.prototype.dispatchMessage=function(e){var t=this;if(!this.stopRunning){this.playerStatsObject.first_byte_at||(this.playerStatsObject.first_byte_at=Date.now(),this.addStat({first_byte_at:this.playerStatsObject.first_byte_at}));var n,r=e.rawData,o=e.parsedData,e=e.isDataAB;try{if(e){if(this.waitForInitFrame)return d.logger.log("old frames");this.sb.procArrayBuffer(r)}if(o&&o.type===l.EVENT_SEGMENT){var i=o[l.EVENT_SEGMENT];switch(d.logger.log("%c "+o.type+" "+("event"===o.type?o.event:"mse_init_segment"),"background: aquamarine;",o),i){case"resumed":this._pause&&!this.playing&&this.onStartStalling(),this.onResume&&this.onResume();break;case"paused":break;case"seeked":case"switched_to_live":if(this.seekValue=void 0,this.opts.onSeeked)try{this.opts.onSeeked()}catch(e){d.logger.error(e)}break;case"recordings_ended":this._eos=!0,this.sb.onBufferEos();break;case"stream_unavailable":"static"in o&&0==o.static?(d.logger.info("Stream is on on demand mode, waiting for init segment"),this.onStartStalling()):(d.logger.warn("do playPromise reject with error"),this.ws.connectionPromise&&this.ws.connectionPromise.then(function(){return t.ws.pause()}),this.liveError||(this.onPlayerError({error:"playPromise reject - stream unavaible"}),this.liveError=!0),this.rejectThenMediaSourceOpen&&(this.rejectThenMediaSourceOpen(),this.resolveThenMediaSourceOpen=void 0,this.rejectThenMediaSourceOpen=void 0),this.playPromise=Promise.reject("stream unavaible"),this.mediaSource.endOfStream());break;case"tracks_switched":break;default:this.opts.onEvent&&this.opts.onEvent({error:"unhandled_event",event:i}),d.logger.warn("unknown type of event",i)}return}if(o&&o.type===l.MSE_INIT_SEGMENT)return this.procInitSegment(r)}catch(e){c.showDispatchError.bind(this)(e);try{this.media.error?(this.onPlayerError({error:"Media error",mediaError:this.media.error}),this.stop()):this.mediaInfo&&this.mediaInfo.activeStreams&&(n=this.mediaInfo.activeStreams,this.setTracks([n.video||"",n.audio||""]))}catch(e){this.ws.pause()}}}},v.prototype.procInitSegment=function(e){var n=this,t=JSON.parse(e);if(t.type!==l.MSE_INIT_SEGMENT)return d.logger.warn("type is not "+l.MSE_INIT_SEGMENT);this.waitForInitFrame&&(this.waitForInitFrame=!1),this.resetTimer&&(clearTimeout(this.resetTimer),this.resetTimer=void 0),this.sb.isBuffered()&&(this.sb.doFlush(),this.sb.seek()),this.sb.setTracksByType(t);var r=a({},t.metadata,{tracks:t.metadata.streams||t.metadata.tracks,streams:t.metadata.streams||t.metadata.tracks}),o=t.metadata.streams;t.metadata.tracks&&(o=t.metadata.tracks);var i={},e=this.sb.videoTrackId&&this.sb.videoTrackId.id-1;if(o[e]&&o[e].track_id){if(o[e].bitrate&&0===o[e].bitrate||0===o[e].height||0===o[e].width)return void this.onPlayerError({error:"Video track error"});i.video=o[e].track_id}var s,e=this.sb.audioTrackId&&this.sb.audioTrackId.id-1;e&&o[e]&&o[e].track_id&&(o[e].bitrate&&0===o[e].bitrate?(this.onPlayerError({error:"Audio track error"}),s=void 0,t.tracks.forEach(function(e,t){e.id===n.sb.audioTrackId.id&&(s=t)}),t.tracks.splice(s,1),this.sb.sourceBuffer.audio&&(this.mediaSource.removeSourceBuffer(this.sb.sourceBuffer.audio),delete this.sb.sourceBuffer.audio)):i.audio=o[e].track_id);r=a({},r,{activeStreams:i,version:v.version});if(this.playerStatsObject.source_id=t.session_id,this.addStat({source_id:this.playerStatsObject.source_id}),this.doMediaInfo(r),d.logger.log("%cprocInitSegment:","background: lightpink;",t),this.onEvent({key:Date.now(),data:a({event:"play_metadata"},r)}),this.mediaSource&&!this.mediaSource.sourceBuffers.length&&(this.sb.setMediaSource(this.mediaSource),this.sb.createSourceBuffers(t)),this.liveError||this.sb.createTracks(t.tracks),this.opts.videoQuality&&this.firstStart){t=void 0;if("lowest"===this.opts.videoQuality?t=this.autoTrackSelection(!1):"highest"===this.opts.videoQuality&&(t=this.autoTrackSelection(!0)),t[0]!==i.video||i.audio&&t[1]!==i.audio)return void this.ws.setTracks(t[0]||"",t[1]||"");this.firstStart=!1}this.opts.preferHQ&&d.logger.info("[MSE]: preferHQ option is depricated. Use videoQuality(lowest/highest) instead"),this.ws.resume()},v.prototype.doMediaInfo=function(e){if(d.logger.log("%cmediaInfo:","background: orange;",e),this.mediaInfo=e,this.onMediaInfo)try{this.onMediaInfo(e)}catch(e){d.logger.error(c.errorMsg(e))}},v.prototype.getVideoTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===g})}},v.prototype.getAudioTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===y})}},v.prototype.immediateLevelSwitchEnd=function(){var e=this,t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,this.previouslyPaused||(this.playPromise=t.play(),this.playPromise.then(function(){e._pause=!1,e.playing=!0})))},v.prototype.onStartStalling=function(){var e=this;this._pause||(this.resetTimer||(this.resetTimer=setTimeout(function(){e.restart()},6e4)),this._stalling||(this.opts.onStartStalling&&this.opts.onStartStalling(),this._stalling=!0,d.logger.log("onStartStalling"),this.playerStatsObject.started_at&&(this.addPlayerStat("stall_count"),this.startStallingTime=Date.now()),this.onEvent({key:Date.now(),data:{event:"play_stalled"}})))},v.prototype.onEndStalling=function(){var e;this._stalling&&(this.opts.onEndStalling&&this.opts.onEndStalling(),this._stalling=!1,d.logger.log("onEndStalling"),clearTimeout(this.resetTimer),this.resetTimer=void 0,!this.startStallingTime||(e=this.playerStatsObject.application)&&(e=e.stall_duration,e+=Date.now()-this.startStallingTime,this.startStallingTime=null,this.addPlayerStat("stall_duration",!1,e)),this.onEvent({key:Date.now(),data:{event:"play_resumed"}}))},v.prototype.startProgressTimer=function(){this.timer=setInterval(this.onTimer.bind(this),this.opts.progressUpdateTime)},v.prototype.endProgressTimer=function(){clearInterval(this.timer),this.timer=void 0},v.prototype.onTimer=function(){if(this._eos)return d.logger.log("nothing to play");if(this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.sb.lastLoadedUTC!==this.utcPrev&&!this._stalling&&(this.utcPrev=this.sb.lastLoadedUTC,this.onProgress))try{this.onProgress(this.sb.lastLoadedUTC)}catch(e){d.logger.error(c.errorMsg(e))}},v.prototype.onMediaSourceEnded=function(){d.logger.log("media source ended");try{this.opts.onEOS&&this.opts.onEOS()}catch(e){d.logger.error("error while proccessing onEOS")}},v.prototype.onMediaSourceClose=function(){d.logger.log("media source closed")},v.prototype.onConnectionRetry=function(){var e=this;this.retryConnectionTimer||this._stop?this.retry>=this.opts.connectionRetries&&clearInterval(this.retryConnectionTimer):this.retry<this.opts.connectionRetries&&(this.retryConnectionTimer=setInterval(function(){return e.retryConnection()},5e3))},v.prototype.loadingIndication=function(e){e=e.type;"playing"===e?(this.playing=!0,this.onEndStalling(),this.playerStatsObject.started_at||(this.playerStatsObject.started_at=Date.now(),this.addStat({started_at:this.playerStatsObject.started_at}))):"waiting"===e&&(this.playing=!1,this.onStartStalling())},v.prototype.onEvent=function(e){this.onEventCallback&&this.onEventCallback(e)},v.prototype.onPlayerError=function(e){this.playerStatsObject&&this.addPlayerStat("error_count"),this.onError&&this.onError(e)},v.prototype.addListeners=function(){this.media&&(this.oncvp=c.checkVideoProgress(this.media,this).bind(this),this.media.addEventListener(p.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),this.media.addEventListener(p.default.MEDIA_ELEMENT_PLAYING,this.loadingIndication.bind(this)),this.media.addEventListener(p.default.MEDIA_ELEMENT_WAITING,this.loadingIndication.bind(this)))},v.prototype.removeListeners=function(){this.media&&(this.media.removeEventListener(p.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),this.media.removeEventListener(p.default.MEDIA_ELEMENT_PLAYING,this.loadingIndication),this.media.removeEventListener(p.default.MEDIA_ELEMENT_WAITING,this.loadingIndication))},v.prototype.generateUUID=function(){var n=(new Date).getTime(),r="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random();return 0<n?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(r+t)%16|0,r=Math.floor(r/16)),("x"===e?t:3&t|8).toString(16)})},v.prototype.addPlayerStat=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=this.playerStatsObject.application;r&&(n?r[e]=Math.round(n):t&&r[e]++,this.playerStatsObject.application=r,this.addStat({application:r}))},v.prototype.addStat=function(e){this.statsWorker&&this.statsWorker.postMessage({command:"add",commandObj:e})},v.prototype.getStats=function(){return a({},this.playerStatsObject,{id:this.uuid})},v.prototype.onStatsWorkerMessage=function(){var e;this.playerStatsObject.started_at&&this.opts.statsSendEnable&&(e=(this.playerStatsObject&&this.playerStatsObject.source_id||{}).source_id,e=this.url.replace(/sessions/,"sessions/"+(e?""+e:"")),fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",body:JSON.stringify(this.getStats())}))},v);function v(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),r.debug&&((0,d.enableLogs)(!0),window.humanTime=c.humanTime),d.logger.info("[mse-player]:",v.version),this.opts=r||{},this.media=e,this.url=t,this.firstStart=!0,this.opts.progressUpdateTime=this.opts.progressUpdateTime||500,this.opts.errorsBeforeStop=this.opts.errorsBeforeStop||1,"number"!=typeof this.opts.errorsBeforeStop||isNaN(this.opts.errorsBeforeStop))throw new Error("invalid errorsBeforeStop param, should be number");if(this.opts.connectionRetries=this.opts.connectionRetries||0,"number"!=typeof this.opts.connectionRetries||isNaN(this.opts.connectionRetries))throw new Error("invalid connectionRetries param, should be number");if(this.opts.wsReconnect=this.opts.wsReconnect||!1,"boolean"!=typeof this.opts.wsReconnect)throw new Error("invalid wsReconnect param, should be boolean");if(this.opts.preferHQ=this.opts.preferHQ||!1,"boolean"!=typeof this.opts.preferHQ)throw new Error("invalid preferHQ param, should be boolean");if(this.opts.onCrashTryVideoOnly=this.opts.onCrashTryVideoOnly||!0,"boolean"!=typeof this.opts.onCrashTryVideoOnly)throw new Error("invalid onCrashTryVideoOnly param, should be boolean");if(this.retry=0,this.retryConnectionTimer,this.opts.retryMuted=this.opts.retryMuted||!1,"boolean"!=typeof this.opts.retryMuted)throw new Error("invalid retryMuted param, should be boolean");this.opts.maxBufferDelay=this.opts.maxBufferDelay||2;t=navigator.userAgent;if((/Edge/.test(t)||/trident.*rv:1\d/i.test(t))&&(this.opts.maxBufferDelay=10),"number"!=typeof this.opts.maxBufferDelay)throw new Error("invalid maxBufferDelay param, should be number");if(this.opts.videoQuality){if("string"!=typeof this.opts.videoQuality)throw new Error("invalid videoQuality param, should be string");if("highest"!==this.opts.videoQuality&&"lowest"!==this.opts.videoQuality)throw new Error("invalid videoQuality param, should be highest or lowest")}try{this.Sentry=o(!function(){var e=new Error("Cannot find module '@sentry/browser'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){this.noSentry=!0}if(this.opts.sentryConfig=this.opts.sentryConfig||"","string"!=typeof this.opts.sentryConfig)throw new Error("invalid sentryConfig param, should be string");if(this.opts.sentryConfig.length&&!this.noSentry&&(this.Sentry.init({dsn:this.opts.sentryConfig,environment:"production",release:"Mse Player@"+v.version}),document.onerror=function(e){n.Sentry.captureException(e)}),this.opts.statsSendEnable=this.opts.statsSendEnable||!0,"number"!=typeof this.opts.maxBufferDelay)throw new Error("invalid maxBufferDelay param, should be number");if(window.Worker){if(this.statsWorker=new u.default,this.statsWorker.onmessage=this.onStatsWorkerMessage.bind(this),this.opts.statsSendTime){if("number"!=typeof this.opts.statsSendTime)throw new Error("invalid statsSendTime param, should be number");this.statsWorker.postMessage({command:"time",commandObj:1e3*this.opts.statsSendTime})}this.statsWorker.postMessage({command:"start",commandObj:this.url}),this.statsWorkerStarted=!0}this.resetStats=function(){n.playerStatsObject={proto:"mseld",user_agent:navigator.userAgent,bytes:0,application:{application_name:"mseld_player",application_version:v.version,stall_count:0,pause_count:0,error_count:0,reconnect_count:0,bitrate_change_count:0,live_duration:0,stall_duration:0,pause_duration:0,total_video_frames:0,dropped_video_frames:0,corrupted_video_frames:0}},n.addStat(n.playerStatsObject),n.statsWorkerStarted||(n.statsWorker.postMessage({command:"start",commandObj:n.url}),n.statsWorkerStarted=!0)},this.onProgress=r&&r.onProgress,r&&r.onDisconnect?this.onDisconnect=r&&r.onDisconnect:this.onDisconnect=function(e){d.logger.log("[websocket status]:",e)},this.onMediaInfo=r&&r.onMediaInfo,this.onError=r&&r.onError,this.onEventCallback=r&&r.onEvent,this.onAutoplay=r&&r.onAutoplay,this.onMuted=r&&r.onMuted,this.onStats=r&&r.onStats,this.onMessage=r&&r.onMessage,this.onPause=r&&r.onPause,this.onResume=r&&r.onResume,e instanceof HTMLMediaElement&&(e.WebKitPlaysInline=!0,e.controls=!1),this.ws=new i.default({message:this.dispatchMessage.bind(this),closed:this.onDisconnect.bind(this),error:this.onError,wsReconnect:this.opts.wsReconnect}),this.sb=new s.default({media:e}),this.messageTime=Date.now(),this.init()}t.default=n,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWSURL=u;var c=o(n(9)),r=o(n(18)),d=n(0);function o(e){return e&&e.__esModule?e:{default:e}}var l="live",n=(i.prototype.init=function(){this.wsWorker&&delete this.wsWorker,this.opened=!1,this.connectionPromise=void 0,clearTimeout(this.reconnect),this.reconnect=void 0,window.Worker&&(this.wsWorker=new r.default,this.wsWorker.onmessage=this.onWorkerMessage.bind(this))},i.prototype.onWorkerMessage=function(e){var t=e.data;switch(t.command){case"connect":this.open();break;case"close":this.onWSClose(t);break;case"error":this.handleError(t);break;default:this.handleReceiveMessage(t)}},i.prototype.start=function(r,o){var i=this,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";return this.connectionPromise=new Promise(function(e,t){i.socketURL={url:r,time:o,videoTrack:s,audioTack:a};var n=u(r,0,s,a);i.wsWorker.postMessage({command:"start",commandObj:n}),i._openingResolve=e,i._openingReject=t}),this.connectionPromise},i.prototype.open=function(){this.opened||(this.opened=!0,this.paused=!0,this._openingResolve())},i.prototype.send=function(e){this.wsWorker.postMessage({command:"send",commandObj:e})},i.prototype.resume=function(){clearTimeout(this.reconnect),d.logger.log("ws: send resume"),this.send("resume"),this.paused=!1},i.prototype.pause=function(){d.logger.log("ws: send pause"),this.send("pause"),this.paused=!0},i.prototype.seek=function(e){var t=e===l?"":"play_from=";d.logger.log(t+e),this.send(t+e)},i.prototype.setTracks=function(e){this.send("set_tracks="+e+(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null))},i.prototype.sendStats=function(e){e=JSON.stringify(e);this.send(e)},i.prototype.handleReceiveMessage=function(e){this.opts.message(e)},i.prototype.handleError=function(){var e;this.opts.error&&(e=this.opts).error.apply(e,arguments)},i.prototype.onWSClose=function(e){var t,n,r,o,i=this;d.logger.log("WebSocket lost connection with code ",e.code+" and reason: "+e.reason),this.opts.error&&this.opts.error({error:"WebSocket lost connection",err:"WebSocket lost connection with code "+e.code+" and reason: "+e.reason,code:e.code}),this.opts.wsReconnect&&(e.wasClean&&1e3!==e.code&&1006!==e.code?(d.logger.log("Clean websocket stop"),this.destroy()):(t=this.socketURL,n=t.url,r=t.videoTrack,o=t.audioTack,this.reconnect=setTimeout(function(){i.start(n,r,o).then(function(){clearTimeout(i.reconnect)}).catch(function(){i.destroy()})},5e3))),this.opts.closed&&this.opts.closed(e)},i.prototype.destroy=function(){this.wsWorker.postMessage({command:"disconnect"}),clearTimeout(this.reconnect),this.reconnect=void 0,this.init()},i);function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.opts=e,this.init(),this.onwso=this.open.bind(this),this.onwsm=this.handleReceiveMessage.bind(this),this.onwse=this.handleError.bind(this),this.onwsc=this.onWSClose.bind(this)}function u(e,t,n,r){var o=t=l;if(!o&&!n&&!r)return e;var i=(0,c.default)({url:e}),s="";i.query&&(s=i.query.split("&").map(function(e){return e.split("=")}).filter(function(e){return"from"!==e[0]&&"tracks"!==e[0]}).map(function(e){return e.join("=")}).join("&"),d.logger.log(s));var a=i.protocol+"//"+i.host+i.pathname+"?",u=!!n||!!r,e=u&&o&&o!==l?"&":"",i=t===l?"":"from="+Math.floor(o);return a+(u?"tracks="+n+r:"")+e+(i=!t?"":i)+((u||o&&o!==l)&&s?"&":"")+s}t.default=n},function(e,t,n){"use strict";
/*!
 * parseurl
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var n=n(10),s=n.parse,a=n.Url;function r(e){var t=e.url;if(void 0!==t){var n=e._parsedUrl;return i(t,n)?n:((n=o(t))._raw=t,e._parsedUrl=n)}}function o(e){if("string"!=typeof e||47!==e.charCodeAt(0))return s(e);for(var t=e,n=null,r=null,o=1;o<e.length;o++)switch(e.charCodeAt(o)){case 63:null===r&&(t=e.substring(0,o),n=e.substring(o+1),r=e.substring(o));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return s(e)}var i=void 0!==a?new a:{};return i.path=e,i.href=e,i.pathname=t,null!==r&&(i.query=n,i.search=r),i}function i(e,t){return"object"==typeof t&&null!==t&&(void 0===a||t instanceof a)&&t._raw===e}e.exports=r,e.exports.original=function(e){var t=e.originalUrl;if("string"!=typeof t)return r(e);var n=e._parsedOriginalUrl;if(i(t,n))return n;return(n=o(t))._raw=t,e._parsedOriginalUrl=n}},function(e,t,n){"use strict";var M=n(11),O=n(14);function S(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=o,t.resolve=function(e,t){return o(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?o(e,!1,!0).resolveObject(t):t},t.format=function(e){O.isString(e)&&(e=o(e));return e instanceof S?e.format():S.prototype.format.call(e)},t.Url=S;var j=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,I=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,t=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),P=["'"].concat(t),x=["%","/","?",";","#"].concat(P),A=["/","?","#"],D=/^[+a-z0-9A-Z_-]{0,63}$/,B=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,U={javascript:!0,"javascript:":!0},C={javascript:!0,"javascript:":!0},R={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},L=n(15);function o(e,t,n){if(e&&O.isObject(e)&&e instanceof S)return e;var r=new S;return r.parse(e,t,n),r}S.prototype.parse=function(e,t,n){if(!O.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),o=-1!==r&&r<e.indexOf("#")?"?":"#",r=e.split(o);r[0]=r[0].replace(/\\/g,"/");var i=(i=e=r.join(o)).trim();if(!n&&1===e.split("#").length){var s=I.exec(i);if(s)return this.path=i,this.href=i,this.pathname=s[1],s[2]?(this.search=s[2],this.query=t?L.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var a,s=j.exec(i);if(s&&(T=(s=s[0]).toLowerCase(),this.protocol=T,i=i.substr(s.length)),(n||s||i.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(a="//"===i.substr(0,2))||s&&C[s]||(i=i.substr(2),this.slashes=!0)),!C[s]&&(a||s&&!R[s])){for(var u=-1,c=0;c<A.length;c++)-1!==(d=i.indexOf(A[c]))&&(-1===u||d<u)&&(u=d);-1!==(S=-1===u?i.lastIndexOf("@"):i.lastIndexOf("@",u))&&(E=i.slice(0,S),i=i.slice(S+1),this.auth=decodeURIComponent(E));for(var d,u=-1,c=0;c<x.length;c++)-1!==(d=i.indexOf(x[c]))&&(-1===u||d<u)&&(u=d);-1===u&&(u=i.length),this.host=i.slice(0,u),i=i.slice(u),this.parseHost(),this.hostname=this.hostname||"";var l="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!l)for(var h=this.hostname.split(/\./),c=0,p=h.length;c<p;c++){var f=h[c];if(f&&!f.match(D)){for(var m="",g=0,y=f.length;g<y;g++)127<f.charCodeAt(g)?m+="x":m+=f[g];if(!m.match(D)){var v=h.slice(0,c),_=h.slice(c+1),b=f.match(B);b&&(v.push(b[1]),_.unshift(b[2])),_.length&&(i="/"+_.join(".")+i),this.hostname=v.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),l||(this.hostname=M.toASCII(this.hostname));var S=this.port?":"+this.port:"",E=this.hostname||"";this.host=E+S,this.href+=this.host,l&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!U[T])for(c=0,p=P.length;c<p;c++){var w,k=P[c];-1!==i.indexOf(k)&&((w=encodeURIComponent(k))===k&&(w=escape(k)),i=i.split(k).join(w))}l=i.indexOf("#");-1!==l&&(this.hash=i.substr(l),i=i.slice(0,l));var T,l=i.indexOf("?");return-1!==l?(this.search=i.substr(l),this.query=i.substr(l+1),t&&(this.query=L.parse(this.query)),i=i.slice(0,l)):t&&(this.search="",this.query={}),i&&(this.pathname=i),R[T]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(S=this.pathname||"",T=this.search||"",this.path=S+T),this.href=this.format(),this},S.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&O.isObject(this.query)&&Object.keys(this.query).length&&(i=L.stringify(this.query));i=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||R[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o=o||"",r&&"#"!==r.charAt(0)&&(r="#"+r),i&&"?"!==i.charAt(0)&&(i="?"+i),t+o+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(i=i.replace("#","%23"))+r},S.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},S.prototype.resolveObject=function(e){O.isString(e)&&((p=new S).parse(e,!1,!0),e=p);for(var t=new S,n=Object.keys(this),r=0;r<n.length;r++){var o=n[r];t[o]=this[o]}if(t.hash=e.hash,""===e.href)return t.href=t.format(),t;if(e.slashes&&!e.protocol){for(var i=Object.keys(e),s=0;s<i.length;s++){var a=i[s];"protocol"!==a&&(t[a]=e[a])}return R[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(e.protocol&&e.protocol!==t.protocol){if(!R[e.protocol]){for(var u=Object.keys(e),c=0;c<u.length;c++){var d=u[c];t[d]=e[d]}return t.href=t.format(),t}if(t.protocol=e.protocol,e.host||C[e.protocol])t.pathname=e.pathname;else{for(var l=(e.pathname||"").split("/");l.length&&!(e.host=l.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==l[0]&&l.unshift(""),l.length<2&&l.unshift(""),t.pathname=l.join("/")}return t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(f=t.pathname||"",m=t.search||"",t.path=f+m),t.slashes=t.slashes||e.slashes,t.href=t.format(),t}var h=t.pathname&&"/"===t.pathname.charAt(0),p=e.host||e.pathname&&"/"===e.pathname.charAt(0),f=p||h||t.host&&e.pathname,m=f,g=t.pathname&&t.pathname.split("/")||[],l=e.pathname&&e.pathname.split("/")||[],h=t.protocol&&!R[t.protocol];if(h&&(t.hostname="",t.port=null,t.host&&(""===g[0]?g[0]=t.host:g.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===l[0]?l[0]=e.host:l.unshift(e.host)),e.host=null),f=f&&(""===l[0]||""===g[0])),p)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,g=l;else if(l.length)(g=g||[]).pop(),g=g.concat(l),t.search=e.search,t.query=e.query;else if(!O.isNullOrUndefined(e.search))return h&&(t.hostname=t.host=g.shift(),(b=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=b.shift(),t.host=t.hostname=b.shift())),t.search=e.search,t.query=e.query,O.isNull(t.pathname)&&O.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t;if(!g.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var y=g.slice(-1)[0],p=(t.host||e.host||1<g.length)&&("."===y||".."===y)||""===y,v=0,_=g.length;0<=_;_--)"."===(y=g[_])?g.splice(_,1):".."===y?(g.splice(_,1),v++):v&&(g.splice(_,1),v--);if(!f&&!m)for(;v--;)g.unshift("..");!f||""===g[0]||g[0]&&"/"===g[0].charAt(0)||g.unshift(""),p&&"/"!==g.join("/").substr(-1)&&g.push("");var b,p=""===g[0]||g[0]&&"/"===g[0].charAt(0);return h&&(t.hostname=t.host=!p&&g.length?g.shift():"",(b=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=b.shift(),t.host=t.hostname=b.shift())),(f=f||t.host&&g.length)&&!p&&g.unshift(""),g.length?t.pathname=g.join("/"):(t.pathname=null,t.path=null),O.isNull(t.pathname)&&O.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes,t.href=t.format(),t},S.prototype.parseHost=function(){var e=this.host,t=r.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,M,O){!function(p,m){var T;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(){M&&M.nodeType,p&&p.nodeType;var e="object"==typeof m&&m;e.global!==e&&e.window!==e&&e.self;var t,g=2147483647,y=36,v=26,o=38,i=700,n=/^xn--/,r=/[^\x20-\x7E]/,s=/[\x2E\u3002\uFF0E\uFF61]/g,a={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},u=y-1,_=Math.floor,b=String.fromCharCode;function S(e){throw new RangeError(a[e])}function c(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function d(e,t){var n=e.split("@"),r="";return 1<n.length&&(r=n[0]+"@",e=n[1]),r+c((e=e.replace(s,".")).split("."),t).join(".")}function E(e){for(var t,n,r=[],o=0,i=e.length;o<i;)55296<=(t=e.charCodeAt(o++))&&t<=56319&&o<i?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function f(e){return c(e,function(e){var t="";return 65535<e&&(t+=b((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=b(e)}).join("")}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function k(e,t,n){var r=0;for(e=n?_(e/i):e>>1,e+=_(e/t);u*v>>1<e;r+=y)e=_(e/u);return _(r+(u+1)*e/(e+o))}function l(e){var t,n,r,o,i,s,a,u=[],c=e.length,d=0,l=128,h=72,p=e.lastIndexOf("-");for(p<0&&(p=0),n=0;n<p;++n)128<=e.charCodeAt(n)&&S("not-basic"),u.push(e.charCodeAt(n));for(r=0<p?p+1:0;r<c;){for(o=d,i=1,s=y;c<=r&&S("invalid-input"),a=e.charCodeAt(r++),(y<=(a=a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:y)||a>_((g-d)/i))&&S("overflow"),d+=a*i,!(a<(a=s<=h?1:h+v<=s?v:s-h));s+=y)i>_(g/(a=y-a))&&S("overflow"),i*=a;h=k(d-o,t=u.length+1,0==o),_(d/t)>g-l&&S("overflow"),l+=_(d/t),d%=t,u.splice(d++,0,l)}return f(u)}function h(e){for(var t,n,r,o,i,s,a,u,c,d,l=[],h=(e=E(e)).length,p=128,f=72,m=t=0;m<h;++m)(a=e[m])<128&&l.push(b(a));for(n=r=l.length,r&&l.push("-");n<h;){for(o=g,m=0;m<h;++m)p<=(a=e[m])&&a<o&&(o=a);for(o-p>_((g-t)/(u=n+1))&&S("overflow"),t+=(o-p)*u,p=o,m=0;m<h;++m)if((a=e[m])<p&&++t>g&&S("overflow"),a==p){for(i=t,s=y;!(i<(c=s<=f?1:f+v<=s?v:s-f));s+=y)l.push(b(w(c+(d=i-c)%(c=y-c),0))),i=_(d/c);l.push(b(w(i,0))),f=k(t,u,n==r),t=0,++n}++t,++p}return l.join("")}t={version:"1.4.1",ucs2:{decode:E,encode:f},decode:l,encode:h,toASCII:function(e){return d(e,function(e){return r.test(e)?"xn--"+h(e):e})},toUnicode:function(e){return d(e,function(e){return n.test(e)?l(e.slice(4).toLowerCase()):e})}},void 0===(T=function(){return t}.call(M,O,M,p))||(p.exports=T)}()}.call(this,O(12)(e),O(13))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(16),t.encode=t.stringify=n(17)},function(e,t,n){"use strict";e.exports=function(e,t,n,r){n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var i=/\+/g;e=e.split(t=t||"&");t=1e3;r&&"number"==typeof r.maxKeys&&(t=r.maxKeys);var s=e.length;0<t&&t<s&&(s=t);for(var a=0;a<s;++a){var u,c=e[a].replace(i,"%20"),d=c.indexOf(n),d=0<=d?(u=c.substr(0,d),c.substr(d+1)):(u=c,""),c=decodeURIComponent(u),d=decodeURIComponent(d);Object.prototype.hasOwnProperty.call(o,c)?l(o[c])?o[c].push(d):o[c]=[o[c],d]:o[c]=d}return o};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function i(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}e.exports=function(n,r,o,e){return r=r||"&",o=o||"=","object"==typeof(n=null===n?void 0:n)?a(u(n),function(e){var t=encodeURIComponent(i(e))+o;return s(n[e])?a(n[e],function(e){return t+encodeURIComponent(i(e))}).join(r):t+encodeURIComponent(i(n[e]))}).join(r):e?encodeURIComponent(i(e))+o+encodeURIComponent(i(n)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var u=Object.keys||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)("/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\n(function () {\n  //Define WebSocket and protocol variables\n  let websocket = null;\n  let mustStop = false;\n\n  //Define based object response to WebSocketController\n  // let onMessage_response = {\n  //   command: 'incomingMsg',\n  //   msg: null,\n  // }\n\n  //Receive message from WebSocketController\n  self.addEventListener(\n    'message',\n    function (e) {\n      let data = e.data;\n      //Get command parameter to identify operation\n      let command = data.command;\n\n      if (command === 'start') {\n        start(data.commandObj); //Establish WebSocket connection\n        // } else if (command === 'logout') {\n        //   sendOMMmessage(data.commandObj)\n        //   disconnect() //Terminate WebSocket connection\n      } else if (command === 'disconnect') {\n        disconnect();\n      } else if (command === 'send') {\n        sendOMMmessage(data.commandObj);\n      }\n    },\n    false\n  );\n\n  /* -----------------  Application events functions  ----------------- */\n\n  //Establish WebSocket connection\n  function start(wsURL) {\n    websocket = new WebSocket(wsURL);\n    websocket.binaryType = 'arraybuffer';\n    websocket.onopen = onOpen;\n    websocket.onmessage = onMessage;\n    websocket.onerror = onError;\n    websocket.onclose = onClose;\n  }\n\n  function disconnect() {\n    if (websocket) {\n      websocket.close();\n    }\n    mustStop = true;\n    const disconnect_response = {\n      command: 'disconnect',\n      msg: 'Disconnected',\n    };\n    self.postMessage(disconnect_response);\n  }\n\n  //Send message to ADS WebSocket\n  function sendOMMmessage(commandObj) {\n    websocket.send(commandObj);\n  }\n\n  /* -----------------  WS events  ----------------- */\n\n  //Establish WebSocket connection success\n  function onOpen() {\n    const onOpen_response = {\n      command: 'connect',\n      msg: 'Connected',\n    };\n    self.postMessage(onOpen_response);\n  }\n\n  //Receives incoming message from WebSocket\n  function onMessage(event) {\n    const rawData = event.data;\n    const isDataAB = rawData instanceof ArrayBuffer;\n    const parsedData = !isDataAB ? JSON.parse(rawData) : void 0;\n    self.postMessage({ rawData, parsedData, isDataAB });\n  }\n\n  function onError(event) {\n    const onError_response = {\n      command: 'error',\n      msg: JSON.stringify(event),\n    };\n    self.postMessage(onError_response);\n  }\n\n  function onClose(e) {\n    if (mustStop) {\n      return;\n    }\n    const { code, reason } = e;\n    const onClose_response = {\n      command: 'close',\n      data: { code, reason },\n    };\n    self.postMessage(onClose_response);\n  }\n})();\n\n\n/***/ })\n/******/ ]);","Worker",void 0,n.p+"ws.worker.js")};var r,o=n(1),i=(r=o)&&r.__esModule?r:{default:r};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),l=n(0),i=n(3),s=n(4);var a="segments",n=(o.prototype.init=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.flushRange=[],this.appended=0,this.mediaSource=e.mediaSource,this.segmentsVideo=[],this.segmentsAudio=[],this.sourceBuffer={},this.totalBytesCollected=0},o.prototype.setMediaSource=function(e){this.mediaSource=e},o.prototype.createSourceBuffers=function(e){var r=this,o=this.sourceBuffer;e.tracks.forEach(function(e){var t=e.content===i.VIDEO,n=t?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"';e.mime_type&&(n=e.mime_type),o[e.content]=r.mediaSource.addSourceBuffer(n),o[e.content].mode=a;e=o[e.content];t?e.addEventListener(s.BUFFER_UPDATE_END,r.onSBUpdateEnd):e.addEventListener(s.BUFFER_UPDATE_END,r.onAudioSBUpdateEnd)})},o.prototype.onSBUpdateEnd=function(){var e,t;this._needsEos&&this.checkEos(),this._needsFlush||!this.segmentsVideo.length||(e=this.sourceBuffer.video)&&(e.updating||(t=this.segmentsVideo[0],e.appendBuffer(t.data),this.segmentsVideo.shift(),this.videoBufferSize=this.videoBufferSize-t.data.byteLength,this.appended++))},o.prototype.onAudioSBUpdateEnd=function(){var e,t;this._needsEos&&this.checkEos(),this._needsFlush||!this.segmentsAudio.length||(e=this.sourceBuffer.audio)&&(e.updating||(t=this.segmentsAudio[0],e.appendBuffer(t.data),this.segmentsAudio.shift(),this.appended++))},o.prototype.createTracks=function(e){var n=this;e.forEach(function(e){var t=(0,r.base64ToArrayBuffer)(e.payload),t={type:n.getTypeBytrackId(e.id),isInit:!0,data:t};n.maybeAppend(t)})},o.prototype.maybeAppend=function(e){if(!this._needsFlush){if(!this.media||this.media.error)return"audio"===e.type?this.segmentsAudio=[]:this.segmentsVideo=[],l.logger.error("trying to append although a media error occured, flush segment and abort"),void(this.media.error&&l.logger.error("Error code:",this.media.error));var t=this.sourceBuffer[e.type];t&&(t.updating||(t.appendBuffer(e.data),("audio"===e.type?this.segmentsAudio:this.segmentsVideo).shift(),this.appended++))}},o.prototype.setTracksByType=function(e){var n=this,t=e.tracks?"tracks":"streams";1===e[t].length&&(this.audioTrackId=null),e[t].forEach(function(e,t){n[e.content===i.VIDEO?"videoTrackId":"audioTrackId"]={index:t,id:e.id}})},o.prototype.getTypeBytrackId=function(e){return this.audioTrackId&&this.audioTrackId.id===e?i.AUDIO:i.VIDEO},o.prototype.procArrayBuffer=function(e){e=this.rawDataToSegmnet(e);("audio"===e.type?this.segmentsAudio:this.segmentsVideo).push(e),this.totalBytesCollected=this.totalBytesCollected+e.data.byteLength,this.doArrayBuffer(e),this.sourceBuffer&&(this.sourceBuffer.video&&!this.sourceBuffer.video.updating&&this.onSBUpdateEnd(),this.audioTrackId&&this.sourceBuffer.audio&&!this.sourceBuffer.audio.updating&&this.onAudioSBUpdateEnd())},o.prototype.seek=function(){for(var e in this.sourceBuffer)this.sourceBuffer[e].abort(),this.sourceBuffer[e].mode=a},o.prototype.isBuffered=function(){var e,t=0,n=this.sourceBuffer;for(e in n)t+=n[e].buffered.length;return 0<t},o.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n)t+=n[r].buffered.length}catch(e){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this._setTracksFlag=!1}},o.prototype.flushBuffer=function(e,t,n){var r,o,i=void 0,s=void 0,a=void 0,u=void 0,c=this.sourceBuffer;if(Object.keys(c).length){if(l.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var d in c)if(!n||d===n){if((i=c[d]).ended=!1,i.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;try{for(s=0;s<i.buffered.length;s++)if(r=i.buffered.start(s),o=i.buffered.end(s),u=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,t):(a=Math.max(r,e),Math.min(o,t)),.5<Math.min(u,o)-a)return this.flushBufferCounter++,l.logger.log("flush "+d+" ["+a+","+u+"], of ["+r+","+o+"], pos:"+this.media.currentTime),i.remove(a,u),!1}catch(e){l.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else l.logger.warn("abort flushing too many retries");l.logger.log("buffer flushed")}return!0},o.prototype.rawDataToSegmnet=function(e){var t=new Uint8Array(e),e=(0,r.getTrackId)(t);return{type:this.getTypeBytrackId(e),data:t}},o.prototype.onBufferEos=function(){var e,t=this.sourceBuffer,n=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type;for(e in t)n&&e!==n||t[e].ended||(t[e].ended=!0,l.logger.log(e+" sourceBuffer now EOS"));this.checkEos()},o.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e){n=e[n];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}l.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},o.prototype.addSourceBuffer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"audio",t=this.sourceBuffer;t[e]=this.mediaSource.addSourceBuffer("video"===e?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"'),t[e].mode=a;t=t[e];"video"===e?t.addEventListener(s.BUFFER_UPDATE_END,this.onSBUpdateEnd):t.addEventListener(s.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd)},o.prototype.removeSourceBuffer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"audio",t=this.sourceBuffer[e];"audio"===e?t.removeEventListener(s.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd):t.removeEventListener(s.BUFFER_UPDATE_END,this.onSBUpdateEnd),this.mediaSource.removeSourceBuffer(t),delete this.sourceBuffer[e]},o.prototype.destroy=function(){this.init()},o);function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),l.logger.log("create BuffersController"),this.media=e.media,this.init(e),this.doArrayBuffer=r.doArrayBuffer.bind(this),this.maybeAppend=this.maybeAppend.bind(this),this.onSBUpdateEnd=this.onSBUpdateEnd.bind(this),this.onAudioSBUpdateEnd=this.onAudioSBUpdateEnd.bind(this)}t.default=n,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)("/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\n(function () {\n  let statsURL = null;\n  let sendTime = 60000;\n  let jsonTable = {};\n  let sendingInterval = null;\n\n  self.addEventListener(\n    'message',\n    function (e) {\n      let data = e.data;\n      //Get command parameter to identify operation\n      const { command, commandObj } = data;\n      switch (command) {\n        case 'start':\n          statsURL = commandObj\n            .replace(/ws:/, 'http:')\n            .replace(/wss:/, 'https:')\n            .replace(/mse_ld/, 'sessions');\n          start();\n          break;\n        case 'time':\n          correctSendTime(commandObj);\n          break;\n        case 'stop':\n          stop();\n          break;\n        case 'add':\n          addToTable(commandObj);\n          break;\n        default:\n          break;\n      }\n    },\n    false\n  );\n\n  function correctSendTime(time) {\n    sendTime = time;\n  }\n\n  function start() {\n    sendingInterval = this.setInterval(() => {\n      post();\n    }, sendTime);\n  }\n\n  function stop() {\n    post();\n    clearInterval(sendingInterval);\n  }\n\n  function addToTable(data) {\n    jsonTable = { ...jsonTable, ...data };\n\n    if (data.event && data.event === 'play_stop') {\n      stop();\n    }\n  }\n\n  // function roughSizeOfObject(object) {\n  //   let objectList = [];\n  //   let stack = [object];\n  //   let bytes = 0;\n\n  //   while (stack.length) {\n  //     let value = stack.pop();\n\n  //     if (typeof value === 'boolean') {\n  //       bytes += 4;\n  //     } else if (typeof value === 'string') {\n  //       bytes += value.length * 2;\n  //     } else if (typeof value === 'number') {\n  //       bytes += 8;\n  //     } else if (typeof value === 'object' && objectList.indexOf(value) === -1) {\n  //       objectList.push(value);\n\n  //       for (let i in value) {\n  //         stack.push(value[i]);\n  //       }\n  //     }\n  //   }\n  //   return bytes;\n  // }\n\n  function post() {\n    if (!jsonTable.started_at) {\n      return;\n    }\n\n    const { source_id } = jsonTable;\n    const newUrl = statsURL.replace(/sessions/, `sessions/${source_id ? `${source_id}` : ''}`);\n    fetch(newUrl, {\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n      method: 'PUT',\n      body: JSON.stringify(jsonTable),\n    });\n  }\n})();\n\n\n/***/ })\n/******/ ]);","Worker",void 0,n.p+"stats.worker.js")};var r,o=n(1),i=(r=o)&&r.__esModule?r:{default:r};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EVENT_SEGMENT="event",t.MSE_INIT_SEGMENT="mse_init_segment",t.MSE_MEDIA_SEGMENT="mse_media_segment"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={NOT_HTML_MEDIA_ELEMENT:"media should be an HTMLMediaElement instance"},e.exports=t.default}],r={},o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=5);function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var n,r});