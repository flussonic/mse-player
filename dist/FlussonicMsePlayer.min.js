!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FlussonicMsePlayer=t():e.FlussonicMsePlayer=t()}(window,function(){return n=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.enableLogs=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=n(19);function r(){}var i={trace:r,debug:r,log:r,warn:r,info:r,error:r},s=i;var a=(0,n.getSelfScope)();function u(i){var s=a.console[i];return s?function(){for(var e,t,n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];o[0]&&(o[0]=(e=i,t=o[0],t="["+e+"] > "+t)),s.apply(a.console,o)}:r}t.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":o(e))){!function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];n.forEach(function(e){s[e]=t[e]?t[e].bind(t):u(e)})}(e,"trace","debug","log","info","warn","error");try{s.log()}catch(e){s=i}}else s=i},t.logger=s},function(e,t,n){"use strict";e.exports=function(t,n,o,r){var i,s=self||window;try{try{try{i=new s.Blob([t])}catch(e){(i=new(s.BlobBuilder||s.WebKitBlobBuilder||s.MozBlobBuilder||s.MSBlobBuilder)).append(t),i=i.getBlob()}var e=s.URL||s.webkitURL,a=e.createObjectURL(i),u=new s[n](a,o);return e.revokeObjectURL(a),u}catch(e){return new s[n]("data:application/javascript,".concat(encodeURIComponent(t)),o)}}catch(e){if(!r)throw Error("Inline worker is not supported");return new s[n](r,o)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorMsg=t.replaceHttpByWS=t.checkVideoProgress=void 0,t.getMediaSource=o,t.isAndroid=r,t.isSupportedMSE=function(){if(r())return!1;var e=o(),t=window.SourceBuffer||window.WebKitSourceBuffer,e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.4d401f,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!e&&!!t},t.base64ToArrayBuffer=function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})},t.RawDataToUint8Array=function(e){return new Uint8Array(e)},t.getTrackId=i,t.getRealUtcFromData=s,t.doArrayBuffer=function(e){e.isInit||(this.utc=s(e.data),this.lastLoadedUTC=this.utc)},t.debugData=a,t.pad2=d,t.humanTime=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(!(0<e))return"";var n=e,o=new Date;o.setTime(1e3*n);e=!(!1===t),n=e?o.getHours():o.getUTCHours(),t=e?o.getMinutes():o.getUTCMinutes(),o=e?o.getSeconds():o.getUTCSeconds();return d(n)+":"+d(t)+":"+d(o)},t.logDM=function(e,t){t&&h.logger.log("%c "+t.type+" "+("event"===t.type?t.event:"mse_init_segment"),"background: aquamarine;",t)},t.showDispatchError=function(e,t){var n=e.data instanceof ArrayBuffer;h.logger.error(u(e),t),this.media&&this.media.error&&h.logger.error("MediaError:",this.media.error);n&&h.logger.error("Data:",a(e.data));++c>=this.opts.errorsBeforeStop&&(c=0,this.stopPromise=this.stop());this.onError&&this.onError(t,e)};var h=n(0);function o(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function r(){return-1!==navigator.userAgent.indexOf("Android")}function i(e){return e[47]}function s(e){return(e[92]<<24|e[93]<<16|e[94]<<8|e[95])+(e[96]<<24|e[97]<<16|e[98]<<8|e[99])/1e6}function a(e){e=new Uint8Array(e);return{trackId:e[47],utc:s(e),view:e}}t.checkVideoProgress=function(c,l){return function(){var e,t=c.currentTime,n=c.buffered,o=c.buffered.length;if(l)for(var r=l.sb.sourceBuffer,i=Object.keys(r),s=t-30,a=i.length-1;0<=a;a--){var u=i[a],d=r[u];!d||0<(u=d.buffered).length&&s>u.start(0)&&(function(e,t,n){try{for(var o=0;o<e.buffered.length;o++){var r=e.buffered.start(o),i=e.buffered.end(o),s=Math.max(r,t),a=Math.min(i,n);if(.5<Math.min(a,i)-s)return e.updating||e.remove(s,a)}}catch(e){h.logger.warn("removeBufferRange failed",e)}}(d,0,s),0,0)}l.media.readyState<=2&&2===l.media.networkState?l.onStartStalling():2<l.media.readyState&&l.onEndStalling(),o&&(e=n.end(o-1),n=Math.abs(e-t),l.retroviewWorker&&l.retroviewWorker.postMessage({command:"add",commandObj:{key:Date.now(),data:{appended:l.sb.appended,videoBuffer:l.sb.videoBufferSize,audioBuffer:l.sb.audioBufferSize,totalBytesCollected:l.sb.totalBytesCollected,currentTime:t,endTime:e,readyState:l.media.readyState,networkState:l.media.networkState}}}),l.onStats&&l.onStats({timestamp:Date.now(),appended:l.sb.appended,videoBuffer:l.sb.videoBufferSize,audioBuffer:l.sb.audioBufferSize,totalBytesCollected:l.sb.totalBytesCollected,currentTime:t,endTime:e,readyState:l.media.readyState,networkState:l.media.networkState}),n<=l.opts.maxBufferDelay||(h.logger.log("nudge",t,"->",o?e:"-",t-e),c.currentTime=e-.2))}},t.replaceHttpByWS=function(e){return e.replace(/^http/,"ws")};var u=t.errorMsg=function(e){return"Error "+e.name+": "+e.message+"\n"+e.stack};function d(e){return e<=9?"0"+e:""+e}var c=0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VIDEO="video",t.AUDIO="audio"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_SOURCE_SOURCE_OPEN:"sourceopen",MEDIA_SOURCE_SOURCE_ENDED:"sourceended",MEDIA_SOURCE_SOURCE_CLOSE:"sourceclose",MEDIA_ELEMENT_PLAY:"play",MEDIA_ELEMENT_PAUSE:"pause",MEDIA_ELEMENT_PROGRESS:"progress",MEDIA_ELEMENT_EMPTIED:"emptied",MEDIA_ELEMENT_SUSPEND:"suspend",MEDIA_ELEMENT_STALLED:"stalled",MEDIA_ELEMENT_WAITING:"waiting",MEDIA_ELEMENT_RATECHANGE:"ratechange",MEDIA_ELEMENT_PLAYING:"playing",WS_OPEN:"open",WS_MESSAGE:"message",WS_ERROR:"error",WS_CLOSE:"close",BUFFER_UPDATE_END:"updateend",BUFFER_ERROR:"onerror",BUFFER_ABORT:"onabort"},e.exports=t.default},function(e,t,n){e.exports=n(6)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=n(7),n=(o=r)&&o.__esModule?o:{default:o};t.default=n.default,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},n=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=m(r(8)),s=m(r(20)),u=m(r(21)),d=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(r(2)),c=r(0),l=r(22),h=r(3),f=m(r(4)),p=m(r(23));function m(e){return e&&e.__esModule?e:{default:e}}var g=h.VIDEO,v=h.AUDIO,n=(y.replaceHttpByWS=function(e){return d.replaceHttpByWS(e)},y.isSupported=function(){return d.isSupportedMSE()},n(y,null,[{key:"version",get:function(){return"21.10.3"}}]),y.prototype.play=function(e,t){var n=this;if(c.logger.log("[mse-player]: play()"),this.playing)c.logger.log("MSE is already playing");else{if(!this.ws||!this.ws.websocket||this._pause)return this._play(e,t).then(function(){n.playing=!0,n._stop=!1,n.pendingTracks&&(n.setTracks(n.pendingTracks),n.pendingTracks=void 0)}).catch(function(e){n.onError&&n.onError(e),c.logger.error("[mse-player]: got error on play",e),n.playing=!1});c.logger.log("[mse-player]: websocket already opened")}},y.prototype.stop=function(){var e=this;this.playPromise?this.playPromise.catch(function(){return e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),e._stop?void c.logger.log("[mse-player]: already stopped"):e.onMediaDetaching()}).finally(function(){return e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),e._stop?void c.logger.log("[mse-player]: already stopped"):e.onMediaDetaching()}):c.logger.log("[mse-player]: no playPromise exists, nothing to stop"),this.firstStart=!0},y.prototype.pause=function(){if(!function(){return!(!(!this._pause&&this.playing&&this.media&&this.ws&&this.mediaSource)||this.mediaSource&&"open"!==this.mediaSource.readyState||!this.playPromise)}.bind(this)())return c.logger.log("[mse:playback] can not do pause");var e=function(){if(this.ws.pause(),this.media.pause(),this._pause=!0,this.playing=!1,this.onPause)try{this.onPause()}catch(e){c.logger.error("Error "+e.name+":"+e.message+"\n"+e.stack)}this.retroviewWorker&&this.retroviewWorker.postMessage({command:"add",commandObj:{key:Date.now(),data:{event:"play_pause"}}})}.bind(this);this.playPromise.then(e,e).catch(e,e)},y.prototype.restart=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]?void 0:this.sb.lastLoadedUTC;this.playing=!1,this.ws.destroy(),this.ws.init(),this.ws.start(this.url,e,this.videoTrack,this.audioTrack),this.onEndStalling()},y.prototype.retryConnection=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.retry>=this.opts.connectionRetries?clearInterval(this.retryConnectionTimer):(c.logger.log("%cconnectionRetry:","background: orange;","Retrying "+(this.retry+1)),this.mediaSource=void 0,this.init(),this.ws.destroy(),this.sb.destroy(),this.play(t,n).then(function(){e.onEndStalling()}),this.retry=this.retry+1)},y.prototype.setTracks=function(e){var n,t,o,r,i=this,s=e;if(this.mediaInfo){if("lowest"===s)s=this.autoTrackSelection(!1);else if("highest"===s)s=this.autoTrackSelection(!0);else if(!Array.isArray(s))return void c.logger.error('tracks should be an Array instance: ["v1", "a1"]');this.playing?(n=this.mediaInfo.streams?"streams":"tracks",t=s.filter(function(t){var e=i.mediaInfo[n].find(function(e){return t===e.track_id});return!!e&&e.content===g}).join(""),(o=s.filter(function(t){var e=i.mediaInfo[n].find(function(e){return t===e.track_id});return e?!!e&&e.content===v:null}).join("")).length||t.length||(c.logger.warn("No such stream tracks! Setting to default parameters"),r=this.getVideoTracks(),(e=this.getAudioTracks()).length?o=e[0].track_id:c.logger.warn("No audio tracks"),r.length?t=r[0].track_id:c.logger.warn("No video tracks")),o.length||(this.sb.sourceBuffer.audio&&this.sb.removeSourceBuffer(),this.media.muted=!0,c.logger.warn("No audio tracks")),t.length&&o.length&&this.mediaSource.sourceBuffers.length<=1&&(this.stop(),this.media.muted=!1,this.play()),this.onStartStalling(),this.ws.setTracks(t,o),this.retroviewWorker&&this.retroviewWorker.postMessage({command:"add",commandObj:{key:Date.now(),data:{event:"play_options",selectedTracks:{videoTracksStr:t,audioTracksStr:o}}}}),this.videoTrack=t,this.audioTrack=o,this._setTracksFlag=!0,this.waitForInitFrame=!0):this.pendingTracks=s}else c.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},y.prototype.autoTrackSelection=function(e){if(this.mediaInfo){var t,n,o,r,i,s=this.getVideoTracks(),a=this.getAudioTracks(),u=void 0,d=void 0;e?(n=t=void 0,s[0].bitrate?n="bitrate":s[0].pixel_width&&(n="pixel_width"),t=s[0][n],u=s[0].track_id,s.forEach(function(e){e[n]>t&&(t=e[n],u=e.track_id)}),a.length&&(d=a[0].track_id,a.forEach(function(e){e.sample_rate>t&&(d=e.track_id)}))):(r=o=void 0,s[0].bitrate?r="bitrate":s[0].pixel_width&&(r="pixel_width"),o=s[0][r],u=s[0].track_id,s.forEach(function(e){e[r]<o&&(o=e[r],u=e.track_id)}),a.length&&(i=void 0,i=a[0].sample_rate,d=a[0].track_id,a.forEach(function(e){e.sample_rate<i&&(i=e.sample_rate,d=e.track_id)})));a=[];return u&&u.length&&a.push(u),d&&d.length&&a.push(d),a}c.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},y.prototype._play=function(o,r){var i=this;return this.liveError=!1,new Promise(function(e,t){if(c.logger.log("_play",o,r),i.playing){var n="[mse-player] _play: terminate because already has been playing";return c.logger.log(n),e({message:n})}if(i._pause)return i.ws&&!1===i.ws.opened?(c.logger.log("WebSocket Closed, trying to restart it"),i._pause=!1,void i.restart(!0)):(c.logger.log("WebSocket is in opened state, resuming"),i._pause=!1,i._resume(),i.playPromise=i.media.play(),c.logger.log("_play: terminate because _paused and should resume"),i.playPromise);if(i.videoTrack=o,i.audioTrack=r,i._pause=!1,i.mediaSource||i.onAttachMedia({media:i.media}).then(function(){i.onsoa=i._play.bind(i,o,r),i.sb.setMediaSource(i.mediaSource),i.mediaSource.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,i.onsoa),c.logger.warn("mediaSource did not create"),i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t}),i.mediaSource&&"open"!==i.mediaSource.readyState)return c.logger.warn('readyState is not "open", it\'s currently ',i.mediaSource.readyState),i.shouldPlay=!0,i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,void(i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t);new Promise(function(e,t){return!i.media.autoplay||!0===i.media.muted||i.opts.retryMuted?e():!i.onAutoplay||function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod","Safari"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?(i.media.muted=!0,e()):(i.onAutoplay(function(){return i.media.muted=!1,e()}),void t())}).then(function(){i.ws.start(i.url,i.playTime,i.videoTrack,i.audioTrack).then(function(){return i.playPromise=i.media.play(),i.playPromise.then(function(){i.onStartStalling(),i.startProgressTimer(),i.resolveThenMediaSourceOpen&&(i._stop=!1,i.resolveThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0,clearInterval(i.retryConnectionTimer),i.retry=0),i.onEvent({key:Date.now(),data:{event:"play_started"}})}).catch(function(e){c.logger.log("playPromise rejection.",e),i.ws.connectionPromise&&i.ws.connectionPromise.then(function(){return i.ws.destroy()}),i.opts.retryMuted&&0==i.media.muted&&(i.onMuted&&i.onMuted(),i.media.muted=!0,i._play(o,r)),i.onError&&i.onError({error:"play_promise_reject",err:e}),i.rejectThenMediaSourceOpen&&(i.rejectThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0),i.opts.retryMuted||i.stop(),!i.opts.onCrashTryVideoOnly||(e=i.mediaInfo.activeStreams.video)&&i._play(e)}),i.playPromise})})})},y.prototype.init=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._pause=!1,this.playing=!1,this.shouldPlay=!1,this.audioTrack="",this.videoTrack="",this.endProgressTimer(),e||this.onEvent({key:Date.now(),data:{event:"play_init",userInfo:window.navigator.userAgent,playerInfo:"MSEPlayer"+(y.version?"@"+y.version:"")}})},y.prototype._resume=function(){this.ws.resume(),this.onEvent({key:Date.now(),data:{event:"play_websocket_resume"}})},y.prototype.onMediaDetaching=function(){var e=this;if(this.stopRunning)c.logger.warn("stop is running.");else{if(this.stopRunning=!0,this.handlerMediaDetaching.bind(this),!this.playPromise)return this.handlerMediaDetaching();this.playPromise.catch(function(){return e.handlerMediaDetaching()}).finally(function(){return e.handlerMediaDetaching()})}},y.prototype.handlerMediaDetaching=function(){var n=this;return c.logger.info("media source detaching"),new Promise(function(e,t){if(n.removeMediaSource(),!n.media)return t("no media to detach");n.media.removeEventListener(f.default.MEDIA_ELEMENT_PROGRESS,n.oncvp),n.media.removeEventListener(f.default.MEDIA_ELEMENT_SUSPEND,n.errorLog),n.media.removeEventListener(f.default.MEDIA_ELEMENT_STALLED,n.errorLog),n.media.removeEventListener(f.default.MEDIA_ELEMENT_RATECHANGE,n.errorLog),n.media.removeEventListener(f.default.MEDIA_ELEMENT_PLAYING,n.loadingIndication),n.media.removeEventListener(f.default.MEDIA_ELEMENT_WAITING,n.loadingIndication),n.oncvp=null,n.errorLog=null,n.mediaSource=null,n.init(!0),n.ws.destroy(),n.sb.destroy(),n.media.onemptied=function(){return c.logger.log("[mse-player]: media emptied"),n.stopRunning=!1,n._stop=!0,delete n.playPromise,n.onEvent({key:Date.now(),data:{event:"play_stop"}}),e()}})},y.prototype.removeMediaSource=function(){var e=this,t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(e){c.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),this.onmso=null,this.onmse=null,this.onmsc=null}function n(){e.media.src="",e.media.load(),e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0)}this.playPromise&&this.playPromise.then(function(){n()}).catch(function(){n()})},y.prototype.onMediaElementEmptied=function(e){return this.onMediaElementEmptied&&this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_EMPTIED,this.onMediaElementEmptied),this._onmee=void 0),e},y.prototype.onAttachMedia=function(e){var t=this;this.media=e.media;e=this.media;if(!(e instanceof HTMLMediaElement))throw new Error(p.default.NOT_HTML_MEDIA_ELEMENT);if(e){var n=this.mediaSource=new MediaSource;if(this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),e.src=URL.createObjectURL(n),this.eventLog=function(e){t.onEvent&&t.onEvent(e)},this.oncvp=d.checkVideoProgress(e,this).bind(this),this.media.addEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),this.media.addEventListener(f.default.MEDIA_ELEMENT_STALLED,this.eventLog),this.media.addEventListener(f.default.MEDIA_ELEMENT_SUSPEND,this.eventLog),this.media.addEventListener(f.default.MEDIA_ELEMENT_RATECHANGE,this.eventLog),this.media.addEventListener(f.default.MEDIA_ELEMENT_PLAYING,this.loadingIndication.bind(this)),this.media.addEventListener(f.default.MEDIA_ELEMENT_WAITING,this.loadingIndication.bind(this)),!this.liveError)return new Promise(function(e){t.onmso=t.onMediaSourceOpen.bind(t,e),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,t.onmso)});this.player=void 0}},y.prototype.onMediaSourceOpen=function(e){e();e=this.mediaSource;e&&e.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),URL.revokeObjectURL(this.media.src),this.shouldPlay&&(this.shouldPlay=!1,c.logger.info("readyState now is "+this.mediaSource.readyState+", and will be played",this.audioTrack,this.videoTrack),this._play(this.audioTrack,this.videoTrack))},y.prototype.onDisconnect=function(e){this.onEvent({key:Date.now(),data:{event:"play_diconnected"}}),this.opts.onDisconnect&&this.opts.onDisconnect(e)},y.prototype.dispatchMessage=function(e){var t=this;if(!this.stopRunning){var n,o=e.rawData,r=e.parsedData,i=e.isDataAB,e=Date.now()-this.messageTime;this.messageTime=Date.now(),this.opts.onMessage&&this.opts.onMessage({utc:Date.now(),messageTimeDiff:e}),this.retroviewWorker&&this.retroviewWorker.postMessage({command:"add",commandObj:{key:Date.now(),data:{websocketLag:e}}});try{if(i){if(this.waitForInitFrame)return c.logger.log("old frames");this.sb.procArrayBuffer(o)}if(r&&r.type===l.EVENT_SEGMENT){var s=r[l.EVENT_SEGMENT];switch(c.logger.log("%c "+r.type+" "+("event"===r.type?r.event:"mse_init_segment"),"background: aquamarine;",r),s){case"resumed":this._pause&&!this.playing&&this.onStartStalling(),this.onResume&&this.onResume();break;case"paused":break;case"seeked":case"switched_to_live":if(this.seekValue=void 0,this.opts.onSeeked)try{this.opts.onSeeked()}catch(e){c.logger.error(e)}break;case"recordings_ended":this._eos=!0,this.sb.onBufferEos();break;case"stream_unavailable":"static"in r&&0==r.static?(c.logger.info("Stream is on on demand mode, waiting for init segment"),this.onStartStalling()):(c.logger.warn("do playPromise reject with error"),this.ws.connectionPromise&&this.ws.connectionPromise.then(function(){return t.ws.pause()}),this.liveError||(this.opts.onError&&this.opts.onError({error:"playPromise reject - stream unavaible"}),this.liveError=!0),this.rejectThenMediaSourceOpen&&(this.rejectThenMediaSourceOpen(),this.resolveThenMediaSourceOpen=void 0,this.rejectThenMediaSourceOpen=void 0),this.playPromise=Promise.reject("stream unavaible"),this.mediaSource.endOfStream());break;case"tracks_switched":break;default:this.opts.onEvent&&this.opts.onEvent({error:"unhandled_event",event:s}),c.logger.warn("unknown type of event",s)}return}if(r&&r.type===l.MSE_INIT_SEGMENT)return this.procInitSegment(o)}catch(e){d.showDispatchError.bind(this)(e);try{this.media.error?(this.onError&&this.onError({error:"Media error",mediaError:this.media.error}),this.stop()):this.mediaInfo&&this.mediaInfo.activeStreams&&(n=this.mediaInfo.activeStreams,this.setTracks([n.video||"",n.audio||""]))}catch(e){this.ws.pause()}}}},y.prototype.procInitSegment=function(e){var n=this,t=JSON.parse(e);if(t.type!==l.MSE_INIT_SEGMENT)return c.logger.warn("type is not "+l.MSE_INIT_SEGMENT);this.waitForInitFrame&&(this.waitForInitFrame=!1),this.resetTimer&&(clearTimeout(this.resetTimer),this.resetTimer=void 0),this.sb.isBuffered()&&(this.sb.doFlush(),this.sb.seek()),this.sb.setTracksByType(t);var o=a({},t.metadata,{tracks:t.metadata.streams||t.metadata.tracks,streams:t.metadata.streams||t.metadata.tracks}),r=t.metadata.streams;t.metadata.tracks&&(r=t.metadata.tracks);var i={},e=this.sb.videoTrackId&&this.sb.videoTrackId.id-1;if(r[e]&&r[e].track_id){if(r[e].bitrate&&0===r[e].bitrate||0===r[e].height||0===r[e].width)return void(this.onError&&this.onError({error:"Video track error"}));i.video=r[e].track_id}var s,e=this.sb.audioTrackId&&this.sb.audioTrackId.id-1;e&&r[e]&&r[e].track_id&&(r[e].bitrate&&0===r[e].bitrate?(this.onError&&this.onError({error:"Audio track error"}),s=void 0,t.tracks.forEach(function(e,t){e.id===n.sb.audioTrackId.id&&(s=t)}),t.tracks.splice(s,1),this.sb.sourceBuffer.audio&&(this.mediaSource.removeSourceBuffer(this.sb.sourceBuffer.audio),delete this.sb.sourceBuffer.audio)):i.audio=r[e].track_id);o=a({},o,{activeStreams:i,version:y.version,xsid:t.session_id});if(this.doMediaInfo(o),c.logger.log("%cprocInitSegment:","background: lightpink;",t),this.onEvent({key:Date.now(),data:a({event:"play_metadata"},o)}),this.mediaSource&&!this.mediaSource.sourceBuffers.length&&(this.sb.setMediaSource(this.mediaSource),this.sb.createSourceBuffers(t)),this.liveError||this.sb.createTracks(t.tracks),this.opts.videoQuality&&this.firstStart){t=void 0;if("lowest"===this.opts.videoQuality?t=this.autoTrackSelection(!1):"highest"===this.opts.videoQuality&&(t=this.autoTrackSelection(!0)),t[0]!==i.video||i.audio&&t[1]!==i.audio)return void this.ws.setTracks(t[0]||"",t[1]||"");this.firstStart=!1}this.opts.preferHQ&&c.logger.info("[MSE]: preferHQ option is depricated. Use videoQuality(lowest/highest) instead"),this.ws.resume()},y.prototype.doMediaInfo=function(e){if(c.logger.log("%cmediaInfo:","background: orange;",e),this.mediaInfo=e,this.onMediaInfo)try{this.onMediaInfo(e)}catch(e){c.logger.error(d.errorMsg(e))}},y.prototype.getVideoTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===g})}},y.prototype.getAudioTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===v})}},y.prototype.immediateLevelSwitchEnd=function(){var e=this,t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,this.previouslyPaused||(this.playPromise=t.play(),this.playPromise.then(function(){e._pause=!1,e.playing=!0})))},y.prototype.onStartStalling=function(){var e=this;this.resetTimer||(this.resetTimer=setTimeout(function(){e.restart()},6e4)),this._stalling||(this.opts.onStartStalling&&this.opts.onStartStalling(),this._stalling=!0,c.logger.log("onStartStalling"),this.onEvent({key:Date.now(),data:{event:"play_stalled"}}))},y.prototype.onEndStalling=function(){this._stalling&&(this.opts.onEndStalling&&this.opts.onEndStalling(),this._stalling=!1,c.logger.log("onEndStalling"),clearTimeout(this.resetTimer),this.resetTimer=void 0,this.onEvent({key:Date.now(),data:{event:"play_resumed"}}))},y.prototype.startProgressTimer=function(){this.timer=setInterval(this.onTimer.bind(this),this.opts.progressUpdateTime)},y.prototype.endProgressTimer=function(){clearInterval(this.timer),this.timer=void 0},y.prototype.onTimer=function(){if(this._eos)return c.logger.log("nothing to play");if(this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.sb.lastLoadedUTC!==this.utcPrev&&!this._stalling&&(this.utcPrev=this.sb.lastLoadedUTC,this.onProgress))try{this.onProgress(this.sb.lastLoadedUTC)}catch(e){c.logger.error(d.errorMsg(e))}},y.prototype.onMediaSourceEnded=function(){c.logger.log("media source ended");try{this.opts.onEOS&&this.opts.onEOS()}catch(e){c.logger.error("error while proccessing onEOS")}},y.prototype.onMediaSourceClose=function(){c.logger.log("media source closed")},y.prototype.onConnectionRetry=function(){var e=this;this.retryConnectionTimer||this._stop?this.retry>=this.opts.connectionRetries&&clearInterval(this.retryConnectionTimer):this.retry<this.opts.connectionRetries&&(this.retryConnectionTimer=setInterval(function(){return e.retryConnection()},5e3))},y.prototype.loadingIndication=function(e){e=e.type;"playing"===e?(this.playing=!0,this.onEndStalling(),this.stallingStartTime&&(this.retroviewWorker&&this.retroviewWorker.postMessage({command:"add",commandObj:{key:Date.now(),data:{stallingTime:performance.now()-this.stallingStartTime}}}),delete this.stallingStartTime)):"waiting"===e&&(this.playing=!1,this.stallingStartTime=performance.now(),this.onStartStalling())},y.prototype.onEvent=function(e){this.retroviewWorker&&this.retroviewWorker.postMessage({command:"add",commandObj:e}),this.onEventCallback&&this.onEventCallback(e)},y);function y(e,t){var n=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),o.debug&&((0,c.enableLogs)(!0),window.humanTime=d.humanTime),c.logger.info("[mse-player]:",y.version),this.opts=o||{},this.media=e,this.url=t,this.firstStart=!0,this.opts.progressUpdateTime=this.opts.progressUpdateTime||500,this.opts.errorsBeforeStop=this.opts.errorsBeforeStop||1,"number"!=typeof this.opts.errorsBeforeStop||isNaN(this.opts.errorsBeforeStop))throw new Error("invalid errorsBeforeStop param, should be number");if(this.opts.connectionRetries=this.opts.connectionRetries||0,"number"!=typeof this.opts.connectionRetries||isNaN(this.opts.connectionRetries))throw new Error("invalid connectionRetries param, should be number");if(this.opts.wsReconnect=this.opts.wsReconnect||!1,"boolean"!=typeof this.opts.wsReconnect)throw new Error("invalid wsReconnect param, should be boolean");if(this.opts.preferHQ=this.opts.preferHQ||!1,"boolean"!=typeof this.opts.preferHQ)throw new Error("invalid preferHQ param, should be boolean");if(this.opts.onCrashTryVideoOnly=this.opts.onCrashTryVideoOnly||!0,"boolean"!=typeof this.opts.onCrashTryVideoOnly)throw new Error("invalid onCrashTryVideoOnly param, should be boolean");if(this.retry=0,this.retryConnectionTimer,this.opts.retryMuted=this.opts.retryMuted||!1,"boolean"!=typeof this.opts.retryMuted)throw new Error("invalid retryMuted param, should be boolean");this.opts.maxBufferDelay=this.opts.maxBufferDelay||2;t=navigator.userAgent;if((/Edge/.test(t)||/trident.*rv:1\d/i.test(t))&&(this.opts.maxBufferDelay=10),"number"!=typeof this.opts.maxBufferDelay)throw new Error("invalid maxBufferDelay param, should be number");if(this.opts.videoQuality){if("string"!=typeof this.opts.videoQuality)throw new Error("invalid videoQuality param, should be string");if("highest"!==this.opts.videoQuality&&"lowest"!==this.opts.videoQuality)throw new Error("invalid videoQuality param, should be highest or lowest")}try{this.Sentry=r(!function(){var e=new Error("Cannot find module '@sentry/browser'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){this.noSentry=!0}if(this.opts.sentryConfig=this.opts.sentryConfig||"","string"!=typeof this.opts.sentryConfig)throw new Error("invalid sentryConfig param, should be string");this.opts.sentryConfig.length&&!this.noSentry&&(this.Sentry.init({dsn:this.opts.sentryConfig,environment:"production",release:"Mse Player@"+y.version}),document.onerror=function(e){n.Sentry.captureException(e)}),this.opts.retroviewURL&&window.Worker&&(this.retroviewWorker=new u.default,this.opts.retroviewSendTime&&this.retroviewWorker.postMessage({command:"time",commandObj:this.opts.retroviewSendTime}),this.retroviewWorker.postMessage({command:"start",commandObj:this.opts.retroviewURL}),t=JSON.stringify(this.opts),this.retroviewWorker.postMessage({command:"add",commandObj:{key:Date.now(),data:{options:t}}})),this.onProgress=o&&o.onProgress,o&&o.onDisconnect?this.onDisconnect=o&&o.onDisconnect:this.onDisconnect=function(e){c.logger.log("[websocket status]:",e)},this.onMediaInfo=o&&o.onMediaInfo,this.onError=o&&o.onError,this.onEventCallback=o&&o.onEvent,this.onAutoplay=o&&o.onAutoplay,this.onMuted=o&&o.onMuted,this.onStats=o&&o.onStats,this.onMessage=o&&o.onMessage,this.onPause=o&&o.onPause,this.onResume=o&&o.onResume,e instanceof HTMLMediaElement&&(e.WebKitPlaysInline=!0,e.controls=!1),this.ws=new i.default({message:this.dispatchMessage.bind(this),closed:this.onDisconnect.bind(this),error:this.onError,wsReconnect:this.opts.wsReconnect}),this.sb=new s.default({media:e}),this.messageTime=Date.now(),this.init()}t.default=n,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWSURL=u;var d=r(n(9)),o=r(n(18)),c=n(0);function r(e){return e&&e.__esModule?e:{default:e}}var l="live",n=(i.prototype.init=function(){this.wsWorker&&delete this.wsWorker,this.opened=!1,this.connectionPromise=void 0,clearTimeout(this.reconnect),this.reconnect=void 0,window.Worker&&(this.wsWorker=new o.default,this.wsWorker.onmessage=this.onWorkerMessage.bind(this))},i.prototype.onWorkerMessage=function(e){var t=e.data;switch(t.command){case"connect":this.open();break;case"close":this.onWSClose(t);break;case"error":this.handleError(t);break;default:this.handleReceiveMessage(t)}},i.prototype.start=function(o,r){var i=this,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";return this.connectionPromise=new Promise(function(e,t){i.socketURL={url:o,time:r,videoTrack:s,audioTack:a};var n=u(o,0,s,a);i.wsWorker.postMessage({command:"start",commandObj:n}),i._openingResolve=e,i._openingReject=t}),this.connectionPromise},i.prototype.open=function(){this.opened=!0,this.paused=!0,this._openingResolve()},i.prototype.send=function(e){this.wsWorker.postMessage({command:"send",commandObj:e})},i.prototype.resume=function(){clearTimeout(this.reconnect),c.logger.log("ws: send resume"),this.send("resume"),this.paused=!1},i.prototype.pause=function(){c.logger.log("ws: send pause"),this.send("pause"),this.paused=!0},i.prototype.seek=function(e){var t=e===l?"":"play_from=";c.logger.log(t+e),this.send(t+e)},i.prototype.setTracks=function(e){this.send("set_tracks="+e+(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null))},i.prototype.handleReceiveMessage=function(e){this.opts.message(e)},i.prototype.handleError=function(){var e;this.opts.error&&(e=this.opts).error.apply(e,arguments)},i.prototype.onWSClose=function(e){var t,n,o,r,i=this;c.logger.log("WebSocket lost connection with code ",e.code+" and reason: "+e.reason),this.opts.error&&this.opts.error({error:"WebSocket lost connection",err:"WebSocket lost connection with code "+e.code+" and reason: "+e.reason,code:e.code}),this.opts.wsReconnect&&(e.wasClean&&1e3!==e.code&&1006!==e.code?(c.logger.log("Clean websocket stop"),this.destroy()):(t=this.socketURL,n=t.url,o=t.videoTrack,r=t.audioTack,this.reconnect=setTimeout(function(){i.start(n,o,r).then(function(){clearTimeout(i.reconnect)}).catch(function(){i.destroy()})},5e3))),this.opts.closed&&this.opts.closed(e)},i.prototype.destroy=function(){this.wsWorker.postMessage({command:"disconnect"}),clearTimeout(this.reconnect),this.reconnect=void 0,this.init()},i);function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.opts=e,this.init(),this.onwso=this.open.bind(this),this.onwsm=this.handleReceiveMessage.bind(this),this.onwse=this.handleError.bind(this),this.onwsc=this.onWSClose.bind(this)}function u(e,t,n,o){var r=t=l;if(!r&&!n&&!o)return e;var i=(0,d.default)({url:e}),s="";i.query&&(s=i.query.split("&").map(function(e){return e.split("=")}).filter(function(e){return"from"!==e[0]&&"tracks"!==e[0]}).map(function(e){return e.join("=")}).join("&"),c.logger.log(s));var a=i.protocol+"//"+i.host+i.pathname+"?",u=!!n||!!o,e=u&&r&&r!==l?"&":"",i=t===l?"":"from="+Math.floor(r);return a+(u?"tracks="+n+o:"")+e+(i=!t?"":i)+((u||r&&r!==l)&&s?"&":"")+s}t.default=n},function(e,t,n){"use strict";
/*!
 * parseurl
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var n=n(10),s=n.parse,a=n.Url;function o(e){var t=e.url;if(void 0!==t){var n=e._parsedUrl;return i(t,n)?n:((n=r(t))._raw=t,e._parsedUrl=n)}}function r(e){if("string"!=typeof e||47!==e.charCodeAt(0))return s(e);for(var t=e,n=null,o=null,r=1;r<e.length;r++)switch(e.charCodeAt(r)){case 63:null===o&&(t=e.substring(0,r),n=e.substring(r+1),o=e.substring(r));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return s(e)}var i=void 0!==a?new a:{};return i.path=e,i.href=e,i.pathname=t,null!==o&&(i.query=n,i.search=o),i}function i(e,t){return"object"==typeof t&&null!==t&&(void 0===a||t instanceof a)&&t._raw===e}e.exports=o,e.exports.original=function(e){var t=e.originalUrl;if("string"!=typeof t)return o(e);var n=e._parsedOriginalUrl;if(i(t,n))return n;return(n=r(t))._raw=t,e._parsedOriginalUrl=n}},function(e,t,n){"use strict";var M=n(11),O=n(14);function E(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=r,t.resolve=function(e,t){return r(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?r(e,!1,!0).resolveObject(t):t},t.format=function(e){O.isString(e)&&(e=r(e));return e instanceof E?e.format():E.prototype.format.call(e)},t.Url=E;var I=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,j=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,t=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),B=["'"].concat(t),A=["%","/","?",";","#"].concat(B),D=["/","?","#"],P=/^[+a-z0-9A-Z_-]{0,63}$/,C=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,L={javascript:!0,"javascript:":!0},R={javascript:!0,"javascript:":!0},U={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=n(15);function r(e,t,n){if(e&&O.isObject(e)&&e instanceof E)return e;var o=new E;return o.parse(e,t,n),o}E.prototype.parse=function(e,t,n){if(!O.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),r=-1!==o&&o<e.indexOf("#")?"?":"#",o=e.split(r);o[0]=o[0].replace(/\\/g,"/");var i=(i=e=o.join(r)).trim();if(!n&&1===e.split("#").length){var s=j.exec(i);if(s)return this.path=i,this.href=i,this.pathname=s[1],s[2]?(this.search=s[2],this.query=t?x.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var a,s=I.exec(i);if(s&&(T=(s=s[0]).toLowerCase(),this.protocol=T,i=i.substr(s.length)),(n||s||i.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(a="//"===i.substr(0,2))||s&&R[s]||(i=i.substr(2),this.slashes=!0)),!R[s]&&(a||s&&!U[s])){for(var u=-1,d=0;d<D.length;d++)-1!==(c=i.indexOf(D[d]))&&(-1===u||c<u)&&(u=c);-1!==(E=-1===u?i.lastIndexOf("@"):i.lastIndexOf("@",u))&&(S=i.slice(0,E),i=i.slice(E+1),this.auth=decodeURIComponent(S));for(var c,u=-1,d=0;d<A.length;d++)-1!==(c=i.indexOf(A[d]))&&(-1===u||c<u)&&(u=c);-1===u&&(u=i.length),this.host=i.slice(0,u),i=i.slice(u),this.parseHost(),this.hostname=this.hostname||"";var l="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!l)for(var h=this.hostname.split(/\./),d=0,f=h.length;d<f;d++){var p=h[d];if(p&&!p.match(P)){for(var m="",g=0,v=p.length;g<v;g++)127<p.charCodeAt(g)?m+="x":m+=p[g];if(!m.match(P)){var y=h.slice(0,d),_=h.slice(d+1),b=p.match(C);b&&(y.push(b[1]),_.unshift(b[2])),_.length&&(i="/"+_.join(".")+i),this.hostname=y.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),l||(this.hostname=M.toASCII(this.hostname));var E=this.port?":"+this.port:"",S=this.hostname||"";this.host=S+E,this.href+=this.host,l&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!L[T])for(d=0,f=B.length;d<f;d++){var w,k=B[d];-1!==i.indexOf(k)&&((w=encodeURIComponent(k))===k&&(w=escape(k)),i=i.split(k).join(w))}l=i.indexOf("#");-1!==l&&(this.hash=i.substr(l),i=i.slice(0,l));var T,l=i.indexOf("?");return-1!==l?(this.search=i.substr(l),this.query=i.substr(l+1),t&&(this.query=x.parse(this.query)),i=i.slice(0,l)):t&&(this.search="",this.query={}),i&&(this.pathname=i),U[T]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(E=this.pathname||"",T=this.search||"",this.path=E+T),this.href=this.format(),this},E.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",o=this.hash||"",r=!1,i="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&O.isObject(this.query)&&Object.keys(this.query).length&&(i=x.stringify(this.query));i=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||U[t])&&!1!==r?(r="//"+(r||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):r=r||"",o&&"#"!==o.charAt(0)&&(o="#"+o),i&&"?"!==i.charAt(0)&&(i="?"+i),t+r+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(i=i.replace("#","%23"))+o},E.prototype.resolve=function(e){return this.resolveObject(r(e,!1,!0)).format()},E.prototype.resolveObject=function(e){O.isString(e)&&((f=new E).parse(e,!1,!0),e=f);for(var t=new E,n=Object.keys(this),o=0;o<n.length;o++){var r=n[o];t[r]=this[r]}if(t.hash=e.hash,""===e.href)return t.href=t.format(),t;if(e.slashes&&!e.protocol){for(var i=Object.keys(e),s=0;s<i.length;s++){var a=i[s];"protocol"!==a&&(t[a]=e[a])}return U[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(e.protocol&&e.protocol!==t.protocol){if(!U[e.protocol]){for(var u=Object.keys(e),d=0;d<u.length;d++){var c=u[d];t[c]=e[c]}return t.href=t.format(),t}if(t.protocol=e.protocol,e.host||R[e.protocol])t.pathname=e.pathname;else{for(var l=(e.pathname||"").split("/");l.length&&!(e.host=l.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==l[0]&&l.unshift(""),l.length<2&&l.unshift(""),t.pathname=l.join("/")}return t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(p=t.pathname||"",m=t.search||"",t.path=p+m),t.slashes=t.slashes||e.slashes,t.href=t.format(),t}var h=t.pathname&&"/"===t.pathname.charAt(0),f=e.host||e.pathname&&"/"===e.pathname.charAt(0),p=f||h||t.host&&e.pathname,m=p,g=t.pathname&&t.pathname.split("/")||[],l=e.pathname&&e.pathname.split("/")||[],h=t.protocol&&!U[t.protocol];if(h&&(t.hostname="",t.port=null,t.host&&(""===g[0]?g[0]=t.host:g.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===l[0]?l[0]=e.host:l.unshift(e.host)),e.host=null),p=p&&(""===l[0]||""===g[0])),f)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,g=l;else if(l.length)(g=g||[]).pop(),g=g.concat(l),t.search=e.search,t.query=e.query;else if(!O.isNullOrUndefined(e.search))return h&&(t.hostname=t.host=g.shift(),(b=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=b.shift(),t.host=t.hostname=b.shift())),t.search=e.search,t.query=e.query,O.isNull(t.pathname)&&O.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t;if(!g.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var v=g.slice(-1)[0],f=(t.host||e.host||1<g.length)&&("."===v||".."===v)||""===v,y=0,_=g.length;0<=_;_--)"."===(v=g[_])?g.splice(_,1):".."===v?(g.splice(_,1),y++):y&&(g.splice(_,1),y--);if(!p&&!m)for(;y--;)g.unshift("..");!p||""===g[0]||g[0]&&"/"===g[0].charAt(0)||g.unshift(""),f&&"/"!==g.join("/").substr(-1)&&g.push("");var b,f=""===g[0]||g[0]&&"/"===g[0].charAt(0);return h&&(t.hostname=t.host=!f&&g.length?g.shift():"",(b=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=b.shift(),t.host=t.hostname=b.shift())),(p=p||t.host&&g.length)&&!f&&g.unshift(""),g.length?t.pathname=g.join("/"):(t.pathname=null,t.path=null),O.isNull(t.pathname)&&O.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes,t.href=t.format(),t},E.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,M,O){!function(f,m){var T;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(){M&&M.nodeType,f&&f.nodeType;var e="object"==typeof m&&m;e.global!==e&&e.window!==e&&e.self;var t,g=2147483647,v=36,y=26,r=38,i=700,n=/^xn--/,o=/[^\x20-\x7E]/,s=/[\x2E\u3002\uFF0E\uFF61]/g,a={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},u=v-1,_=Math.floor,b=String.fromCharCode;function E(e){throw new RangeError(a[e])}function d(e,t){for(var n=e.length,o=[];n--;)o[n]=t(e[n]);return o}function c(e,t){var n=e.split("@"),o="";return 1<n.length&&(o=n[0]+"@",e=n[1]),o+d((e=e.replace(s,".")).split("."),t).join(".")}function S(e){for(var t,n,o=[],r=0,i=e.length;r<i;)55296<=(t=e.charCodeAt(r++))&&t<=56319&&r<i?56320==(64512&(n=e.charCodeAt(r++)))?o.push(((1023&t)<<10)+(1023&n)+65536):(o.push(t),r--):o.push(t);return o}function p(e){return d(e,function(e){var t="";return 65535<e&&(t+=b((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=b(e)}).join("")}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function k(e,t,n){var o=0;for(e=n?_(e/i):e>>1,e+=_(e/t);u*y>>1<e;o+=v)e=_(e/u);return _(o+(u+1)*e/(e+r))}function l(e){var t,n,o,r,i,s,a,u=[],d=e.length,c=0,l=128,h=72,f=e.lastIndexOf("-");for(f<0&&(f=0),n=0;n<f;++n)128<=e.charCodeAt(n)&&E("not-basic"),u.push(e.charCodeAt(n));for(o=0<f?f+1:0;o<d;){for(r=c,i=1,s=v;d<=o&&E("invalid-input"),a=e.charCodeAt(o++),(v<=(a=a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:v)||a>_((g-c)/i))&&E("overflow"),c+=a*i,!(a<(a=s<=h?1:h+y<=s?y:s-h));s+=v)i>_(g/(a=v-a))&&E("overflow"),i*=a;h=k(c-r,t=u.length+1,0==r),_(c/t)>g-l&&E("overflow"),l+=_(c/t),c%=t,u.splice(c++,0,l)}return p(u)}function h(e){for(var t,n,o,r,i,s,a,u,d,c,l=[],h=(e=S(e)).length,f=128,p=72,m=t=0;m<h;++m)(a=e[m])<128&&l.push(b(a));for(n=o=l.length,o&&l.push("-");n<h;){for(r=g,m=0;m<h;++m)f<=(a=e[m])&&a<r&&(r=a);for(r-f>_((g-t)/(u=n+1))&&E("overflow"),t+=(r-f)*u,f=r,m=0;m<h;++m)if((a=e[m])<f&&++t>g&&E("overflow"),a==f){for(i=t,s=v;!(i<(d=s<=p?1:p+y<=s?y:s-p));s+=v)l.push(b(w(d+(c=i-d)%(d=v-d),0))),i=_(c/d);l.push(b(w(i,0))),p=k(t,u,n==o),t=0,++n}++t,++f}return l.join("")}t={version:"1.4.1",ucs2:{decode:S,encode:p},decode:l,encode:h,toASCII:function(e){return c(e,function(e){return o.test(e)?"xn--"+h(e):e})},toUnicode:function(e){return c(e,function(e){return n.test(e)?l(e.slice(4).toLowerCase()):e})}},void 0===(T=function(){return t}.call(M,O,M,f))||(f.exports=T)}()}.call(this,O(12)(e),O(13))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(16),t.encode=t.stringify=n(17)},function(e,t,n){"use strict";e.exports=function(e,t,n,o){n=n||"=";var r={};if("string"!=typeof e||0===e.length)return r;var i=/\+/g;e=e.split(t=t||"&");t=1e3;o&&"number"==typeof o.maxKeys&&(t=o.maxKeys);var s=e.length;0<t&&t<s&&(s=t);for(var a=0;a<s;++a){var u,d=e[a].replace(i,"%20"),c=d.indexOf(n),c=0<=c?(u=d.substr(0,c),d.substr(c+1)):(u=d,""),d=decodeURIComponent(u),c=decodeURIComponent(c);Object.prototype.hasOwnProperty.call(r,d)?l(r[d])?r[d].push(c):r[d]=[r[d],c]:r[d]=c}return r};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function i(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}e.exports=function(n,o,r,e){return o=o||"&",r=r||"=","object"==typeof(n=null===n?void 0:n)?a(u(n),function(e){var t=encodeURIComponent(i(e))+r;return s(n[e])?a(n[e],function(e){return t+encodeURIComponent(i(e))}).join(o):t+encodeURIComponent(i(n[e]))}).join(o):e?encodeURIComponent(i(e))+r+encodeURIComponent(i(n)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var n=[],o=0;o<e.length;o++)n.push(t(e[o],o));return n}var u=Object.keys||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)("/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\n(function () {\n  //Define WebSocket and protocol variables\n  let websocket = null;\n  let mustStop = false;\n\n  //Define based object response to WebSocketController\n  // let onMessage_response = {\n  //   command: 'incomingMsg',\n  //   msg: null,\n  // }\n\n  //Receive message from WebSocketController\n  self.addEventListener(\n    'message',\n    function (e) {\n      let data = e.data;\n      //Get command parameter to identify operation\n      let command = data.command;\n\n      if (command === 'start') {\n        start(data.commandObj); //Establish WebSocket connection\n        // } else if (command === 'logout') {\n        //   sendOMMmessage(data.commandObj)\n        //   disconnect() //Terminate WebSocket connection\n      } else if (command === 'disconnect') {\n        disconnect();\n      } else if (command === 'send') {\n        sendOMMmessage(data.commandObj);\n      }\n    },\n    false\n  );\n\n  /* -----------------  Application events functions  ----------------- */\n\n  //Establish WebSocket connection\n  function start(wsURL) {\n    websocket = new WebSocket(wsURL);\n    websocket.binaryType = 'arraybuffer';\n    websocket.onopen = onOpen;\n    websocket.onmessage = onMessage;\n    websocket.onerror = onError;\n    websocket.onclose = onClose;\n  }\n\n  function disconnect() {\n    if (websocket) {\n      websocket.close();\n    }\n    mustStop = true;\n    const disconnect_response = {\n      command: 'disconnect',\n      msg: 'Disconnected',\n    };\n    self.postMessage(disconnect_response);\n  }\n\n  //Send message to ADS WebSocket\n  function sendOMMmessage(commandObj) {\n    websocket.send(commandObj);\n  }\n\n  /* -----------------  WS events  ----------------- */\n\n  //Establish WebSocket connection success\n  function onOpen() {\n    const onOpen_response = {\n      command: 'connect',\n      msg: 'Connected',\n    };\n    self.postMessage(onOpen_response);\n  }\n\n  //Receives incoming message from WebSocket\n  function onMessage(event) {\n    const rawData = event.data;\n    const isDataAB = rawData instanceof ArrayBuffer;\n    const parsedData = !isDataAB ? JSON.parse(rawData) : void 0;\n    self.postMessage({ rawData, parsedData, isDataAB });\n  }\n\n  function onError(event) {\n    const onError_response = {\n      command: 'error',\n      msg: JSON.stringify(event),\n    };\n    self.postMessage(onError_response);\n  }\n\n  function onClose(e) {\n    if (mustStop) {\n      return;\n    }\n    const { code, reason } = e;\n    const onClose_response = {\n      command: 'close',\n      data: { code, reason },\n    };\n    self.postMessage(onClose_response);\n  }\n})();\n\n\n/***/ })\n/******/ ]);","Worker",void 0,n.p+"ws.worker.js")};var o,r=n(1),i=(o=r)&&o.__esModule?o:{default:o};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),l=n(0),r=n(3),i=n(4);var s="segments",n=(a.prototype.init=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.flushRange=[],this.appended=0,this.mediaSource=e.mediaSource,this.segmentsVideo=[],this.segmentsAudio=[],this.sourceBuffer={},this.audioBufferSize=0,this.videoBufferSize=0,this.totalBytesCollected=0},a.prototype.setMediaSource=function(e){this.mediaSource=e},a.prototype.createSourceBuffers=function(e){var n=this,o=this.sourceBuffer;e.tracks.forEach(function(e){var t=e.content===r.VIDEO;o[e.content]=n.mediaSource.addSourceBuffer(t?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"'),o[e.content].mode=s;e=o[e.content];t?e.addEventListener(i.BUFFER_UPDATE_END,n.onSBUpdateEnd):e.addEventListener(i.BUFFER_UPDATE_END,n.onAudioSBUpdateEnd)})},a.prototype.onSBUpdateEnd=function(){var e,t;this._needsEos&&this.checkEos(),this._needsFlush||!this.segmentsVideo.length||(e=this.sourceBuffer.video)&&(e.updating||(t=this.segmentsVideo[0],e.appendBuffer(t.data),this.segmentsVideo.shift(),this.videoBufferSize=this.videoBufferSize-t.data.byteLength,this.appended++))},a.prototype.onAudioSBUpdateEnd=function(){var e,t;this._needsEos&&this.checkEos(),this._needsFlush||!this.segmentsAudio.length||(e=this.sourceBuffer.audio)&&(e.updating||(t=this.segmentsAudio[0],e.appendBuffer(t.data),this.segmentsAudio.shift(),this.audioBufferSize=this.audioBufferSize-t.data.byteLength,this.appended++))},a.prototype.createTracks=function(e){var n=this;e.forEach(function(e){var t=(0,o.base64ToArrayBuffer)(e.payload),t={type:n.getTypeBytrackId(e.id),isInit:!0,data:t};n.maybeAppend(t)})},a.prototype.maybeAppend=function(e){if(!this._needsFlush){if(!this.media||this.media.error)return"audio"===e.type?this.segmentsAudio=[]:this.segmentsVideo=[],l.logger.error("trying to append although a media error occured, flush segment and abort"),void(this.media.error&&l.logger.error("Error code:",this.media.error));var t=this.sourceBuffer[e.type];t&&(t.updating||(t.appendBuffer(e.data),("audio"===e.type?this.segmentsAudio:this.segmentsVideo).shift(),this.appended++))}},a.prototype.setTracksByType=function(e){var n=this,t=e.tracks?"tracks":"streams";1===e[t].length&&(this.audioTrackId=null),e[t].forEach(function(e,t){n[e.content===r.VIDEO?"videoTrackId":"audioTrackId"]={index:t,id:e.id}})},a.prototype.getTypeBytrackId=function(e){return this.audioTrackId&&this.audioTrackId.id===e?r.AUDIO:r.VIDEO},a.prototype.procArrayBuffer=function(e){e=this.rawDataToSegmnet(e);"audio"===e.type?(this.segmentsAudio.push(e),this.audioBufferSize=this.audioBufferSize+e.data.byteLength):(this.segmentsVideo.push(e),this.videoBufferSize=this.videoBufferSize+e.data.byteLength),this.totalBytesCollected=this.totalBytesCollected+e.data.byteLength,this.doArrayBuffer(e),this.sourceBuffer&&(this.sourceBuffer.video&&!this.sourceBuffer.video.updating&&this.onSBUpdateEnd(),this.audioTrackId&&this.sourceBuffer.audio&&!this.sourceBuffer.audio.updating&&this.onAudioSBUpdateEnd())},a.prototype.seek=function(){for(var e in this.sourceBuffer)this.sourceBuffer[e].abort(),this.sourceBuffer[e].mode=s},a.prototype.isBuffered=function(){var e,t=0,n=this.sourceBuffer;for(e in n)t+=n[e].buffered.length;return 0<t},a.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var o in n)t+=n[o].buffered.length}catch(e){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this._setTracksFlag=!1}},a.prototype.flushBuffer=function(e,t,n){var o,r,i=void 0,s=void 0,a=void 0,u=void 0,d=this.sourceBuffer;if(Object.keys(d).length){if(l.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var c in d)if(!n||c===n){if((i=d[c]).ended=!1,i.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;try{for(s=0;s<i.buffered.length;s++)if(o=i.buffered.start(s),r=i.buffered.end(s),u=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,t):(a=Math.max(o,e),Math.min(r,t)),.5<Math.min(u,r)-a)return this.flushBufferCounter++,l.logger.log("flush "+c+" ["+a+","+u+"], of ["+o+","+r+"], pos:"+this.media.currentTime),i.remove(a,u),!1}catch(e){l.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else l.logger.warn("abort flushing too many retries");l.logger.log("buffer flushed")}return!0},a.prototype.rawDataToSegmnet=function(e){var t=new Uint8Array(e),e=(0,o.getTrackId)(t);return{type:this.getTypeBytrackId(e),data:t}},a.prototype.onBufferEos=function(){var e,t=this.sourceBuffer,n=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type;for(e in t)n&&e!==n||t[e].ended||(t[e].ended=!0,l.logger.log(e+" sourceBuffer now EOS"));this.checkEos()},a.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e){n=e[n];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}l.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},a.prototype.addSourceBuffer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"audio",t=this.sourceBuffer;t[e]=this.mediaSource.addSourceBuffer("video"===e?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"'),t[e].mode=s;t=t[e];"video"===e?t.addEventListener(i.BUFFER_UPDATE_END,this.onSBUpdateEnd):t.addEventListener(i.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd)},a.prototype.removeSourceBuffer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"audio",t=this.sourceBuffer[e];"audio"===e?t.removeEventListener(i.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd):t.removeEventListener(i.BUFFER_UPDATE_END,this.onSBUpdateEnd),this.mediaSource.removeSourceBuffer(t),delete this.sourceBuffer[e]},a.prototype.destroy=function(){this.init()},a);function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),l.logger.log("create BuffersController"),this.media=e.media,this.init(e),this.doArrayBuffer=o.doArrayBuffer.bind(this),this.maybeAppend=this.maybeAppend.bind(this),this.onSBUpdateEnd=this.onSBUpdateEnd.bind(this),this.onAudioSBUpdateEnd=this.onAudioSBUpdateEnd.bind(this)}t.default=n,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)("/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\n(function () {\n  let retroviewURL = null;\n  let sendTime = 60000;\n  let jsonTable = {};\n  let sendingInterval = null;\n\n  self.addEventListener(\n    'message',\n    function (e) {\n      let data = e.data;\n      //Get command parameter to identify operation\n      const { command, commandObj } = data;\n      switch (command) {\n        case 'start':\n          retroviewURL = commandObj;\n          start();\n          break;\n        case 'time':\n          correctSendTime(commandObj);\n          break;\n        case 'stop':\n          stop();\n          break;\n        case 'add':\n          addToTable(commandObj);\n          break;\n        default:\n          break;\n      }\n    },\n    false\n  );\n\n  function correctSendTime(time) {\n    sendTime = time;\n  }\n\n  function start() {\n    sendingInterval = this.setInterval(() => {\n      post();\n    }, sendTime);\n  }\n\n  function stop() {\n    clearInterval(sendingInterval);\n    post();\n  }\n\n  function addToTable(tData) {\n    const { key, data } = tData;\n    if (key in jsonTable) {\n      jsonTable = { ...jsonTable, [key]: { ...jsonTable[key], ...data } };\n    } else {\n      jsonTable = { ...jsonTable, ...tData };\n    }\n    if (data.event && data.event === 'play_stop') {\n      stop();\n    }\n  }\n\n  function roughSizeOfObject(object) {\n    let objectList = [];\n    let stack = [object];\n    let bytes = 0;\n\n    while (stack.length) {\n      let value = stack.pop();\n\n      if (typeof value === 'boolean') {\n        bytes += 4;\n      } else if (typeof value === 'string') {\n        bytes += value.length * 2;\n      } else if (typeof value === 'number') {\n        bytes += 8;\n      } else if (\n        typeof value === 'object' &&\n        objectList.indexOf(value) === -1\n      ) {\n        objectList.push(value);\n\n        for (let i in value) {\n          stack.push(value[i]);\n        }\n      }\n    }\n    return bytes;\n  }\n\n  function post() {\n    console.log('post', {\n      jsonTable,\n      sendTime,\n      tableSize: roughSizeOfObject(jsonTable),\n    });\n  }\n})();\n\n\n/***/ })\n/******/ ]);","Worker",void 0,n.p+"retroview.worker.js")};var o,r=n(1),i=(o=r)&&o.__esModule?o:{default:o};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EVENT_SEGMENT="event",t.MSE_INIT_SEGMENT="mse_init_segment",t.MSE_MEDIA_SEGMENT="mse_media_segment"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={NOT_HTML_MEDIA_ELEMENT:"media should be an HTMLMediaElement instance"},e.exports=t.default}],o={},r.m=n,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5);function r(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var n,o});