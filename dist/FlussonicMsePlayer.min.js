!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FlussonicMsePlayer=t():e.FlussonicMsePlayer=t()}(window,function(){return o={},n.m=r=[function(e,t){e=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(e,t){e=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=e)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.enableLogs=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=r(52);function n(){}var i={trace:n,debug:n,log:n,warn:n,info:n,error:n},s=i;var a=(0,r.getSelfScope)();function u(i){var s=a.console[i];return s?function(){for(var e,t,r=arguments.length,o=Array(r),n=0;n<r;n++)o[n]=arguments[n];o[0]&&(o[0]=(e=i,t=o[0],t="["+e+"] > "+t)),s.apply(a.console,o)}:n}t.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":o(e))){!function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];r.forEach(function(e){s[e]=t[e]?t[e].bind(t):u(e)})}(e,"trace","debug","log","info","warn","error");try{s.log()}catch(e){s=i}}else s=i},t.logger=s},function(e,t,r){var o=r(21),n=r(26);e.exports=r(5)?function(e,t,r){return o.f(e,t,n(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){e.exports=!r(7)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_SOURCE_SOURCE_OPEN:"sourceopen",MEDIA_SOURCE_SOURCE_ENDED:"sourceended",MEDIA_SOURCE_SOURCE_CLOSE:"sourceclose",MEDIA_ELEMENT_PLAY:"play",MEDIA_ELEMENT_PAUSE:"pause",MEDIA_ELEMENT_PROGRESS:"progress",MEDIA_ELEMENT_EMPTIED:"emptied",MEDIA_ELEMENT_SUSPEND:"suspend",MEDIA_ELEMENT_STALLED:"stalled",MEDIA_ELEMENT_WAITING:"waiting",MEDIA_ELEMENT_RATECHANGE:"ratechange",MEDIA_ELEMENT_PLAYING:"playing",WS_OPEN:"open",WS_MESSAGE:"message",WS_ERROR:"error",WS_CLOSE:"close",BUFFER_UPDATE_END:"updateend",BUFFER_ERROR:"onerror",BUFFER_ABORT:"onabort"},e.exports=t.default},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var r=0,o=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+o).toString(36))}},function(e,t,r){var o=r(1),n=r(0),i="__core-js_shared__",s=n[i]||(n[i]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:o.version,mode:r(30)?"pure":"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var i=r(31);e.exports=function(o,n,e){if(i(o),void 0===n)return o;switch(e){case 1:return function(e){return o.call(n,e)};case 2:return function(e,t){return o.call(n,e,t)};case 3:return function(e,t,r){return o.call(n,e,t,r)}}return function(){return o.apply(n,arguments)}}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var o=r(9)("wks"),n=r(8),i=r(0).Symbol,s="function"==typeof i;(e.exports=function(e){return o[e]||(o[e]=s&&i[e]||(s?i:n)("Symbol."+e))}).store=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorMsg=t.replaceHttpByWS=t.checkVideoProgress=void 0,t.getMediaSource=o,t.isAndroid=n,t.isSupportedMSE=function(){if(n())return!1;var e=o(),t=window.SourceBuffer||window.WebKitSourceBuffer,e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.4d401f,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!e&&!!t},t.base64ToArrayBuffer=function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})},t.RawDataToUint8Array=function(e){return new Uint8Array(e)},t.getTrackId=i,t.getRealUtcFromData=s,t.doArrayBuffer=function(e){e.isInit||(this.utc=s(e.data),this.lastLoadedUTC=this.utc)},t.debugData=a,t.pad2=c,t.humanTime=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(!(0<e))return"";var r=e,o=new Date;o.setTime(1e3*r);e=!(!1===t),r=e?o.getHours():o.getUTCHours(),t=e?o.getMinutes():o.getUTCMinutes(),o=e?o.getSeconds():o.getUTCSeconds();return c(r)+":"+c(t)+":"+c(o)},t.logDM=function(e,t){t&&l.logger.log("%c "+t.type+" "+("event"===t.type?t.event:"mse_init_segment"),"background: aquamarine;",t)},t.showDispatchError=function(e,t){var r=e.data instanceof ArrayBuffer;console.error(u(e),t),this.media&&this.media.error&&console.error("MediaError:",this.media.error);r&&console.error("Data:",a(e.data));++h>=this.opts.errorsBeforeStop&&(h=0,this.stopPromise=this.stop());this.onError&&this.onError(t,e)};var l=r(3);function o(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function n(){return-1!==navigator.userAgent.indexOf("Android")}function i(e){return e[47]}function s(e){return(e[92]<<24|e[93]<<16|e[94]<<8|e[95])+(e[96]<<24|e[97]<<16|e[98]<<8|e[99])/1e6}function a(e){e=new Uint8Array(e);return{trackId:e[47],utc:s(e),view:e}}t.checkVideoProgress=function(d,f){return function(e){var t,r=d.currentTime,o=d.buffered,n=d.buffered.length;if(f)for(var i=f.sb.sourceBuffer,s=Object.keys(i),a=r-30,u=s.length-1;0<=u;u--){var c=s[u],h=i[c];!h||0<(c=h.buffered).length&&a>c.start(0)&&(function(e,t,r){try{for(var o=0;o<e.buffered.length;o++){var n=e.buffered.start(o),i=e.buffered.end(o),s=Math.max(n,t),n=Math.min(i,r);if(.5<Math.min(n,i)-s){return(d&&d.currentTime.toString(),e.updating)||e.remove(s,n)}}}catch(e){l.logger.warn("removeBufferRange failed",e)}}(h,0,a),0)}f.media.readyState<=2&&2===f.media.networkState?f.onStartStalling():2<f.media.readyState&&f.onEndStalling(),n&&(t=o.end(n-1),o=Math.abs(t-r),f.onStats&&f.onStats({timestamp:Date.now(),appended:f.sb.appended,videoBuffer:f.sb.videoBufferSize,audioBuffer:f.sb.audioBufferSize,currentTime:r,endTime:t,readyState:f.media.readyState,networkState:f.media.networkState}),o<=f.opts.maxBufferDelay||(l.logger.log("nudge",r,"->",n?t:"-",r-t),d.currentTime=t-.2))}},t.replaceHttpByWS=function(e){return e.replace(/^http/,"ws")};var u=t.errorMsg=function(e){return"Error "+e.name+": "+e.message+"\n"+e.stack};function c(e){return e<=9?"0"+e:""+e}var h=0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VIDEO="video",t.AUDIO="audio"},function(e,t,r){e.exports=r(16)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=r(17),r=(o=n)&&o.__esModule?o:{default:o};t.default=r.default,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,o=arguments[t];for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},o=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}r(18);var i=p(r(42)),s=p(r(53)),u=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(r(13)),h=r(3),c=r(54),d=r(14),f=p(r(6)),l=p(r(55));function p(e){return e&&e.__esModule?e:{default:e}}var m=!1,g=!1,v=d.VIDEO,y=d.AUDIO,E=1,S=100,b=0,_=!1,w=2,o=(T.replaceHttpByWS=function(e){return u.replaceHttpByWS(e)},T.isSupported=function(){return u.isSupportedMSE()},o(T,null,[{key:"version",get:function(){return"20.12.2"}}]),T.prototype.play=function(e,t){var r=this;if(h.logger.log("[mse-player]: play()"),this.playing)h.logger.log("MSE is already playing");else{if(!this.ws||!this.ws.websocket||this._pause)return this._play(e,t).then(function(){r.playing=!0,r._stop=!1}).catch(function(){r.playing=!1});h.logger.log("[mse-player]: websocket already opened")}},T.prototype.stop=function(){var e=this;this.playPromise?this.playPromise.catch(function(){return e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),e._stop?void h.logger.log("[mse-player]: already stopped"):e.onMediaDetaching()}).finally(function(){return e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),e._stop?void h.logger.log("[mse-player]: already stopped"):e.onMediaDetaching()}):h.logger.log("[mse-player]: no playPromise exists, nothing to stop")},T.prototype.pause=function(){if(!function(){return!(!(!this._pause&&this.playing&&this.media&&this.ws&&this.mediaSource)||this.mediaSource&&"open"!==this.mediaSource.readyState||!this.playPromise)}.bind(this)())return h.logger.log("[mse:playback] can not do pause");var e=function(){if(this.ws.pause(),this.media.pause(),this._pause=!0,this.playing=!1,this.onPause)try{this.onPause()}catch(e){console.error("Error "+e.name+":"+e.message+"\n"+e.stack)}}.bind(this);this.playPromise.then(e,e).catch(e,e)},T.prototype.restart=function(e){e=!(0<arguments.length&&void 0!==e)||e?void 0:this.sb.lastLoadedUTC;this.playing=!1,this.ws.destroy(),this.ws.init(),this.ws.start(this.url,e,this.videoTrack,this.audioTrack),this.onEndStalling()},T.prototype.retryConnection=function(e,t){var r=this,e=0<arguments.length&&void 0!==e?e:null,t=1<arguments.length&&void 0!==t?t:null;this.retry>=this.opts.connectionRetries?clearInterval(this.retryConnectionTimer):(h.logger.log("%cconnectionRetry:","background: orange;","Retrying "+(this.retry+1)),this.mediaSource=void 0,this.init(),this.ws.destroy(),this.sb.destroy(),this.play(e,t).then(function(){r.onEndStalling()}),this.retry=this.retry+1)},T.prototype.setTracks=function(e){var r,t,o,n,i=this;this.mediaInfo?(Array.isArray(e)||h.logger.error('tracks should be an Array instance: ["v1", "a1"]'),r=this.mediaInfo.streams?"streams":"tracks",t=e.filter(function(t){var e=i.mediaInfo[r].find(function(e){return t===e.track_id});return!!e&&e.content===v}).join(""),(o=e.filter(function(t){var e=i.mediaInfo[r].find(function(e){return t===e.track_id});return e?!!e&&e.content===y:null}).join(""))||t||(h.logger.warn("No such stream tracks! Setting to default parameters"),n=this.getVideoTracks(),(e=this.getAudioTracks()).length?o=e[0].track_id:h.logger.warn("No audio tracks"),n.length?t=n[0].track_id:h.logger.warn("No video tracks")),o||(this.sb.sourceBuffer.audio&&this.sb.removeSourceBuffer(),this.media.muted=!0,h.logger.warn("No audio tracks")),t&&o&&this.mediaSource.sourceBuffers.length<=1&&(this.stop(),this.media.muted=!1,this.play()),this.onStartStalling(),this.ws.setTracks(t,o),this.videoTrack=t,this.audioTrack=o,this._setTracksFlag=!0,this.waitForInitFrame=!0):h.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},T.prototype.autoTrackSelection=function(e){if(this.mediaInfo){var t,r,o,n,i,s=this.getVideoTracks(),a=this.getAudioTracks(),u=void 0,c=void 0;return e?(r=t=void 0,s[0].bitrate?r="bitrate":s[0].pixel_width&&(r="pixel_width"),t=s[0][r],u=s[0].track_id,s.forEach(function(e){e[r]>t&&(t=e[r],u=e.track_id)}),a.length&&(a[0].sample_rate,c=a[0].track_id,a.forEach(function(e){e.sample_rate>t&&(e.sample_rate,c=e.track_id)}))):(n=o=void 0,s[0].bitrate?n="bitrate":s[0].pixel_width&&(n="pixel_width"),o=s[0][n],u=s[0].track_id,s.forEach(function(e){e[n]<o&&(o=e[n],u=e.track_id)}),a.length&&(i=void 0,i=a[0].sample_rate,c=a[0].track_id,a.forEach(function(e){e.sample_rate<i&&(i=e.sample_rate,c=e.track_id)}))),[u,c]}h.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},T.prototype._play=function(o,n){var i=this;return this.liveError=!1,new Promise(function(e,t){if(h.logger.log("_play",o,n),i.playing){var r="[mse-player] _play: terminate because already has been playing";return h.logger.log(r),e({message:r})}if(i._pause)return i.ws&&!1===i.ws.opened?(h.logger.log("WebSocket Closed, trying to restart it"),i._pause=!1,void i.restart(!0)):(h.logger.log("WebSocket is in opened state, resuming"),i._pause=!1,i._resume(),i.playPromise=i.media.play(),h.logger.log("_play: terminate because _paused and should resume"),i.playPromise);if(i.videoTrack=o,i.audioTrack=n,i._pause=!1,i.mediaSource||i.onAttachMedia({media:i.media}).then(function(){i.onsoa=i._play.bind(i,o,n),i.sb.setMediaSource(i.mediaSource),i.mediaSource.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,i.onsoa),h.logger.warn("mediaSource did not create"),i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t}),i.mediaSource&&"open"!==i.mediaSource.readyState)return h.logger.warn('readyState is not "open", it\'s currently ',i.mediaSource.readyState),i.shouldPlay=!0,i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,void(i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t);new Promise(function(e,t){return!i.media.autoplay||!0===i.media.muted||i.opts.retryMuted?e():!i.onAutoplay||function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod","Safari"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?(i.media.muted=!0,e()):void i.onAutoplay(function(){return i.media.muted=!1,e()})}).then(function(){i.ws.start(i.url,i.playTime,i.videoTrack,i.audioTrack).then(function(){return i.playPromise=i.media.play(),i.playPromise.then(function(){i.onStartStalling(),i.startProgressTimer(),i.resolveThenMediaSourceOpen&&(i._stop=!1,i.resolveThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0,clearInterval(i.retryConnectionTimer),i.retry=0)}).catch(function(e){h.logger.log("playPromise rejection.",e),i.ws.connectionPromise&&i.ws.connectionPromise.then(function(){return i.ws.destroy()}),i.opts.retryMuted&&0==i.media.muted&&(i.onMuted&&i.onMuted(),i.media.muted=!0,i._play(o,n)),i.onError&&i.onError({error:"play_promise_reject",err:e}),i.rejectThenMediaSourceOpen&&(i.rejectThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0),i.opts.retryMuted||i.stop()}),i.playPromise})})})},T.prototype.init=function(){this._pause=!1,this.playing=!1,this.shouldPlay=!1,this.audioTrack="",this.videoTrack="",this.endProgressTimer()},T.prototype._resume=function(){this.ws.resume()},T.prototype.onMediaDetaching=function(){var e=this;if(this.stopRunning)h.logger.warn("stop is running.");else{if(this.stopRunning=!0,this.handlerMediaDetaching.bind(this),!this.playPromise)return this.handlerMediaDetaching();this.playPromise.catch(function(){return e.handlerMediaDetaching()}).finally(function(){return e.handlerMediaDetaching()})}},T.prototype.handlerMediaDetaching=function(){var r=this;return h.logger.info("media source detaching"),new Promise(function(e,t){if(r.removeMediaSource(),!r.media)return t("no media to detach");r.media.removeEventListener(f.default.MEDIA_ELEMENT_PROGRESS,r.oncvp),r.media.removeEventListener(f.default.MEDIA_ELEMENT_SUSPEND,r.errorLog),r.media.removeEventListener(f.default.MEDIA_ELEMENT_STALLED,r.errorLog),r.media.removeEventListener(f.default.MEDIA_ELEMENT_RATECHANGE,r.errorLog),r.media.removeEventListener(f.default.MEDIA_ELEMENT_PLAYING,r.loadingIndication),r.media.removeEventListener(f.default.MEDIA_ELEMENT_WAITING,r.loadingIndication),r.oncvp=null,r.errorLog=null,r.mediaSource=null,r.init(),r.ws.destroy(),r.sb.destroy(),r.media.onemptied=function(){return h.logger.log("[mse-player]: media emptied"),r.stopRunning=!1,r._stop=!0,delete r.playPromise,e()}})},T.prototype.removeMediaSource=function(){var e=this,t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(e){h.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),this.onmso=null,this.onmse=null,this.onmsc=null}function r(){e.media.src="",e.media.load(),e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0)}this.playPromise&&this.playPromise.then(function(){r()}).catch(function(){r()})},T.prototype.onMediaElementEmptied=function(e){return this.onMediaElementEmptied&&this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_EMPTIED,this.onMediaElementEmptied),this._onmee=void 0),e},T.prototype.onAttachMedia=function(e){var t=this;this.media=e.media;e=this.media;if(!(e instanceof HTMLMediaElement))throw new Error(l.default.NOT_HTML_MEDIA_ELEMENT);if(e){var r=this.mediaSource=new MediaSource;if(this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),r.addEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),e.src=URL.createObjectURL(r),this.eventLog=function(e){t.onEvent&&t.onEvent(e)},this.oncvp=u.checkVideoProgress(e,this).bind(this),this.media.addEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),this.media.addEventListener(f.default.MEDIA_ELEMENT_STALLED,this.eventLog),this.media.addEventListener(f.default.MEDIA_ELEMENT_SUSPEND,this.eventLog),this.media.addEventListener(f.default.MEDIA_ELEMENT_RATECHANGE,this.eventLog),this.media.addEventListener(f.default.MEDIA_ELEMENT_PLAYING,this.loadingIndication.bind(this)),this.media.addEventListener(f.default.MEDIA_ELEMENT_WAITING,this.loadingIndication.bind(this)),!this.liveError)return new Promise(function(e){t.onmso=t.onMediaSourceOpen.bind(t,e),r.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,t.onmso)});this.player=void 0}},T.prototype.onMediaSourceOpen=function(e){e();e=this.mediaSource;e&&e.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),URL.revokeObjectURL(this.media.src),this.shouldPlay&&(this.shouldPlay=!1,h.logger.info("readyState now is "+this.mediaSource.readyState+", and will be played",this.audioTrack,this.videoTrack),this._play(this.audioTrack,this.videoTrack))},T.prototype.onDisconnect=function(e){this.opts.onDisconnect&&this.opts.onDisconnect(e)},T.prototype.dispatchMessage=function(t){var e=this;if(!this.stopRunning){var r,o=t.data,n=o instanceof ArrayBuffer,i=n?void 0:JSON.parse(o),s=Date.now()-this.messageTime;this.messageTime=Date.now(),this.opts.onMessage&&this.opts.onMessage({utc:Date.now(),messageTimeDiff:s});try{if(n){if(this.waitForInitFrame)return h.logger.log("old frames");this.sb.procArrayBuffer(o)}if(i&&i.type===c.EVENT_SEGMENT){var a=i[c.EVENT_SEGMENT];switch(h.logger.log("%c "+i.type+" "+("event"===i.type?i.event:"mse_init_segment"),"background: aquamarine;",i),a){case"resumed":this._pause&&!this.playing&&this.onStartStalling(),this.onResume&&this.onResume();break;case"paused":break;case"seeked":case"switched_to_live":if(this.seekValue=void 0,this.opts.onSeeked)try{this.opts.onSeeked()}catch(e){console.error(e)}break;case"recordings_ended":this._eos=!0,this.sb.onBufferEos();break;case"stream_unavailable":i.hasOwnProperty("static")&&0==i.static?(h.logger.info("Stream is on on demand mode, waiting for init segment"),this.onStartStalling()):(h.logger.warn("do playPromise reject with error"),this.ws.connectionPromise&&this.ws.connectionPromise.then(function(){return e.ws.pause()}),this.liveError||(this.opts.onError&&this.opts.onError({error:"playPromise reject - stream unavaible"}),this.liveError=!0),this.rejectThenMediaSourceOpen&&(this.rejectThenMediaSourceOpen(),this.resolveThenMediaSourceOpen=void 0,this.rejectThenMediaSourceOpen=void 0),this.playPromise=Promise.reject("stream unavaible"),this.mediaSource.endOfStream());break;case"tracks_switched":break;default:this.opts.onEvent&&this.opts.onEvent({error:"unhandled_event",event:a}),h.logger.warn("unknown type of event",a)}return}if(i&&i.type===c.MSE_INIT_SEGMENT)return this.procInitSegment(o)}catch(e){u.showDispatchError.bind(this)(t,e);try{this.mediaInfo&&this.mediaInfo.activeStreams&&(r=this.mediaInfo.activeStreams,this.setTracks([r.video||"",r.audio||""]))}catch(e){this.ws.pause()}}}},T.prototype.procInitSegment=function(e){var r=this,t=JSON.parse(e);if(t.type!==c.MSE_INIT_SEGMENT)return h.logger.warn("type is not "+c.MSE_INIT_SEGMENT);this.waitForInitFrame&&(this.waitForInitFrame=!1),this.sb.isBuffered()&&(this.sb.doFlush(),this.sb.seek()),this.sb.setTracksByType(t);var o=a({},t.metadata,{tracks:t.metadata.streams||t.metadata.tracks,streams:t.metadata.streams||t.metadata.tracks}),n=t.metadata.streams;t.metadata.tracks&&(n=t.metadata.tracks);var i={},e=this.sb.videoTrackId&&this.sb.videoTrackId.id-1;if(n[e]&&n[e].track_id){if(n[e].bitrate&&0===n[e].bitrate||0===n[e].height||0===n[e].width)return void(this.onError&&this.onError({error:"Video track error"}));i.video=n[e].track_id}var s,e=this.sb.audioTrackId&&this.sb.audioTrackId.id-1;e&&n[e]&&n[e].track_id&&(n[e].bitrate&&0===n[e].bitrate?(this.onError&&this.onError({error:"Audio track error"}),s=void 0,t.tracks.forEach(function(e,t){e.id===r.sb.audioTrackId.id&&(s=t)}),t.tracks.splice(s,1),this.sb.sourceBuffer.audio&&(this.mediaSource.removeSourceBuffer(this.sb.sourceBuffer.audio),delete this.sb.sourceBuffer.audio)):i.audio=n[e].track_id),this.doMediaInfo(a({},o,{activeStreams:i,version:T.version})),h.logger.log("%cprocInitSegment:","background: lightpink;",t),this.mediaSource&&!this.mediaSource.sourceBuffers.length&&(this.sb.setMediaSource(this.mediaSource),this.sb.createSourceBuffers(t)),this.liveError||this.sb.createTracks(t.tracks),!this.opts.preferHQ||(t=this.autoTrackSelection(!0))[0]!==i.video&&this.setTracks(t)},T.prototype.doMediaInfo=function(e){if(h.logger.log("%cmediaInfo:","background: orange;",e),this.mediaInfo=e,this.onMediaInfo)try{this.onMediaInfo(e)}catch(e){console.error(u.errorMsg(e))}},T.prototype.getVideoTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===v})}},T.prototype.getAudioTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===y})}},T.prototype.immediateLevelSwitchEnd=function(){var e=this,t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,this.previouslyPaused||(this.playPromise=t.play(),this.playPromise.then(function(){e._pause=!1,e.playing=!0})))},T.prototype.onStartStalling=function(){var e=this;this.resetTimer||(this.resetTimer=setTimeout(function(){e.restart()},6e4)),this._stalling||(this.opts.onStartStalling&&this.opts.onStartStalling(),this._stalling=!0,h.logger.log("onStartStalling"))},T.prototype.onEndStalling=function(){this._stalling&&(this.opts.onEndStalling&&this.opts.onEndStalling(),this._stalling=!1,h.logger.log("onEndStalling"),clearTimeout(this.resetTimer),this.resetTimer=void 0)},T.prototype.startProgressTimer=function(){this.timer=setInterval(this.onTimer.bind(this),this.opts.progressUpdateTime)},T.prototype.endProgressTimer=function(){clearInterval(this.timer),this.timer=void 0},T.prototype.onTimer=function(){if(this._eos)return h.logger.log("nothing to play");if(this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.sb.lastLoadedUTC!==this.utcPrev&&!this._stalling&&(this.utcPrev=this.sb.lastLoadedUTC,this.onProgress))try{this.onProgress(this.sb.lastLoadedUTC)}catch(e){console.error(u.errorMsg(e))}},T.prototype.onMediaSourceEnded=function(){h.logger.log("media source ended");try{this.opts.onEOS&&this.opts.onEOS()}catch(e){console.error("error while proccessing onEOS")}},T.prototype.onMediaSourceClose=function(){h.logger.log("media source closed")},T.prototype.onConnectionRetry=function(){var e=this;this.retryConnectionTimer||this._stop?this.retry>=this.opts.connectionRetries&&clearInterval(this.retryConnectionTimer):this.retry<this.opts.connectionRetries&&(this.retryConnectionTimer=setInterval(function(){return e.retryConnection()},5e3))},T.prototype.loadingIndication=function(e){e=e.type;"playing"===e?(this.playing=!0,this.onEndStalling()):"waiting"===e&&(this.playing=!1,this.onStartStalling())},T.prototype.debounce=function(o,n,i){var s;return function(){var e=this,t=arguments,r=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||o.apply(e,t)},n),r&&o.apply(e,t)}},T);function T(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,T),r.debug&&((0,h.enableLogs)(!0),window.humanTime=u.humanTime),h.logger.info("[mse-player]:",T.version),this.opts=r||{},this.media=e,this.url=t,this.opts.progressUpdateTime=this.opts.progressUpdateTime||S,this.opts.errorsBeforeStop=this.opts.errorsBeforeStop||E,"number"!=typeof this.opts.errorsBeforeStop||isNaN(this.opts.errorsBeforeStop))throw new Error("invalid errorsBeforeStop param, should be number");if(this.opts.connectionRetries=this.opts.connectionRetries||b,"number"!=typeof this.opts.connectionRetries||isNaN(this.opts.connectionRetries))throw new Error("invalid connectionRetries param, should be number");if(this.opts.wsReconnect=this.opts.wsReconnect||m,"boolean"!=typeof this.opts.wsReconnect)throw new Error("invalid wsReconnect param, should be boolean");if(this.opts.preferHQ=this.opts.preferHQ||g,"boolean"!=typeof this.opts.preferHQ)throw new Error("invalid preferHQ param, should be boolean");if(this.retry=0,this.retryConnectionTimer,this.opts.retryMuted=this.opts.retryMuted||_,"boolean"!=typeof this.opts.retryMuted)throw new Error("invalid retryMuted param, should be boolean");this.opts.maxBufferDelay=this.opts.maxBufferDelay||w;t=navigator.userAgent;if((/Edge/.test(t)||/trident.*rv:1\d/i.test(t))&&(this.opts.maxBufferDelay=10),"number"!=typeof this.opts.maxBufferDelay)throw new Error("invalid maxBufferDelay param, should be number");this.onProgress=r&&r.onProgress,r&&r.onDisconnect?this.onDisconnect=r&&r.onDisconnect:this.onDisconnect=function(e){h.logger.log("[websocket status]:",e)},this.onMediaInfo=r&&r.onMediaInfo,this.onError=r&&r.onError,this.onEvent=r&&r.onEvent,this.onAutoplay=r&&r.onAutoplay,this.onMuted=r&&r.onMuted,this.onStats=r&&r.onStats,this.onMessage=r&&r.onMessage,this.onPause=r&&r.onPause,this.onResume=r&&r.onResume,this.init(),e instanceof HTMLMediaElement&&(e.WebKitPlaysInline=!0,e.controls=!1),this.ws=new i.default({message:this.dispatchMessage.bind(this),closed:this.onDisconnect.bind(this),error:this.onError,wsReconnect:this.opts.wsReconnect}),this.sb=new s.default({media:e}),this.messageTime=Date.now()}t.default=o,e.exports=t.default},function(e,t,r){r(19),e.exports=r(1).Array.find},function(e,t,r){"use strict";var o=r(20),n=r(32)(5),i="find",s=!0;i in[]&&Array(1)[i](function(){s=!1}),o(o.P+o.F*s,"Array",{find:function(e,t){return n(this,e,1<arguments.length?t:void 0)}}),r(41)(i)},function(e,t,r){var p=r(0),m=r(1),g=r(4),v=r(27),y=r(10),E="prototype",S=function(e,t,r){var o,n,i,s=e&S.F,a=e&S.G,u=e&S.S,c=e&S.P,h=e&S.B,d=a?p:u?p[t]||(p[t]={}):(p[t]||{})[E],f=a?m:m[t]||(m[t]={}),l=f[E]||(f[E]={});for(o in a&&(r=t),r)n=((i=!s&&d&&void 0!==d[o])?d:r)[o],i=h&&i?y(n,p):c&&"function"==typeof n?y(Function.call,n):n,d&&v(d,o,n,e&S.U),f[o]!=n&&g(f,o,i),c&&l[o]!=n&&(l[o]=n)};p.core=m,S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,e.exports=S},function(e,t,r){var o=r(22),n=r(23),i=r(25),s=Object.defineProperty;t.f=r(5)?Object.defineProperty:function(e,t,r){if(o(e),t=i(t,!0),o(r),n)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var o=r(2);e.exports=function(e){if(!o(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){e.exports=!r(5)&&!r(7)(function(){return 7!=Object.defineProperty(r(24)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var o=r(2),n=r(0).document,i=o(n)&&o(n.createElement);e.exports=function(e){return i?n.createElement(e):{}}},function(e,t,r){var n=r(2);e.exports=function(e,t){if(!n(e))return e;var r,o;if(t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if(!t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var i=r(0),s=r(4),a=r(28),u=r(8)("src"),o=r(29),n="toString",c=(""+o).split(n);r(1).inspectSource=function(e){return o.call(e)},(e.exports=function(e,t,r,o){var n="function"==typeof r;n&&(a(r,"name")||s(r,"name",t)),e[t]!==r&&(n&&(a(r,u)||s(r,u,e[t]?""+e[t]:c.join(String(t)))),e===i?e[t]=r:o?e[t]?e[t]=r:s(e,t,r):(delete e[t],s(e,t,r)))})(Function.prototype,n,function(){return"function"==typeof this&&this[u]||o.call(this)})},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){e.exports=r(9)("native-function-to-string",Function.toString)},function(e,t){e.exports=!1},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var E=r(10),S=r(33),b=r(34),_=r(36),o=r(38);e.exports=function(d,e){var f=1==d,l=2==d,p=3==d,m=4==d,g=6==d,v=5==d||g,y=e||o;return function(e,t,r){for(var o,n,i=b(e),s=S(i),a=E(t,r,3),u=_(s.length),c=0,h=f?y(e,u):l?y(e,0):void 0;c<u;c++)if((v||c in s)&&(n=a(o=s[c],c,i),d))if(f)h[c]=n;else if(n)switch(d){case 3:return!0;case 5:return o;case 6:return c;case 2:h.push(o)}else if(m)return!1;return g?-1:p||m?m:h}}},function(e,t,r){var o=r(11);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==o(e)?e.split(""):Object(e)}},function(e,t,r){var o=r(35);e.exports=function(e){return Object(o(e))}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var o=r(37),n=Math.min;e.exports=function(e){return 0<e?n(o(e),9007199254740991):0}},function(e,t){var r=Math.ceil,o=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?o:r)(e)}},function(e,t,r){var o=r(39);e.exports=function(e,t){return new(o(e))(t)}},function(e,t,r){var o=r(2),n=r(40),i=r(12)("species");e.exports=function(e){var t;return n(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!n(t.prototype)||(t=void 0),o(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var o=r(11);e.exports=Array.isArray||function(e){return"Array"==o(e)}},function(e,t,r){var o=r(12)("unscopables"),n=Array.prototype;null==n[o]&&r(4)(n,o,{}),e.exports=function(e){n[o][e]=!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWSURL=u;var c=o(r(43)),a=o(r(6)),h=r(3);function o(e){return e&&e.__esModule?e:{default:e}}var d="live",r=(n.prototype.init=function(){this.websocket&&delete this.websocket,this.opened=!1,this.connectionPromise=void 0,clearTimeout(this.reconnect),this.reconnect=void 0},n.prototype.start=function(o,e,t,r){var n=this,i=2<arguments.length&&void 0!==t?t:"",s=3<arguments.length&&void 0!==r?r:"";return this.socketURL={url:o,time:e,videoTrack:i,audioTack:s},this.connectionPromise=new Promise(function(e,t){var r=u(o,0,i,s);n.websocket=new WebSocket(r),n.websocket.binaryType="arraybuffer",n.websocket.addEventListener(a.default.WS_OPEN,n.onwso),n.websocket.addEventListener(a.default.WS_MESSAGE,n.onwsm),n.websocket.addEventListener(a.default.WS_ERROR,n.onwse),n.websocket.addEventListener(a.default.WS_CLOSE,n.onwsc),n._openingResolve=e,n._openingReject=t}),this.connectionPromise},n.prototype.open=function(){this.opened=!0,this.paused=!0,this._openingResolve(),this.resume(),this.websocket.removeEventListener(a.default.WS_OPEN,this.onwso)},n.prototype.send=function(e){this.websocket.send(e)},n.prototype.resume=function(){var e=this;if(clearTimeout(this.reconnect),h.logger.log("ws: send resume"),0===this.websocket.readyState)return setTimeout(function(){return e.resume()},500);this.websocket.send("resume"),this.paused=!1},n.prototype.pause=function(){h.logger.log("ws: send pause"),1===this.websocket.readyState&&(this.websocket.send("pause"),this.paused=!0)},n.prototype.seek=function(e){var t=e===d?"":"play_from=";h.logger.log(t+e),this.websocket.send(t+e)},n.prototype.setTracks=function(e,t){t=1<arguments.length&&void 0!==t?t:null;this.websocket.send("set_tracks="+e+t)},n.prototype.handleReceiveMessage=function(e){this.opts.message(e)},n.prototype.handleError=function(){var e;this.opts.error&&(e=this.opts).error.apply(e,arguments)},n.prototype.onWSClose=function(e){var t,r,o,n,i=this;h.logger.log("WebSocket lost connection with code ",e.code+" and reason: "+e.reason),this.opts.error&&this.opts.error({error:"WebSocket lost connection",err:"WebSocket lost connection with code "+e.code+" and reason: "+e.reason,code:e.code}),this.opts.wsReconnect&&(e.wasClean&&1e3!==e.code&&1006!==e.code?(h.logger.log("Clean websocket stop"),this.destroy()):(t=this.socketURL,r=t.url,o=t.videoTrack,n=t.audioTack,this.reconnect=setTimeout(function(){i.start(r,o,n).then(function(){clearTimeout(i.reconnect)}).catch(function(){i.destroy()})},5e3))),this.opts.closed&&this.opts.closed(e)},n.prototype.destroy=function(){this.websocket&&(this.websocket.removeEventListener(a.default.WS_MESSAGE,this.onwsm),this.websocket.removeEventListener(a.default.WS_CLOSE,this.onwsc),this.websocket.close(),this.websocket.onclose=void 0,this.websocket=void 0,clearTimeout(this.reconnect),this.reconnect=void 0,this.init())},n);function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.opts=e,this.init(),this.onwso=this.open.bind(this),this.onwsm=this.handleReceiveMessage.bind(this),this.onwse=this.handleError.bind(this),this.onwsc=this.onWSClose.bind(this)}function u(e,t,r,o){var n=t=d;if(!n&&!r&&!o)return e;var i=(0,c.default)({url:e}),s="";i.query&&(s=i.query.split("&").map(function(e){return e.split("=")}).filter(function(e){return"from"!==e[0]&&"tracks"!==e[0]}).map(function(e){return e.join("=")}).join("&"),h.logger.log(s));var a=i.protocol+"//"+i.host+i.pathname+"?",u=!!r||!!o,e=u&&n&&n!==d?"&":"",i=t===d?"":"from="+Math.floor(n);return t||(i=""),a+(u?"tracks="+r+o:"")+e+i+((u||n&&n!==d)&&s?"&":"")+s}t.default=r},function(e,t,r){"use strict";
/*!
 * parseurl
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var r=r(44),s=r.parse,a=r.Url;function o(e){var t=e.url;if(void 0!==t){var r=e._parsedUrl;return i(t,r)?r:((r=n(t))._raw=t,e._parsedUrl=r)}}function n(e){if("string"!=typeof e||47!==e.charCodeAt(0))return s(e);for(var t=e,r=null,o=null,n=1;n<e.length;n++)switch(e.charCodeAt(n)){case 63:null===o&&(t=e.substring(0,n),r=e.substring(n+1),o=e.substring(n));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return s(e)}var i=void 0!==a?new a:{};return i.path=e,i.href=e,i.pathname=t,null!==o&&(i.query=r,i.search=o),i}function i(e,t){return"object"==typeof t&&null!==t&&(void 0===a||t instanceof a)&&t._raw===e}e.exports=o,e.exports.original=function(e){var t=e.originalUrl;if("string"!=typeof t)return o(e);var r=e._parsedOriginalUrl;if(i(t,r))return r;return(r=n(t))._raw=t,e._parsedOriginalUrl=r}},function(e,t,r){"use strict";var k=r(45),O=r(48);function b(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=n,t.resolve=function(e,t){return n(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?n(e,!1,!0).resolveObject(t):t},t.format=function(e){O.isString(e)&&(e=n(e));return e instanceof b?e.format():b.prototype.format.call(e)},t.Url=b;var A=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,I=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,t=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),P=["'"].concat(t),B=["%","/","?",";","#"].concat(P),D=["/","?","#"],L=/^[+a-z0-9A-Z_-]{0,63}$/,R=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,U={javascript:!0,"javascript:":!0},j={javascript:!0,"javascript:":!0},x={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},N=r(49);function n(e,t,r){if(e&&O.isObject(e)&&e instanceof b)return e;var o=new b;return o.parse(e,t,r),o}b.prototype.parse=function(e,t,r){if(!O.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),n=-1!==o&&o<e.indexOf("#")?"?":"#",o=e.split(n);o[0]=o[0].replace(/\\/g,"/");var i=(i=e=o.join(n)).trim();if(!r&&1===e.split("#").length){var s=I.exec(i);if(s)return this.path=i,this.href=i,this.pathname=s[1],s[2]?(this.search=s[2],this.query=t?N.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var a,s=A.exec(i);if(s&&(M=(s=s[0]).toLowerCase(),this.protocol=M,i=i.substr(s.length)),(r||s||i.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(a="//"===i.substr(0,2))||s&&j[s]||(i=i.substr(2),this.slashes=!0)),!j[s]&&(a||s&&!x[s])){for(var u=-1,c=0;c<D.length;c++){-1!==(h=i.indexOf(D[c]))&&(-1===u||h<u)&&(u=h)}-1!==(b=-1===u?i.lastIndexOf("@"):i.lastIndexOf("@",u))&&(_=i.slice(0,b),i=i.slice(b+1),this.auth=decodeURIComponent(_)),u=-1;for(var h,c=0;c<B.length;c++){-1!==(h=i.indexOf(B[c]))&&(-1===u||h<u)&&(u=h)}-1===u&&(u=i.length),this.host=i.slice(0,u),i=i.slice(u),this.parseHost(),this.hostname=this.hostname||"";var d="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!d)for(var f=this.hostname.split(/\./),c=0,l=f.length;c<l;c++){var p=f[c];if(p&&!p.match(L)){for(var m="",g=0,v=p.length;g<v;g++)127<p.charCodeAt(g)?m+="x":m+=p[g];if(!m.match(L)){var y=f.slice(0,c),E=f.slice(c+1),S=p.match(R);S&&(y.push(S[1]),E.unshift(S[2])),E.length&&(i="/"+E.join(".")+i),this.hostname=y.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),d||(this.hostname=k.toASCII(this.hostname));var b=this.port?":"+this.port:"",_=this.hostname||"";this.host=_+b,this.href+=this.host,d&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!U[M])for(c=0,l=P.length;c<l;c++){var w,T=P[c];-1!==i.indexOf(T)&&((w=encodeURIComponent(T))===T&&(w=escape(T)),i=i.split(T).join(w))}d=i.indexOf("#");-1!==d&&(this.hash=i.substr(d),i=i.slice(0,d));var M,d=i.indexOf("?");return-1!==d?(this.search=i.substr(d),this.query=i.substr(d+1),t&&(this.query=N.parse(this.query)),i=i.slice(0,d)):t&&(this.search="",this.query={}),i&&(this.pathname=i),x[M]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(b=this.pathname||"",M=this.search||"",this.path=b+M),this.href=this.format(),this},b.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",o=this.hash||"",n=!1,i="";this.host?n=e+this.host:this.hostname&&(n=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&O.isObject(this.query)&&Object.keys(this.query).length&&(i=N.stringify(this.query));i=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||x[t])&&!1!==n?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n=n||"",o&&"#"!==o.charAt(0)&&(o="#"+o),i&&"?"!==i.charAt(0)&&(i="?"+i),t+n+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(i=i.replace("#","%23"))+o},b.prototype.resolve=function(e){return this.resolveObject(n(e,!1,!0)).format()},b.prototype.resolveObject=function(e){O.isString(e)&&((l=new b).parse(e,!1,!0),e=l);for(var t=new b,r=Object.keys(this),o=0;o<r.length;o++){var n=r[o];t[n]=this[n]}if(t.hash=e.hash,""===e.href)return t.href=t.format(),t;if(e.slashes&&!e.protocol){for(var i=Object.keys(e),s=0;s<i.length;s++){var a=i[s];"protocol"!==a&&(t[a]=e[a])}return x[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(e.protocol&&e.protocol!==t.protocol){if(!x[e.protocol]){for(var u=Object.keys(e),c=0;c<u.length;c++){var h=u[c];t[h]=e[h]}return t.href=t.format(),t}if(t.protocol=e.protocol,e.host||j[e.protocol])t.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),t.pathname=d.join("/")}return t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(p=t.pathname||"",m=t.search||"",t.path=p+m),t.slashes=t.slashes||e.slashes,t.href=t.format(),t}var f=t.pathname&&"/"===t.pathname.charAt(0),l=e.host||e.pathname&&"/"===e.pathname.charAt(0),p=l||f||t.host&&e.pathname,m=p,g=t.pathname&&t.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],f=t.protocol&&!x[t.protocol];if(f&&(t.hostname="",t.port=null,t.host&&(""===g[0]?g[0]=t.host:g.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),p=p&&(""===d[0]||""===g[0])),l)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,g=d;else if(d.length)(g=g||[]).pop(),g=g.concat(d),t.search=e.search,t.query=e.query;else if(!O.isNullOrUndefined(e.search)){return f&&(t.hostname=t.host=g.shift(),(S=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=S.shift(),t.host=t.hostname=S.shift())),t.search=e.search,t.query=e.query,O.isNull(t.pathname)&&O.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t}if(!g.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var v=g.slice(-1)[0],l=(t.host||e.host||1<g.length)&&("."===v||".."===v)||""===v,y=0,E=g.length;0<=E;E--)"."===(v=g[E])?g.splice(E,1):".."===v?(g.splice(E,1),y++):y&&(g.splice(E,1),y--);if(!p&&!m)for(;y--;)g.unshift("..");!p||""===g[0]||g[0]&&"/"===g[0].charAt(0)||g.unshift(""),l&&"/"!==g.join("/").substr(-1)&&g.push("");var S,l=""===g[0]||g[0]&&"/"===g[0].charAt(0);return f&&(t.hostname=t.host=!l&&g.length?g.shift():"",(S=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=S.shift(),t.host=t.hostname=S.shift())),(p=p||t.host&&g.length)&&!l&&g.unshift(""),g.length?t.pathname=g.join("/"):(t.pathname=null,t.path=null),O.isNull(t.pathname)&&O.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes,t.href=t.format(),t},b.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,P,B){(function(l,m){var g;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(){P&&P.nodeType,l&&l.nodeType;var e="object"==typeof m&&m;e.global!==e&&e.window!==e&&e.self;var t,v=2147483647,y=36,E=1,S=26,n=38,i=700,b=72,_=128,w="-",r=/^xn--/,o=/[^\x20-\x7E]/,s=/[\x2E\u3002\uFF0E\uFF61]/g,a={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},u=y-E,T=Math.floor,M=String.fromCharCode;function k(e){throw new RangeError(a[e])}function c(e,t){for(var r=e.length,o=[];r--;)o[r]=t(e[r]);return o}function h(e,t){var r=e.split("@"),o="";return 1<r.length&&(o=r[0]+"@",e=r[1]),o+c((e=e.replace(s,".")).split("."),t).join(".")}function O(e){for(var t,r,o=[],n=0,i=e.length;n<i;)55296<=(t=e.charCodeAt(n++))&&t<=56319&&n<i?56320==(64512&(r=e.charCodeAt(n++)))?o.push(((1023&t)<<10)+(1023&r)+65536):(o.push(t),n--):o.push(t);return o}function p(e){return c(e,function(e){var t="";return 65535<e&&(t+=M((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=M(e)}).join("")}function A(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function I(e,t,r){var o=0;for(e=r?T(e/i):e>>1,e+=T(e/t);u*S>>1<e;o+=y)e=T(e/u);return T(o+(u+1)*e/(e+n))}function d(e){var t,r,o,n,i,s,a,u=[],c=e.length,h=0,d=_,f=b,l=e.lastIndexOf(w);for(l<0&&(l=0),r=0;r<l;++r)128<=e.charCodeAt(r)&&k("not-basic"),u.push(e.charCodeAt(r));for(o=0<l?l+1:0;o<c;){for(n=h,i=1,s=y;c<=o&&k("invalid-input"),a=e.charCodeAt(o++),(y<=(a=a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:y)||a>T((v-h)/i))&&k("overflow"),h+=a*i,!(a<(a=s<=f?E:f+S<=s?S:s-f));s+=y)i>T(v/(a=y-a))&&k("overflow"),i*=a;f=I(h-n,t=u.length+1,0==n),T(h/t)>v-d&&k("overflow"),d+=T(h/t),h%=t,u.splice(h++,0,d)}return p(u)}function f(e){for(var t,r,o,n,i,s,a,u,c,h,d,f=[],l=(e=O(e)).length,p=_,m=b,g=t=0;g<l;++g)(u=e[g])<128&&f.push(M(u));for(r=o=f.length,o&&f.push(w);r<l;){for(n=v,g=0;g<l;++g)p<=(u=e[g])&&u<n&&(n=u);for(n-p>T((v-t)/(c=r+1))&&k("overflow"),t+=(n-p)*c,p=n,g=0;g<l;++g)if((u=e[g])<p&&++t>v&&k("overflow"),u==p){for(i=t,s=y;!(i<(a=s<=m?E:m+S<=s?S:s-m));s+=y)d=i-a,h=y-a,f.push(M(A(a+d%h,0))),i=T(d/h);f.push(M(A(i,0))),m=I(t,c,r==o),t=0,++r}++t,++p}return f.join("")}t={version:"1.4.1",ucs2:{decode:O,encode:p},decode:d,encode:f,toASCII:function(e){return h(e,function(e){return o.test(e)?"xn--"+f(e):e})},toUnicode:function(e){return h(e,function(e){return r.test(e)?d(e.slice(4).toLowerCase()):e})}},void 0===(g=function(){return t}.call(P,B,P,l))||(l.exports=g)}()}).call(this,B(46)(e),B(47))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,r){"use strict";t.decode=t.parse=r(50),t.encode=t.stringify=r(51)},function(e,t,r){"use strict";e.exports=function(e,t,r,o){t=t||"&",r=r||"=";var n={};if("string"!=typeof e||0===e.length)return n;var i=/\+/g;e=e.split(t);t=1e3;o&&"number"==typeof o.maxKeys&&(t=o.maxKeys);var s=e.length;0<t&&t<s&&(s=t);for(var a=0;a<s;++a){var u,c=e[a].replace(i,"%20"),h=c.indexOf(r),d=0<=h?(u=c.substr(0,h),c.substr(h+1)):(u=c,""),f=decodeURIComponent(u),h=decodeURIComponent(d);c=n,d=f,Object.prototype.hasOwnProperty.call(c,d)?l(n[f])?n[f].push(h):n[f]=[n[f],h]:n[f]=h}return n};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";function i(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}e.exports=function(r,o,n,e){return o=o||"&",n=n||"=",null===r&&(r=void 0),"object"==typeof r?a(u(r),function(e){var t=encodeURIComponent(i(e))+n;return s(r[e])?a(r[e],function(e){return t+encodeURIComponent(i(e))}).join(o):t+encodeURIComponent(i(r[e]))}).join(o):e?encodeURIComponent(i(e))+n+encodeURIComponent(i(r)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var r=[],o=0;o<e.length;o++)r.push(t(e[o],o));return r}var u=Object.keys||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(13),d=r(3),i=r(14),s=r(6);var a="segments",r=(n.prototype.init=function(e){e=0<arguments.length&&void 0!==e?e:{};this.flushRange=[],this.appended=0,this.mediaSource=e.mediaSource,this.segmentsVideo=[],this.segmentsAudio=[],this.sourceBuffer={},this.audioBufferSize=0,this.videoBufferSize=0},n.prototype.setMediaSource=function(e){this.mediaSource=e},n.prototype.createSourceBuffers=function(e){var o=this,n=this.sourceBuffer;e.tracks.forEach(function(e){var t=e.content===i.VIDEO,r=t?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"';n[e.content]=o.mediaSource.addSourceBuffer(r),n[e.content].mode=a,n[e.content].timestampOffset=.25;e=n[e.content];t?e.addEventListener(s.BUFFER_UPDATE_END,o.onSBUpdateEnd):e.addEventListener(s.BUFFER_UPDATE_END,o.onAudioSBUpdateEnd)})},n.prototype.onSBUpdateEnd=function(){var e,t;this._needsFlush&&(d.logger.log("flushing buffer"),this.doFlush()),this._needsEos&&this.checkEos(),this._needsFlush||!this.segmentsVideo.length||(e=this.sourceBuffer.video)&&(e.updating||(t=this.segmentsVideo[0],e.appendBuffer(t.data),this.segmentsVideo.shift(),this.videoBufferSize=this.videoBufferSize-t.data.byteLength,this.appended++))},n.prototype.onAudioSBUpdateEnd=function(){var e,t;this._needsFlush&&(d.logger.log("flushing buffer"),this.doFlush()),this._needsEos&&this.checkEos(),this._needsFlush||!this.segmentsAudio.length||(e=this.sourceBuffer.audio)&&(e.updating||(t=this.segmentsAudio[0],e.appendBuffer(t.data),this.segmentsAudio.shift(),this.audioBufferSize=this.audioBufferSize-t.data.byteLength,this.appended++))},n.prototype.createTracks=function(e){var r=this;e.forEach(function(e){var t=(0,o.base64ToArrayBuffer)(e.payload),t={type:r.getTypeBytrackId(e.id),isInit:!0,data:t};r.maybeAppend(t)})},n.prototype.maybeAppend=function(e){if(!this._needsFlush){if(!this.media||this.media.error)return"audio"===e.type?this.segmentsAudio=[]:this.segmentsVideo=[],d.logger.error("trying to append although a media error occured, flush segment and abort"),void(this.media.error&&d.logger.error("Error code:",this.media.error));var t=this.sourceBuffer[e.type];t&&(t.updating||(t.appendBuffer(e.data),("audio"===e.type?this.segmentsAudio:this.segmentsVideo).shift(),this.appended++))}},n.prototype.setTracksByType=function(e){var r=this,t=e.tracks?"tracks":"streams";1===e[t].length&&(this.audioTrackId=null),e[t].forEach(function(e,t){r[e.content===i.VIDEO?"videoTrackId":"audioTrackId"]={index:t,id:e.id}})},n.prototype.getTypeBytrackId=function(e){return this.audioTrackId&&this.audioTrackId.id===e?i.AUDIO:i.VIDEO},n.prototype.procArrayBuffer=function(e){e=this.rawDataToSegmnet(e);"audio"===e.type?(this.segmentsAudio.push(e),this.audioBufferSize=this.audioBufferSize+e.data.byteLength):(this.segmentsVideo.push(e),this.videoBufferSize=this.videoBufferSize+e.data.byteLength),this.doArrayBuffer(e),this.sourceBuffer&&(this.sourceBuffer.video&&!this.sourceBuffer.video.updating&&this.onSBUpdateEnd(),this.audioTrackId&&this.sourceBuffer.audio&&!this.sourceBuffer.audio.updating&&this.onAudioSBUpdateEnd())},n.prototype.seek=function(){for(var e in this.sourceBuffer)this.sourceBuffer[e].abort(),this.sourceBuffer[e].mode=a,this.sourceBuffer[e].timestampOffset=this.sourceBuffer[e].timestampOffset-.2},n.prototype.isBuffered=function(){var e,t=0,r=this.sourceBuffer;for(e in r)t+=r[e].buffered.length;return 0<t},n.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var o in r)t+=r[o].buffered.length}catch(e){console.error("error while accessing sourceBuffer.buffered")}this.appended=t,this._setTracksFlag=!1}},n.prototype.flushBuffer=function(e,t,r){var o,n,i=void 0,s=void 0,a=void 0,u=void 0,c=this.sourceBuffer;if(Object.keys(c).length){if(d.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var h in c)if(!r||h===r){if((i=c[h]).ended=!1,i.updating)return d.logger.warn("cannot flush, sb updating in progress"),!1;try{for(s=0;s<i.buffered.length;s++)if(o=i.buffered.start(s),n=i.buffered.end(s),u=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,t):(a=Math.max(o,e),Math.min(n,t)),.5<Math.min(u,n)-a)return this.flushBufferCounter++,d.logger.log("flush "+h+" ["+a+","+u+"], of ["+o+","+n+"], pos:"+this.media.currentTime),i.remove(a,u),!1}catch(e){d.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else d.logger.warn("abort flushing too many retries");d.logger.log("buffer flushed")}return!0},n.prototype.rawDataToSegmnet=function(e){var t=new Uint8Array(e),e=(0,o.getTrackId)(t);return{type:this.getTypeBytrackId(e),data:t}},n.prototype.onBufferEos=function(e){var t,e=0<arguments.length&&void 0!==e?e:{},r=this.sourceBuffer,o=e.type;for(t in r)o&&t!==o||r[t].ended||(r[t].ended=!0,d.logger.log(t+" sourceBuffer now EOS"));this.checkEos()},n.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e){var o=e[r];if(!o.ended)return;if(o.updating)return void(this._needsEos=!0)}d.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){d.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},n.prototype.addSourceBuffer=function(e){var t=0<arguments.length&&void 0!==e?e:"audio",r=this.sourceBuffer,e="video"===t?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"';r[t]=this.mediaSource.addSourceBuffer(e),r[t].mode=a;r=r[t];"video"===t?r.addEventListener(s.BUFFER_UPDATE_END,this.onSBUpdateEnd):r.addEventListener(s.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd)},n.prototype.removeSourceBuffer=function(e){var t=0<arguments.length&&void 0!==e?e:"audio",e=this.sourceBuffer[t];"audio"===t?e.removeEventListener(s.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd):e.removeEventListener(s.BUFFER_UPDATE_END,this.onSBUpdateEnd),this.mediaSource.removeSourceBuffer(e),delete this.sourceBuffer[t]},n.prototype.destroy=function(){this.init()},n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),d.logger.log("create BuffersController"),this.media=e.media,this.init(e),this.doArrayBuffer=o.doArrayBuffer.bind(this),this.maybeAppend=this.maybeAppend.bind(this),this.onSBUpdateEnd=this.onSBUpdateEnd.bind(this),this.onAudioSBUpdateEnd=this.onAudioSBUpdateEnd.bind(this)}t.default=r,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EVENT_SEGMENT="event",t.MSE_INIT_SEGMENT="mse_init_segment",t.MSE_MEDIA_SEGMENT="mse_media_segment"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={NOT_HTML_MEDIA_ELEMENT:"media should be an HTMLMediaElement instance"},e.exports=t.default}],n.c=o,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15);function n(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var r,o});