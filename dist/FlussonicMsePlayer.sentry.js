!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FlussonicMsePlayer=t():e.FlussonicMsePlayer=t()}(window,function(){return function(u){function e(e){for(var t,r,o=e[0],n=e[1],i=e[2],s=0,a=[];s<o.length;s++)r=o[s],Object.prototype.hasOwnProperty.call(h,r)&&h[r]&&a.push(h[r][0]),h[r]=0;for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(u[t]=n[t]);for(d&&d(e);a.length;)a.shift()();return l.push.apply(l,i||[]),c()}function c(){for(var e,t=0;t<l.length;t++){for(var r=l[t],o=!0,n=1;n<r.length;n++){var i=r[n];0!==h[i]&&(o=!1)}o&&(l.splice(t--,1),e=s(s.s=r[0]))}return e}var r={},h={0:0},l=[];function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return u[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=u,s.c=r,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(r,o,function(e){return t[e]}.bind(null,o));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var t=(o=window.webpackJsonpFlussonicMsePlayer=window.webpackJsonpFlussonicMsePlayer||[]).push.bind(o);o.push=e;for(var o=o.slice(),n=0;n<o.length;n++)e(o[n]);var d=t;return l.push([37,1]),c()}([,function(k,j,e){!function(e){var o,n,i,s,a,u,c,h,l,d,f,p,m,y,g,v,b,S,_,E,w,T,O,M;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */!function(){var t="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function r(r,o){return r!==t&&("function"==typeof Object.create?Object.defineProperty(r,"__esModule",{value:!0}):r.__esModule=!0),function(e,t){return r[e]=o?o(e,t):t}}void 0===(o=function(e){var o;e=r(t,r(e)),o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n=function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},s=function(e,t){var r={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r},a=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(s=(i<3?n(s):3<i?n(t,r,s):n(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},u=function(r,o){return function(e,t){o(e,t,r)}},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e,s,a,u){return new(a=a||Promise)(function(r,t){function o(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(o,n)}i((u=u.apply(e,s||[])).next())})},l=function(r,o){var n,i,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=o.call(r,a)}catch(e){t=[6,e],i=0}finally{n=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},M=function(e,t,r,o){e[o=void 0===o?r:o]=t[r]},d=function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])},f=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&o>=e.length?void 0:e)&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)s.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s},m=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},y=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var o=Array(e),n=0,t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,n++)o[n]=i[s];return o},g=function(e){return this instanceof g?(this.v=e,this):new g(e)},v=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i=[],s={};return o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(o){n[o]&&(s[o]=function(r){return new Promise(function(e,t){1<i.push([o,r,e,t])||a(o,r)})})}function a(e,t){try{(r=n[e](t)).value instanceof g?Promise.resolve(r.value.v).then(u,c):h(i[0][2],r)}catch(e){h(i[0][3],e)}var r}function u(e){a("next",e)}function c(e){a("throw",e)}function h(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}},b=function(o){var n,e={};return t("next"),t("throw",function(e){throw e}),t("return"),e[Symbol.iterator]=function(){return this},e;function t(t,r){e[t]=o[t]?function(e){return(n=!n)?{value:g(o[t](e)),done:"return"===t}:r?r(e):e}:r}},S=function(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=s[Symbol.asyncIterator];return t?t.call(s):(s=f(s),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=s[i]&&function(n){return new Promise(function(e,t){var r,o;n=s[i](n),r=e,e=t,o=n.done,t=n.value,Promise.resolve(t).then(function(e){r({value:e,done:o})},e)})}}},_=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},E=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},w=function(e){return e&&e.__esModule?e:{default:e}},T=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},O=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},e("__extends",n),e("__assign",i),e("__rest",s),e("__decorate",a),e("__param",u),e("__metadata",c),e("__awaiter",h),e("__generator",l),e("__exportStar",d),e("__createBinding",M),e("__values",f),e("__read",p),e("__spread",m),e("__spreadArrays",y),e("__await",g),e("__asyncGenerator",v),e("__asyncDelegator",b),e("__asyncValues",S),e("__makeTemplateObject",_),e("__importStar",E),e("__importDefault",w),e("__classPrivateFieldGet",T),e("__classPrivateFieldSet",O)}.apply(j,[j]))||(k.exports=o)}()}.call(this,e(8))},,,,,,,function(e,t){var r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.enableLogs=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=r(49);function n(){}var i={trace:n,debug:n,log:n,warn:n,info:n,error:n},s=i;var a=(0,r.getSelfScope)();function u(i){var s=a.console[i];return s?function(){for(var e,t,r=arguments.length,o=Array(r),n=0;n<r;n++)o[n]=arguments[n];o[0]&&(o[0]=(e=i,t=o[0],t="["+e+"] > "+t)),o&&s.apply(a.console,o)}:n}t.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":o(e))){!function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];r.forEach(function(e){s[e]=t[e]?t[e].bind(t):u(e)})}(e,"trace","debug","log","info","warn","error");try{s.log()}catch(e){s=i}}else s=i},t.logger=s},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},,,,,,,,,,function(e,t,r){"use strict";e.exports=function(t,r,o,n){var i,s=self||window;try{try{try{i=new s.Blob([t])}catch(e){(i=new(s.BlobBuilder||s.WebKitBlobBuilder||s.MozBlobBuilder||s.MSBlobBuilder)).append(t),i=i.getBlob()}var e=s.URL||s.webkitURL,a=e.createObjectURL(i),u=new s[r](a,o);return e.revokeObjectURL(a),u}catch(e){return new s[r]("data:application/javascript,".concat(encodeURIComponent(t)),o)}}catch(e){if(!n)throw Error("Inline worker is not supported");return new s[r](n,o)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorMsg=t.replaceHttpByWS=t.checkVideoProgress=void 0,t.getMediaSource=o,t.isAndroid=n,t.isSupportedMSE=function(){if(n())return!1;var e=o(),t=window.SourceBuffer||window.WebKitSourceBuffer,e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.4d401f,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!e&&!!t},t.base64ToArrayBuffer=function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})},t.RawDataToUint8Array=function(e){return new Uint8Array(e)},t.getTrackId=i,t.getRealUtcFromData=s,t.doArrayBuffer=function(e){e.isInit||(this.utc=s(e.data),this.lastLoadedUTC=this.utc)},t.debugData=a,t.pad2=c,t.humanTime=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(!(0<e))return"";var r=e,o=new Date;o.setTime(1e3*r);e=!(!1===t),r=e?o.getHours():o.getUTCHours(),t=e?o.getMinutes():o.getUTCMinutes(),o=e?o.getSeconds():o.getUTCSeconds();return c(r)+":"+c(t)+":"+c(o)},t.logDM=function(e,t){t&&y.logger.log("%c "+t.type+" "+("event"===t.type?t.event:"mse_init_segment"),"background: aquamarine;",t)},t.showDispatchError=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";"data"in e&&e.data instanceof ArrayBuffer&&y.logger.error("Data:",a(e.data));y.logger.error(u(e),t),this.media&&"error"in this.media&&y.logger.error("MediaError:",this.media.error);++h>=this.opts.errorsBeforeStop&&(h=0,this.stopPromise=this.stop());this.onError&&this.onError(t,e)};var y=r(9);function o(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function n(){return-1!==navigator.userAgent.indexOf("Android")}function i(e){return e[47]}function s(e){return(e[92]<<24|e[93]<<16|e[94]<<8|e[95])+(e[96]<<24|e[97]<<16|e[98]<<8|e[99])/1e6}function a(e){e=new Uint8Array(e);return{trackId:e[47],utc:s(e),view:e}}t.checkVideoProgress=function(p,m){return function(){var e,t,r,o,n,i=p.currentTime,s=p.buffered,a=p.buffered.length;if(m)for(var u=m.sb.sourceBuffer,c=Object.keys(u),h=i-30,l=c.length-1;0<=l;l--){var d=c[l],f=u[d];!f||0<(d=f.buffered).length&&h>d.start(0)&&(function(e,t,r){try{for(var o=0;o<e.buffered.length;o++){var n=e.buffered.start(o),i=e.buffered.end(o),s=Math.max(n,t),a=Math.min(i,r);if(.5<Math.min(a,i)-s)return e.updating||e.remove(s,a)}}catch(e){y.logger.warn("removeBufferRange failed",e)}}(f,0,h),0,0)}m.media.readyState<=2&&2===m.media.networkState?m.onStartStalling():2<m.media.readyState&&m.onEndStalling(),a&&(e=s.end(a-1),t=Math.abs(e-i),m.playerStatsObject&&(m.playerStatsObject.bytes=m.sb.totalBytesCollected,m.playerStatsObject.updated_at=Date.now(),m.playing&&(!m.playbackSegmentStart||(n=m.playerStatsObject.application)&&(r=(o=m.media.getVideoPlaybackQuality()).corruptedVideoFrames,s=o.droppedVideoFrames,o=o.totalVideoFrames,n=n.live_duration,n+=m.playerStatsObject.updated_at-m.playbackSegmentStart,m.addPlayerStat("live_duration",!1,n),m.addPlayerStat("total_video_frames",!1,o),m.addPlayerStat("dropped_video_frames",!1,s),m.addPlayerStat("corrupted_video_frames",!1,r)),m.playbackSegmentStart=m.playerStatsObject.updated_at),m.addStat({updated_at:m.playerStatsObject.updated_at,bytes:m.sb.totalBytesCollected})),t<=m.opts.maxBufferDelay||(y.logger.log("nudge",i,"->",a?e:"-",i-e),p.currentTime=e-.2))}},t.replaceHttpByWS=function(e){return e.replace(/^http/,"ws")};var u=t.errorMsg=function(e){return"Error "+e.name+": "+e.message+"\n"+e.stack};function c(e){return e<=9?"0"+e:""+e}var h=0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VIDEO="video",t.AUDIO="audio"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_SOURCE_SOURCE_OPEN:"sourceopen",MEDIA_SOURCE_SOURCE_ENDED:"sourceended",MEDIA_SOURCE_SOURCE_CLOSE:"sourceclose",MEDIA_ELEMENT_PLAY:"play",MEDIA_ELEMENT_PAUSE:"pause",MEDIA_ELEMENT_PROGRESS:"progress",MEDIA_ELEMENT_EMPTIED:"emptied",MEDIA_ELEMENT_SUSPEND:"suspend",MEDIA_ELEMENT_STALLED:"stalled",MEDIA_ELEMENT_WAITING:"waiting",MEDIA_ELEMENT_RATECHANGE:"ratechange",MEDIA_ELEMENT_PLAYING:"playing",WS_OPEN:"open",WS_MESSAGE:"message",WS_ERROR:"error",WS_CLOSE:"close",BUFFER_UPDATE_END:"updateend",BUFFER_ERROR:"onerror",BUFFER_ABORT:"onabort"},e.exports=t.default},,,,,,,,,,,,,,function(e,t,r){e.exports=r(38)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=r(39),r=(o=n)&&o.__esModule?o:{default:o};t.default=r.default,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,o=arguments[t];for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},r=function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e};function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=m(n(40)),s=m(n(50)),u=m(n(51)),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(n(21)),h=n(9),l=n(52),d=n(22),f=m(n(23)),p=m(n(53));function m(e){return e&&e.__esModule?e:{default:e}}var y=d.VIDEO,g=d.AUDIO,r=(v.replaceHttpByWS=function(e){return c.replaceHttpByWS(e)},v.isSupported=function(){return c.isSupportedMSE()},r(v,null,[{key:"version",get:function(){return"22.6.1"}}]),v.prototype.play=function(e,t){var r=this;if(h.logger.log("[mse-player]: play()"),this.playing)h.logger.log("MSE is already playing");else{if(!this.ws||!this.ws.websocket||this._pause)return this._play(e,t).then(function(){r.playing=!0,r._stop=!1,r.pendingTracks&&(r.setTracks(r.pendingTracks),r.pendingTracks=void 0)}).catch(function(e){r.onPlayerError(e),h.logger.error("[mse-player]: got error on play",e),r.playing=!1});h.logger.log("[mse-player]: websocket already opened")}},v.prototype.stop=function(){var e=this;this.playPromise?(this.onEvent({key:Date.now(),data:{event:"play_stop"}}),this.playerStatsObject.closed_at=Date.now(),this.addStat({closed_at:this.playerStatsObject.closed_at}),this.opts.statsSendEnable&&(this.statsWorkerStarted=!1),this.playPromise.catch(function(){return e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),e._stop?void h.logger.log("[mse-player]: already stopped"):e.onMediaDetaching()}).finally(function(){return e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),e._stop?void h.logger.log("[mse-player]: already stopped"):e.onMediaDetaching()})):h.logger.log("[mse-player]: no playPromise exists, nothing to stop"),this.firstStart=!0,delete this.uuid},v.prototype.pause=function(){if(!function(){return!(!(!this._pause&&this.playing&&this.media&&this.ws&&this.mediaSource)||this.mediaSource&&"open"!==this.mediaSource.readyState||!this.playPromise)}.bind(this)())return h.logger.log("[mse:playback] can not do pause");var e=function(){if(this.ws.pause(),this.media.pause(),this._pause=!0,this.playing=!1,this.addPlayerStat("pause_count"),this.pauseStarted=Date.now(),this.onPause)try{this.onPause()}catch(e){h.logger.error("Error "+e.name+":"+e.message+"\n"+e.stack)}}.bind(this);this.playPromise.then(e,e).catch(e,e)},v.prototype.restart=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]?void 0:this.sb.lastLoadedUTC;this.playing=!1,this.ws.destroy(),this.ws.init(),this.ws.start(this.url,e,this.videoTrack,this.audioTrack),this.addPlayerStat("reconnect_count"),this.onEndStalling()},v.prototype.retryConnection=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.retry>=this.opts.connectionRetries?clearInterval(this.retryConnectionTimer):(h.logger.log("%cconnectionRetry:","background: orange;","Retrying "+(this.retry+1)),this.mediaSource=void 0,this.init(),this.ws.destroy(),this.sb.destroy(),this.play(t,r).then(function(){e.onEndStalling()}),this.retry=this.retry+1)},v.prototype.setTracks=function(e){var r,t,o,n,i=this,s=e;if(this.mediaInfo){if("lowest"===s)s=this.autoTrackSelection(!1);else if("highest"===s)s=this.autoTrackSelection(!0);else if(!Array.isArray(s))return void h.logger.error('tracks should be an Array instance: ["v1", "a1"]');this.playing?(r=this.mediaInfo.streams?"streams":"tracks",t=s.filter(function(t){var e=i.mediaInfo[r].find(function(e){return t===e.track_id});return!!e&&e.content===y}).join(""),(o=s.filter(function(t){var e=i.mediaInfo[r].find(function(e){return t===e.track_id});return e?!!e&&e.content===g:null}).join("")).length||t.length||(h.logger.warn("No such stream tracks! Setting to default parameters"),n=this.getVideoTracks(),(e=this.getAudioTracks()).length?o=e[0].track_id:h.logger.warn("No audio tracks"),n.length?t=n[0].track_id:h.logger.warn("No video tracks")),o.length||(this.sb.sourceBuffer.audio&&this.sb.removeSourceBuffer(),this.media.muted=!0,h.logger.warn("No audio tracks")),t.length&&o.length&&this.mediaSource.sourceBuffers.length<=1&&(this.stop(),this.media.muted=!1,this.play()),this.onStartStalling(),this.ws.setTracks(t,o),this.addPlayerStat("bitrate_change_count"),this.videoTrack=t,this.audioTrack=o,this._setTracksFlag=!0,this.waitForInitFrame=!0):this.pendingTracks=s}else h.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},v.prototype.autoTrackSelection=function(e){if(this.mediaInfo){var t,r,o,n,i,s=this.getVideoTracks(),a=this.getAudioTracks(),u=void 0,c=void 0;e?(r=t=void 0,s[0].bitrate?r="bitrate":s[0].pixel_width&&(r="pixel_width"),t=s[0][r],u=s[0].track_id,s.forEach(function(e){e[r]>t&&(t=e[r],u=e.track_id)}),a.length&&(c=a[0].track_id,a.forEach(function(e){e.sample_rate>t&&(c=e.track_id)}))):(n=o=void 0,s[0].bitrate?n="bitrate":s[0].pixel_width&&(n="pixel_width"),o=s[0][n],u=s[0].track_id,s.forEach(function(e){e[n]<o&&(o=e[n],u=e.track_id)}),a.length&&(i=void 0,i=a[0].sample_rate,c=a[0].track_id,a.forEach(function(e){e.sample_rate<i&&(i=e.sample_rate,c=e.track_id)})));a=[];return u&&u.length&&a.push(u),c&&c.length&&a.push(c),a}h.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},v.prototype._play=function(o,n){var i=this;return this.liveError=!1,new Promise(function(e,t){if(h.logger.log("_play",o,n),i.playing){var r="[mse-player] _play: terminate because already has been playing";return h.logger.log(r),e({message:r})}if(i._pause)return i.ws&&!1===i.ws.opened?(h.logger.log("WebSocket Closed, trying to restart it"),i._pause=!1,void i.restart(!0)):(h.logger.log("WebSocket is in opened state, resuming"),i._pause=!1,i._resume(),!i.pauseStarted||(r=i.playerStatsObject.application)&&(r=r.pause_duration,r+=Date.now()-i.pauseStarted,i.addPlayerStat("pause_duration",!1,r),delete i.pauseStarted),i.playPromise=i.media.play(),h.logger.log("_play: terminate because _paused and should resume"),i.playPromise);if(i.resetStats(),i.playerStatsObject.opened_at=Date.now(),i.uuid=i.generateUUID(),i.addStat({opened_at:i.playerStatsObject.opened_at,id:i.uuid}),i.videoTrack=o,i.audioTrack=n,i._pause=!1,i.mediaSource||i.onAttachMedia({media:i.media}).then(function(){i.onsoa=i._play.bind(i,o,n),i.sb.setMediaSource(i.mediaSource),i.mediaSource.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,i.onsoa),h.logger.warn("mediaSource did not create"),i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t}),i.mediaSource&&"open"!==i.mediaSource.readyState)return h.logger.warn('readyState is not "open", it\'s currently ',i.mediaSource.readyState),i.shouldPlay=!0,i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,void(i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t);new Promise(function(e,t){return!i.media.autoplay||!0===i.media.muted||i.opts.retryMuted?e():!i.onAutoplay||function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod","Safari"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?(i.media.muted=!0,e()):(i.onAutoplay(function(){return i.media.muted=!1,e()}),void t())}).then(function(){i.ws.start(i.url,i.playTime,i.videoTrack,i.audioTrack).then(function(){return i.playPromise=i.media.play(),i.playPromise.then(function(){i.onStartStalling(),i.startProgressTimer(),i.resolveThenMediaSourceOpen&&(i._stop=!1,i.resolveThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0,clearInterval(i.retryConnectionTimer),i.retry=0),i.onEvent({key:Date.now(),data:{event:"play_started"}})}).catch(function(e){h.logger.log("playPromise rejection.",e),i.ws.connectionPromise&&i.ws.connectionPromise.then(function(){return i.ws.destroy()}),i.opts.retryMuted&&0==i.media.muted&&(i.onMuted&&i.onMuted(),i.media.muted=!0,i._play(o,n)),i.onPlayerError({error:"play_promise_reject",err:e}),i.rejectThenMediaSourceOpen&&(i.rejectThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0),i.opts.retryMuted||i.stop(),!i.opts.onCrashTryVideoOnly||(e=i.mediaInfo.activeStreams.video)&&i._play(e)}),i.playPromise})})})},v.prototype.init=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._pause=!1,this.playing=!1,this.shouldPlay=!1,this.audioTrack="",this.videoTrack="",this.endProgressTimer(),e||this.onEvent({key:Date.now(),data:{event:"play_init",userInfo:window.navigator.userAgent,playerInfo:"MSEPlayer"+(v.version?"@"+v.version:"")}})},v.prototype._resume=function(){this.ws.resume(),this.onEvent({key:Date.now(),data:{event:"play_websocket_resume"}})},v.prototype.onMediaDetaching=function(){var e=this;if(this.stopRunning)h.logger.warn("stop is running.");else{if(this.stopRunning=!0,this.handlerMediaDetaching.bind(this),!this.playPromise)return this.handlerMediaDetaching();this.playPromise.catch(function(){return e.handlerMediaDetaching()}).finally(function(){return e.handlerMediaDetaching()})}},v.prototype.handlerMediaDetaching=function(){var r=this;return h.logger.info("media source detaching"),new Promise(function(e,t){if(r.removeMediaSource(),!r.media)return t("no media to detach");r.removeListeners(),r.oncvp=null,r.mediaSource=null,r.init(!0),r.ws.destroy(),r.sb.destroy(),r.media.onemptied=function(){return h.logger.log("[mse-player]: media emptied"),r.stopRunning=!1,r._stop=!0,delete r.playPromise,e()}})},v.prototype.removeMediaSource=function(){var e=this,t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(e){h.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),this.onmso=null,this.onmse=null,this.onmsc=null}function r(){e.media.src="",e.media.load(),e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0)}this.playPromise&&this.playPromise.then(function(){r()}).catch(function(){r()})},v.prototype.onMediaElementEmptied=function(e){return this.onMediaElementEmptied&&this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_EMPTIED,this.onMediaElementEmptied),this._onmee=void 0),e},v.prototype.onAttachMedia=function(e){var t=this;this.media=e.media;e=this.media;if(!(e instanceof HTMLMediaElement))throw new Error(p.default.NOT_HTML_MEDIA_ELEMENT);if(e){var r=this.mediaSource=new MediaSource;if(this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),r.addEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),e.src=URL.createObjectURL(r),this.eventLog=function(e){t.onEvent&&t.onEvent(e)},this.addListeners(),!this.liveError)return new Promise(function(e){t.onmso=t.onMediaSourceOpen.bind(t,e),r.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,t.onmso)});this.player=void 0}},v.prototype.onMediaSourceOpen=function(e){e();e=this.mediaSource;e&&e.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),URL.revokeObjectURL(this.media.src),this.shouldPlay&&(this.shouldPlay=!1,h.logger.info("readyState now is "+this.mediaSource.readyState+", and will be played",this.audioTrack,this.videoTrack),this._play(this.audioTrack,this.videoTrack))},v.prototype.onDisconnect=function(e){this.onEvent({key:Date.now(),data:{event:"play_diconnected"}}),this.opts.onDisconnect&&this.opts.onDisconnect(e)},v.prototype.dispatchMessage=function(e){var t=this;if(!this.stopRunning){this.playerStatsObject.first_byte_at||(this.playerStatsObject.first_byte_at=Date.now(),this.addStat({first_byte_at:this.playerStatsObject.first_byte_at}));var r,o=e.rawData,n=e.parsedData,e=e.isDataAB;try{if(e){if(this.waitForInitFrame)return h.logger.log("old frames");this.sb.procArrayBuffer(o)}if(n&&n.type===l.EVENT_SEGMENT){var i=n[l.EVENT_SEGMENT];switch(h.logger.log("%c "+n.type+" "+("event"===n.type?n.event:"mse_init_segment"),"background: aquamarine;",n),i){case"resumed":this._pause&&!this.playing&&this.onStartStalling(),this.onResume&&this.onResume();break;case"paused":break;case"seeked":case"switched_to_live":if(this.seekValue=void 0,this.opts.onSeeked)try{this.opts.onSeeked()}catch(e){h.logger.error(e)}break;case"recordings_ended":this._eos=!0,this.sb.onBufferEos();break;case"stream_unavailable":"static"in n&&0==n.static?(h.logger.info("Stream is on on demand mode, waiting for init segment"),this.onStartStalling()):(h.logger.warn("do playPromise reject with error"),this.ws.connectionPromise&&this.ws.connectionPromise.then(function(){return t.ws.pause()}),this.liveError||(this.onPlayerError({error:"playPromise reject - stream unavaible"}),this.liveError=!0),this.rejectThenMediaSourceOpen&&(this.rejectThenMediaSourceOpen(),this.resolveThenMediaSourceOpen=void 0,this.rejectThenMediaSourceOpen=void 0),this.playPromise=Promise.reject("stream unavaible"),this.mediaSource.endOfStream());break;case"tracks_switched":break;default:this.opts.onEvent&&this.opts.onEvent({error:"unhandled_event",event:i}),h.logger.warn("unknown type of event",i)}return}if(n&&n.type===l.MSE_INIT_SEGMENT)return this.procInitSegment(o)}catch(e){c.showDispatchError.bind(this)(e);try{this.media.error?(this.onPlayerError({error:"Media error",mediaError:this.media.error}),this.stop()):this.mediaInfo&&this.mediaInfo.activeStreams&&(r=this.mediaInfo.activeStreams,this.setTracks([r.video||"",r.audio||""]))}catch(e){this.ws.pause()}}}},v.prototype.procInitSegment=function(e){var r=this,t=JSON.parse(e);if(t.type!==l.MSE_INIT_SEGMENT)return h.logger.warn("type is not "+l.MSE_INIT_SEGMENT);this.waitForInitFrame&&(this.waitForInitFrame=!1),this.resetTimer&&(clearTimeout(this.resetTimer),this.resetTimer=void 0),this.sb.isBuffered()&&(this.sb.doFlush(),this.sb.seek()),this.sb.setTracksByType(t);var o=a({},t.metadata,{tracks:t.metadata.streams||t.metadata.tracks,streams:t.metadata.streams||t.metadata.tracks}),n=t.metadata.streams;t.metadata.tracks&&(n=t.metadata.tracks);var i={},e=this.sb.videoTrackId&&this.sb.videoTrackId.id-1;if(n[e]&&n[e].track_id){if(n[e].bitrate&&0===n[e].bitrate||0===n[e].height||0===n[e].width)return void this.onPlayerError({error:"Video track error"});i.video=n[e].track_id}var s,e=this.sb.audioTrackId&&this.sb.audioTrackId.id-1;e&&n[e]&&n[e].track_id&&(n[e].bitrate&&0===n[e].bitrate?(this.onPlayerError({error:"Audio track error"}),s=void 0,t.tracks.forEach(function(e,t){e.id===r.sb.audioTrackId.id&&(s=t)}),t.tracks.splice(s,1),this.sb.sourceBuffer.audio&&(this.mediaSource.removeSourceBuffer(this.sb.sourceBuffer.audio),delete this.sb.sourceBuffer.audio)):i.audio=n[e].track_id);o=a({},o,{activeStreams:i,version:v.version});if(this.playerStatsObject.source_id=t.session_id,this.addStat({source_id:this.playerStatsObject.source_id}),this.doMediaInfo(o),h.logger.log("%cprocInitSegment:","background: lightpink;",t),this.onEvent({key:Date.now(),data:a({event:"play_metadata"},o)}),this.mediaSource&&!this.mediaSource.sourceBuffers.length&&(this.sb.setMediaSource(this.mediaSource),this.sb.createSourceBuffers(t)),this.liveError||this.sb.createTracks(t.tracks),this.opts.videoQuality&&this.firstStart){t=void 0;if("lowest"===this.opts.videoQuality?t=this.autoTrackSelection(!1):"highest"===this.opts.videoQuality&&(t=this.autoTrackSelection(!0)),t[0]!==i.video||i.audio&&t[1]!==i.audio)return void this.ws.setTracks(t[0]||"",t[1]||"");this.firstStart=!1}this.opts.preferHQ&&h.logger.info("[MSE]: preferHQ option is depricated. Use videoQuality(lowest/highest) instead"),this.ws.resume()},v.prototype.doMediaInfo=function(e){if(h.logger.log("%cmediaInfo:","background: orange;",e),this.mediaInfo=e,this.onMediaInfo)try{this.onMediaInfo(e)}catch(e){h.logger.error(c.errorMsg(e))}},v.prototype.getVideoTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===y})}},v.prototype.getAudioTracks=function(){if(this.mediaInfo){var e=this.mediaInfo.streams?"streams":"tracks";return this.mediaInfo[e].filter(function(e){return e.content===g})}},v.prototype.immediateLevelSwitchEnd=function(){var e=this,t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,this.previouslyPaused||(this.playPromise=t.play(),this.playPromise.then(function(){e._pause=!1,e.playing=!0})))},v.prototype.onStartStalling=function(){var e=this;this._pause||(this.resetTimer||(this.resetTimer=setTimeout(function(){e.restart()},6e4)),this._stalling||(this.opts.onStartStalling&&this.opts.onStartStalling(),this._stalling=!0,h.logger.log("onStartStalling"),this.playerStatsObject.started_at&&(this.addPlayerStat("stall_count"),this.startStallingTime=Date.now()),this.onEvent({key:Date.now(),data:{event:"play_stalled"}})))},v.prototype.onEndStalling=function(){var e;this._stalling&&(this.opts.onEndStalling&&this.opts.onEndStalling(),this._stalling=!1,h.logger.log("onEndStalling"),clearTimeout(this.resetTimer),this.resetTimer=void 0,!this.startStallingTime||(e=this.playerStatsObject.application)&&(e=e.stall_duration,e+=Date.now()-this.startStallingTime,this.startStallingTime=null,this.addPlayerStat("stall_duration",!1,e)),this.onEvent({key:Date.now(),data:{event:"play_resumed"}}))},v.prototype.startProgressTimer=function(){this.timer=setInterval(this.onTimer.bind(this),this.opts.progressUpdateTime)},v.prototype.endProgressTimer=function(){clearInterval(this.timer),this.timer=void 0},v.prototype.onTimer=function(){if(this._eos)return h.logger.log("nothing to play");if(this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.sb.lastLoadedUTC!==this.utcPrev&&!this._stalling&&(this.utcPrev=this.sb.lastLoadedUTC,this.onProgress))try{this.onProgress(this.sb.lastLoadedUTC)}catch(e){h.logger.error(c.errorMsg(e))}},v.prototype.onMediaSourceEnded=function(){h.logger.log("media source ended");try{this.opts.onEOS&&this.opts.onEOS()}catch(e){h.logger.error("error while proccessing onEOS")}},v.prototype.onMediaSourceClose=function(){h.logger.log("media source closed")},v.prototype.onConnectionRetry=function(){var e=this;this.retryConnectionTimer||this._stop?this.retry>=this.opts.connectionRetries&&clearInterval(this.retryConnectionTimer):this.retry<this.opts.connectionRetries&&(this.retryConnectionTimer=setInterval(function(){return e.retryConnection()},5e3))},v.prototype.loadingIndication=function(e){e=e.type;"playing"===e?(this.playing=!0,this.onEndStalling(),this.playerStatsObject.started_at||(this.playerStatsObject.started_at=Date.now(),this.addStat({started_at:this.playerStatsObject.started_at}))):"waiting"===e&&(this.playing=!1,this.onStartStalling())},v.prototype.onEvent=function(e){this.onEventCallback&&this.onEventCallback(e)},v.prototype.onPlayerError=function(e){this.playerStatsObject&&this.addPlayerStat("error_count"),this.onError&&this.onError(e)},v.prototype.addListeners=function(){this.media&&(this.oncvp=c.checkVideoProgress(this.media,this).bind(this),this.media.addEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),this.media.addEventListener(f.default.MEDIA_ELEMENT_PLAYING,this.loadingIndication.bind(this)),this.media.addEventListener(f.default.MEDIA_ELEMENT_WAITING,this.loadingIndication.bind(this)))},v.prototype.removeListeners=function(){this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),this.media.removeEventListener(f.default.MEDIA_ELEMENT_PLAYING,this.loadingIndication),this.media.removeEventListener(f.default.MEDIA_ELEMENT_WAITING,this.loadingIndication))},v.prototype.generateUUID=function(){var r=(new Date).getTime(),o="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random();return 0<r?(t=(r+t)%16|0,r=Math.floor(r/16)):(t=(o+t)%16|0,o=Math.floor(o/16)),("x"===e?t:3&t|8).toString(16)})},v.prototype.addPlayerStat=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=this.playerStatsObject.application;o&&(r?o[e]=Math.round(r):t&&o[e]++,this.playerStatsObject.application=o,this.addStat({application:o}))},v.prototype.addStat=function(e){this.statsWorker&&this.statsWorker.postMessage({command:"add",commandObj:e})},v.prototype.getStats=function(){return a({},this.playerStatsObject,{id:this.uuid})},v.prototype.onStatsWorkerMessage=function(){this.opts.statsSendEnable&&fetch(this.url+"sessions/"+this.playerStatsObject.source_id,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",body:JSON.stringify(this.getStats())})},v);function v(e,t){var r=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),o.debug&&((0,h.enableLogs)(!0),window.humanTime=c.humanTime),h.logger.info("[mse-player]:",v.version),this.opts=o||{},this.media=e,this.url=t,this.firstStart=!0,this.opts.progressUpdateTime=this.opts.progressUpdateTime||500,this.opts.errorsBeforeStop=this.opts.errorsBeforeStop||1,"number"!=typeof this.opts.errorsBeforeStop||isNaN(this.opts.errorsBeforeStop))throw new Error("invalid errorsBeforeStop param, should be number");if(this.opts.connectionRetries=this.opts.connectionRetries||0,"number"!=typeof this.opts.connectionRetries||isNaN(this.opts.connectionRetries))throw new Error("invalid connectionRetries param, should be number");if(this.opts.wsReconnect=this.opts.wsReconnect||!1,"boolean"!=typeof this.opts.wsReconnect)throw new Error("invalid wsReconnect param, should be boolean");if(this.opts.preferHQ=this.opts.preferHQ||!1,"boolean"!=typeof this.opts.preferHQ)throw new Error("invalid preferHQ param, should be boolean");if(this.opts.onCrashTryVideoOnly=this.opts.onCrashTryVideoOnly||!0,"boolean"!=typeof this.opts.onCrashTryVideoOnly)throw new Error("invalid onCrashTryVideoOnly param, should be boolean");if(this.retry=0,this.retryConnectionTimer,this.opts.retryMuted=this.opts.retryMuted||!1,"boolean"!=typeof this.opts.retryMuted)throw new Error("invalid retryMuted param, should be boolean");this.opts.maxBufferDelay=this.opts.maxBufferDelay||2;t=navigator.userAgent;if((/Edge/.test(t)||/trident.*rv:1\d/i.test(t))&&(this.opts.maxBufferDelay=10),"number"!=typeof this.opts.maxBufferDelay)throw new Error("invalid maxBufferDelay param, should be number");if(this.opts.videoQuality){if("string"!=typeof this.opts.videoQuality)throw new Error("invalid videoQuality param, should be string");if("highest"!==this.opts.videoQuality&&"lowest"!==this.opts.videoQuality)throw new Error("invalid videoQuality param, should be highest or lowest")}try{this.Sentry=n(54)}catch(e){this.noSentry=!0}if(this.opts.sentryConfig=this.opts.sentryConfig||"","string"!=typeof this.opts.sentryConfig)throw new Error("invalid sentryConfig param, should be string");if(this.opts.sentryConfig.length&&!this.noSentry&&(this.Sentry.init({dsn:this.opts.sentryConfig,environment:"production",release:"Mse Player@"+v.version}),document.onerror=function(e){r.Sentry.captureException(e)}),this.opts.statsSendEnable=this.opts.statsSendEnable||!0,"number"!=typeof this.opts.maxBufferDelay)throw new Error("invalid maxBufferDelay param, should be number");if(window.Worker){if(this.statsWorker=new u.default,this.statsWorker.onmessage=this.onStatsWorkerMessage.bind(this),this.opts.statsSendTime){if("number"!=typeof this.opts.statsSendTime)throw new Error("invalid statsSendTime param, should be number");this.statsWorker.postMessage({command:"time",commandObj:1e3*this.opts.statsSendTime})}this.statsWorker.postMessage({command:"start",commandObj:this.url}),this.statsWorkerStarted=!0}this.resetStats=function(){r.playerStatsObject={proto:"mseld",user_agent:navigator.userAgent,bytes:0,application:{application_name:"mseld_player",application_version:v.version,stall_count:0,pause_count:0,error_count:0,reconnect_count:0,bitrate_change_count:0,live_duration:0,stall_duration:0,pause_duration:0,total_video_frames:0,dropped_video_frames:0,corrupted_video_frames:0}},r.addStat(r.playerStatsObject),r.statsWorkerStarted||(r.statsWorker.postMessage({command:"start",commandObj:r.url}),r.statsWorkerStarted=!0)},this.onProgress=o&&o.onProgress,o&&o.onDisconnect?this.onDisconnect=o&&o.onDisconnect:this.onDisconnect=function(e){h.logger.log("[websocket status]:",e)},this.onMediaInfo=o&&o.onMediaInfo,this.onError=o&&o.onError,this.onEventCallback=o&&o.onEvent,this.onAutoplay=o&&o.onAutoplay,this.onMuted=o&&o.onMuted,this.onStats=o&&o.onStats,this.onMessage=o&&o.onMessage,this.onPause=o&&o.onPause,this.onResume=o&&o.onResume,e instanceof HTMLMediaElement&&(e.WebKitPlaysInline=!0,e.controls=!1),this.ws=new i.default({message:this.dispatchMessage.bind(this),closed:this.onDisconnect.bind(this),error:this.onError,wsReconnect:this.opts.wsReconnect}),this.sb=new s.default({media:e}),this.messageTime=Date.now(),this.init()}t.default=r,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWSURL=u;var c=n(r(41)),o=n(r(48)),h=r(9);function n(e){return e&&e.__esModule?e:{default:e}}var l="live",r=(i.prototype.init=function(){this.wsWorker&&delete this.wsWorker,this.opened=!1,this.connectionPromise=void 0,clearTimeout(this.reconnect),this.reconnect=void 0,window.Worker&&(this.wsWorker=new o.default,this.wsWorker.onmessage=this.onWorkerMessage.bind(this))},i.prototype.onWorkerMessage=function(e){var t=e.data;switch(t.command){case"connect":this.open();break;case"close":this.onWSClose(t);break;case"error":this.handleError(t);break;default:this.handleReceiveMessage(t)}},i.prototype.start=function(o,n){var i=this,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";return this.connectionPromise=new Promise(function(e,t){i.socketURL={url:o,time:n,videoTrack:s,audioTack:a};var r=u(o,0,s,a);i.wsWorker.postMessage({command:"start",commandObj:r}),i._openingResolve=e,i._openingReject=t}),this.connectionPromise},i.prototype.open=function(){this.opened||(this.opened=!0,this.paused=!0,this._openingResolve())},i.prototype.send=function(e){this.wsWorker.postMessage({command:"send",commandObj:e})},i.prototype.resume=function(){clearTimeout(this.reconnect),h.logger.log("ws: send resume"),this.send("resume"),this.paused=!1},i.prototype.pause=function(){h.logger.log("ws: send pause"),this.send("pause"),this.paused=!0},i.prototype.seek=function(e){var t=e===l?"":"play_from=";h.logger.log(t+e),this.send(t+e)},i.prototype.setTracks=function(e){this.send("set_tracks="+e+(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null))},i.prototype.sendStats=function(e){e=JSON.stringify(e);this.send(e)},i.prototype.handleReceiveMessage=function(e){this.opts.message(e)},i.prototype.handleError=function(){var e;this.opts.error&&(e=this.opts).error.apply(e,arguments)},i.prototype.onWSClose=function(e){var t,r,o,n,i=this;h.logger.log("WebSocket lost connection with code ",e.code+" and reason: "+e.reason),this.opts.error&&this.opts.error({error:"WebSocket lost connection",err:"WebSocket lost connection with code "+e.code+" and reason: "+e.reason,code:e.code}),this.opts.wsReconnect&&(e.wasClean&&1e3!==e.code&&1006!==e.code?(h.logger.log("Clean websocket stop"),this.destroy()):(t=this.socketURL,r=t.url,o=t.videoTrack,n=t.audioTack,this.reconnect=setTimeout(function(){i.start(r,o,n).then(function(){clearTimeout(i.reconnect)}).catch(function(){i.destroy()})},5e3))),this.opts.closed&&this.opts.closed(e)},i.prototype.destroy=function(){this.wsWorker.postMessage({command:"disconnect"}),clearTimeout(this.reconnect),this.reconnect=void 0,this.init()},i);function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.opts=e,this.init(),this.onwso=this.open.bind(this),this.onwsm=this.handleReceiveMessage.bind(this),this.onwse=this.handleError.bind(this),this.onwsc=this.onWSClose.bind(this)}function u(e,t,r,o){var n=t=l;if(!n&&!r&&!o)return e;var i=(0,c.default)({url:e}),s="";i.query&&(s=i.query.split("&").map(function(e){return e.split("=")}).filter(function(e){return"from"!==e[0]&&"tracks"!==e[0]}).map(function(e){return e.join("=")}).join("&"),h.logger.log(s));var a=i.protocol+"//"+i.host+i.pathname+"?",u=!!r||!!o,e=u&&n&&n!==l?"&":"",i=t===l?"":"from="+Math.floor(n);return a+(u?"tracks="+r+o:"")+e+(i=!t?"":i)+((u||n&&n!==l)&&s?"&":"")+s}t.default=r},function(e,t,r){"use strict";
/*!
 * parseurl
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var r=r(42),s=r.parse,a=r.Url;function o(e){var t=e.url;if(void 0!==t){var r=e._parsedUrl;return i(t,r)?r:((r=n(t))._raw=t,e._parsedUrl=r)}}function n(e){if("string"!=typeof e||47!==e.charCodeAt(0))return s(e);for(var t=e,r=null,o=null,n=1;n<e.length;n++)switch(e.charCodeAt(n)){case 63:null===o&&(t=e.substring(0,n),r=e.substring(n+1),o=e.substring(n));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return s(e)}var i=void 0!==a?new a:{};return i.path=e,i.href=e,i.pathname=t,null!==o&&(i.query=r,i.search=o),i}function i(e,t){return"object"==typeof t&&null!==t&&(void 0===a||t instanceof a)&&t._raw===e}e.exports=o,e.exports.original=function(e){var t=e.originalUrl;if("string"!=typeof t)return o(e);var r=e._parsedOriginalUrl;if(i(t,r))return r;return(r=n(t))._raw=t,e._parsedOriginalUrl=r}},function(e,t,r){"use strict";var M=r(43),k=r(44);function _(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=n,t.resolve=function(e,t){return n(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?n(e,!1,!0).resolveObject(t):t},t.format=function(e){k.isString(e)&&(e=n(e));return e instanceof _?e.format():_.prototype.format.call(e)},t.Url=_;var j=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,P=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,t=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),I=["'"].concat(t),A=["%","/","?",";","#"].concat(I),x=["/","?","#"],B=/^[+a-z0-9A-Z_-]{0,63}$/,D=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,R={javascript:!0,"javascript:":!0},U={javascript:!0,"javascript:":!0},C={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},L=r(45);function n(e,t,r){if(e&&k.isObject(e)&&e instanceof _)return e;var o=new _;return o.parse(e,t,r),o}_.prototype.parse=function(e,t,r){if(!k.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),n=-1!==o&&o<e.indexOf("#")?"?":"#",o=e.split(n);o[0]=o[0].replace(/\\/g,"/");var i=(i=e=o.join(n)).trim();if(!r&&1===e.split("#").length){var s=P.exec(i);if(s)return this.path=i,this.href=i,this.pathname=s[1],s[2]?(this.search=s[2],this.query=t?L.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var a,s=j.exec(i);if(s&&(O=(s=s[0]).toLowerCase(),this.protocol=O,i=i.substr(s.length)),(r||s||i.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(a="//"===i.substr(0,2))||s&&U[s]||(i=i.substr(2),this.slashes=!0)),!U[s]&&(a||s&&!C[s])){for(var u=-1,c=0;c<x.length;c++)-1!==(h=i.indexOf(x[c]))&&(-1===u||h<u)&&(u=h);-1!==(_=-1===u?i.lastIndexOf("@"):i.lastIndexOf("@",u))&&(E=i.slice(0,_),i=i.slice(_+1),this.auth=decodeURIComponent(E));for(var h,u=-1,c=0;c<A.length;c++)-1!==(h=i.indexOf(A[c]))&&(-1===u||h<u)&&(u=h);-1===u&&(u=i.length),this.host=i.slice(0,u),i=i.slice(u),this.parseHost(),this.hostname=this.hostname||"";var l="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!l)for(var d=this.hostname.split(/\./),c=0,f=d.length;c<f;c++){var p=d[c];if(p&&!p.match(B)){for(var m="",y=0,g=p.length;y<g;y++)127<p.charCodeAt(y)?m+="x":m+=p[y];if(!m.match(B)){var v=d.slice(0,c),b=d.slice(c+1),S=p.match(D);S&&(v.push(S[1]),b.unshift(S[2])),b.length&&(i="/"+b.join(".")+i),this.hostname=v.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),l||(this.hostname=M.toASCII(this.hostname));var _=this.port?":"+this.port:"",E=this.hostname||"";this.host=E+_,this.href+=this.host,l&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!R[O])for(c=0,f=I.length;c<f;c++){var w,T=I[c];-1!==i.indexOf(T)&&((w=encodeURIComponent(T))===T&&(w=escape(T)),i=i.split(T).join(w))}l=i.indexOf("#");-1!==l&&(this.hash=i.substr(l),i=i.slice(0,l));var O,l=i.indexOf("?");return-1!==l?(this.search=i.substr(l),this.query=i.substr(l+1),t&&(this.query=L.parse(this.query)),i=i.slice(0,l)):t&&(this.search="",this.query={}),i&&(this.pathname=i),C[O]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(_=this.pathname||"",O=this.search||"",this.path=_+O),this.href=this.format(),this},_.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",o=this.hash||"",n=!1,i="";this.host?n=e+this.host:this.hostname&&(n=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&k.isObject(this.query)&&Object.keys(this.query).length&&(i=L.stringify(this.query));i=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||C[t])&&!1!==n?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n=n||"",o&&"#"!==o.charAt(0)&&(o="#"+o),i&&"?"!==i.charAt(0)&&(i="?"+i),t+n+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(i=i.replace("#","%23"))+o},_.prototype.resolve=function(e){return this.resolveObject(n(e,!1,!0)).format()},_.prototype.resolveObject=function(e){k.isString(e)&&((f=new _).parse(e,!1,!0),e=f);for(var t=new _,r=Object.keys(this),o=0;o<r.length;o++){var n=r[o];t[n]=this[n]}if(t.hash=e.hash,""===e.href)return t.href=t.format(),t;if(e.slashes&&!e.protocol){for(var i=Object.keys(e),s=0;s<i.length;s++){var a=i[s];"protocol"!==a&&(t[a]=e[a])}return C[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(e.protocol&&e.protocol!==t.protocol){if(!C[e.protocol]){for(var u=Object.keys(e),c=0;c<u.length;c++){var h=u[c];t[h]=e[h]}return t.href=t.format(),t}if(t.protocol=e.protocol,e.host||U[e.protocol])t.pathname=e.pathname;else{for(var l=(e.pathname||"").split("/");l.length&&!(e.host=l.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==l[0]&&l.unshift(""),l.length<2&&l.unshift(""),t.pathname=l.join("/")}return t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(p=t.pathname||"",m=t.search||"",t.path=p+m),t.slashes=t.slashes||e.slashes,t.href=t.format(),t}var d=t.pathname&&"/"===t.pathname.charAt(0),f=e.host||e.pathname&&"/"===e.pathname.charAt(0),p=f||d||t.host&&e.pathname,m=p,y=t.pathname&&t.pathname.split("/")||[],l=e.pathname&&e.pathname.split("/")||[],d=t.protocol&&!C[t.protocol];if(d&&(t.hostname="",t.port=null,t.host&&(""===y[0]?y[0]=t.host:y.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===l[0]?l[0]=e.host:l.unshift(e.host)),e.host=null),p=p&&(""===l[0]||""===y[0])),f)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,y=l;else if(l.length)(y=y||[]).pop(),y=y.concat(l),t.search=e.search,t.query=e.query;else if(!k.isNullOrUndefined(e.search))return d&&(t.hostname=t.host=y.shift(),(S=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=S.shift(),t.host=t.hostname=S.shift())),t.search=e.search,t.query=e.query,k.isNull(t.pathname)&&k.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t;if(!y.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var g=y.slice(-1)[0],f=(t.host||e.host||1<y.length)&&("."===g||".."===g)||""===g,v=0,b=y.length;0<=b;b--)"."===(g=y[b])?y.splice(b,1):".."===g?(y.splice(b,1),v++):v&&(y.splice(b,1),v--);if(!p&&!m)for(;v--;)y.unshift("..");!p||""===y[0]||y[0]&&"/"===y[0].charAt(0)||y.unshift(""),f&&"/"!==y.join("/").substr(-1)&&y.push("");var S,f=""===y[0]||y[0]&&"/"===y[0].charAt(0);return d&&(t.hostname=t.host=!f&&y.length?y.shift():"",(S=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=S.shift(),t.host=t.hostname=S.shift())),(p=p||t.host&&y.length)&&!f&&y.unshift(""),y.length?t.pathname=y.join("/"):(t.pathname=null,t.path=null),k.isNull(t.pathname)&&k.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes,t.href=t.format(),t},_.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,M,k){!function(f,m){var O;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(){M&&M.nodeType,f&&f.nodeType;var e="object"==typeof m&&m;e.global!==e&&e.window!==e&&e.self;var t,y=2147483647,g=36,v=26,n=38,i=700,r=/^xn--/,o=/[^\x20-\x7E]/,s=/[\x2E\u3002\uFF0E\uFF61]/g,a={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},u=g-1,b=Math.floor,S=String.fromCharCode;function _(e){throw new RangeError(a[e])}function c(e,t){for(var r=e.length,o=[];r--;)o[r]=t(e[r]);return o}function h(e,t){var r=e.split("@"),o="";return 1<r.length&&(o=r[0]+"@",e=r[1]),o+c((e=e.replace(s,".")).split("."),t).join(".")}function E(e){for(var t,r,o=[],n=0,i=e.length;n<i;)55296<=(t=e.charCodeAt(n++))&&t<=56319&&n<i?56320==(64512&(r=e.charCodeAt(n++)))?o.push(((1023&t)<<10)+(1023&r)+65536):(o.push(t),n--):o.push(t);return o}function p(e){return c(e,function(e){var t="";return 65535<e&&(t+=S((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=S(e)}).join("")}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function T(e,t,r){var o=0;for(e=r?b(e/i):e>>1,e+=b(e/t);u*v>>1<e;o+=g)e=b(e/u);return b(o+(u+1)*e/(e+n))}function l(e){var t,r,o,n,i,s,a,u=[],c=e.length,h=0,l=128,d=72,f=e.lastIndexOf("-");for(f<0&&(f=0),r=0;r<f;++r)128<=e.charCodeAt(r)&&_("not-basic"),u.push(e.charCodeAt(r));for(o=0<f?f+1:0;o<c;){for(n=h,i=1,s=g;c<=o&&_("invalid-input"),a=e.charCodeAt(o++),(g<=(a=a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:g)||a>b((y-h)/i))&&_("overflow"),h+=a*i,!(a<(a=s<=d?1:d+v<=s?v:s-d));s+=g)i>b(y/(a=g-a))&&_("overflow"),i*=a;d=T(h-n,t=u.length+1,0==n),b(h/t)>y-l&&_("overflow"),l+=b(h/t),h%=t,u.splice(h++,0,l)}return p(u)}function d(e){for(var t,r,o,n,i,s,a,u,c,h,l=[],d=(e=E(e)).length,f=128,p=72,m=t=0;m<d;++m)(a=e[m])<128&&l.push(S(a));for(r=o=l.length,o&&l.push("-");r<d;){for(n=y,m=0;m<d;++m)f<=(a=e[m])&&a<n&&(n=a);for(n-f>b((y-t)/(u=r+1))&&_("overflow"),t+=(n-f)*u,f=n,m=0;m<d;++m)if((a=e[m])<f&&++t>y&&_("overflow"),a==f){for(i=t,s=g;!(i<(c=s<=p?1:p+v<=s?v:s-p));s+=g)l.push(S(w(c+(h=i-c)%(c=g-c),0))),i=b(h/c);l.push(S(w(i,0))),p=T(t,u,r==o),t=0,++r}++t,++f}return l.join("")}t={version:"1.4.1",ucs2:{decode:E,encode:p},decode:l,encode:d,toASCII:function(e){return h(e,function(e){return o.test(e)?"xn--"+d(e):e})},toUnicode:function(e){return h(e,function(e){return r.test(e)?l(e.slice(4).toLowerCase()):e})}},void 0===(O=function(){return t}.call(M,k,M,f))||(f.exports=O)}()}.call(this,k(10)(e),k(8))},function(e,t,r){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,r){"use strict";t.decode=t.parse=r(46),t.encode=t.stringify=r(47)},function(e,t,r){"use strict";e.exports=function(e,t,r,o){r=r||"=";var n={};if("string"!=typeof e||0===e.length)return n;var i=/\+/g;e=e.split(t=t||"&");t=1e3;o&&"number"==typeof o.maxKeys&&(t=o.maxKeys);var s=e.length;0<t&&t<s&&(s=t);for(var a=0;a<s;++a){var u,c=e[a].replace(i,"%20"),h=c.indexOf(r),h=0<=h?(u=c.substr(0,h),c.substr(h+1)):(u=c,""),c=decodeURIComponent(u),h=decodeURIComponent(h);Object.prototype.hasOwnProperty.call(n,c)?l(n[c])?n[c].push(h):n[c]=[n[c],h]:n[c]=h}return n};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";function i(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}e.exports=function(r,o,n,e){return o=o||"&",n=n||"=","object"==typeof(r=null===r?void 0:r)?a(u(r),function(e){var t=encodeURIComponent(i(e))+n;return s(r[e])?a(r[e],function(e){return t+encodeURIComponent(i(e))}).join(o):t+encodeURIComponent(i(r[e]))}).join(o):e?encodeURIComponent(i(e))+n+encodeURIComponent(i(r)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var r=[],o=0;o<e.length;o++)r.push(t(e[o],o));return r}var u=Object.keys||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)('!function(t){var o={};function r(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=o,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(n,e){if(1&e&&(n=r(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)r.d(t,o,function(e){return n[e]}.bind(null,o));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="",r(r.s=0)}([function(e,n){!function(){let o=null,r=!1;function a(){self.postMessage({command:"connect",msg:"Connected"})}function s(e){var n=e.data,t=n instanceof ArrayBuffer,e=t?void 0:JSON.parse(n);self.postMessage({rawData:n,parsedData:e,isDataAB:t})}function c(e){e={command:"error",msg:JSON.stringify(e)};self.postMessage(e)}function f(e){var n;r||({code:n,reason:e}=e,self.postMessage({command:"close",data:{code:n,reason:e}}))}self.addEventListener("message",function(e){var n=e.data,t=n.command;"start"===t?(e=n.commandObj,o=new WebSocket(e),o.binaryType="arraybuffer",o.onopen=a,o.onmessage=s,o.onerror=c,o.onclose=f):"disconnect"===t?function(){o&&o.close();r=!0;self.postMessage({command:"disconnect",msg:"Disconnected"})}():"send"===t&&(n=n.commandObj,o.send(n))},!1)}()}]);',"Worker",void 0,r.p+"ws.worker.js")};var o,n=r(20),i=(o=n)&&o.__esModule?o:{default:o};e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(21),l=r(9),i=r(22),s=r(23);var a="segments",r=(n.prototype.init=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.flushRange=[],this.appended=0,this.mediaSource=e.mediaSource,this.segmentsVideo=[],this.segmentsAudio=[],this.sourceBuffer={},this.totalBytesCollected=0},n.prototype.setMediaSource=function(e){this.mediaSource=e},n.prototype.createSourceBuffers=function(e){var o=this,n=this.sourceBuffer;e.tracks.forEach(function(e){var t=e.content===i.VIDEO,r=t?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"';e.mime_type&&(r=e.mime_type),n[e.content]=o.mediaSource.addSourceBuffer(r),n[e.content].mode=a;e=n[e.content];t?e.addEventListener(s.BUFFER_UPDATE_END,o.onSBUpdateEnd):e.addEventListener(s.BUFFER_UPDATE_END,o.onAudioSBUpdateEnd)})},n.prototype.onSBUpdateEnd=function(){var e,t;this._needsEos&&this.checkEos(),this._needsFlush||!this.segmentsVideo.length||(e=this.sourceBuffer.video)&&(e.updating||(t=this.segmentsVideo[0],e.appendBuffer(t.data),this.segmentsVideo.shift(),this.videoBufferSize=this.videoBufferSize-t.data.byteLength,this.appended++))},n.prototype.onAudioSBUpdateEnd=function(){var e,t;this._needsEos&&this.checkEos(),this._needsFlush||!this.segmentsAudio.length||(e=this.sourceBuffer.audio)&&(e.updating||(t=this.segmentsAudio[0],e.appendBuffer(t.data),this.segmentsAudio.shift(),this.appended++))},n.prototype.createTracks=function(e){var r=this;e.forEach(function(e){var t=(0,o.base64ToArrayBuffer)(e.payload),t={type:r.getTypeBytrackId(e.id),isInit:!0,data:t};r.maybeAppend(t)})},n.prototype.maybeAppend=function(e){if(!this._needsFlush){if(!this.media||this.media.error)return"audio"===e.type?this.segmentsAudio=[]:this.segmentsVideo=[],l.logger.error("trying to append although a media error occured, flush segment and abort"),void(this.media.error&&l.logger.error("Error code:",this.media.error));var t=this.sourceBuffer[e.type];t&&(t.updating||(t.appendBuffer(e.data),("audio"===e.type?this.segmentsAudio:this.segmentsVideo).shift(),this.appended++))}},n.prototype.setTracksByType=function(e){var r=this,t=e.tracks?"tracks":"streams";1===e[t].length&&(this.audioTrackId=null),e[t].forEach(function(e,t){r[e.content===i.VIDEO?"videoTrackId":"audioTrackId"]={index:t,id:e.id}})},n.prototype.getTypeBytrackId=function(e){return this.audioTrackId&&this.audioTrackId.id===e?i.AUDIO:i.VIDEO},n.prototype.procArrayBuffer=function(e){e=this.rawDataToSegmnet(e);("audio"===e.type?this.segmentsAudio:this.segmentsVideo).push(e),this.totalBytesCollected=this.totalBytesCollected+e.data.byteLength,this.doArrayBuffer(e),this.sourceBuffer&&(this.sourceBuffer.video&&!this.sourceBuffer.video.updating&&this.onSBUpdateEnd(),this.audioTrackId&&this.sourceBuffer.audio&&!this.sourceBuffer.audio.updating&&this.onAudioSBUpdateEnd())},n.prototype.seek=function(){for(var e in this.sourceBuffer)this.sourceBuffer[e].abort(),this.sourceBuffer[e].mode=a},n.prototype.isBuffered=function(){var e,t=0,r=this.sourceBuffer;for(e in r)t+=r[e].buffered.length;return 0<t},n.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var o in r)t+=r[o].buffered.length}catch(e){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this._setTracksFlag=!1}},n.prototype.flushBuffer=function(e,t,r){var o,n,i=void 0,s=void 0,a=void 0,u=void 0,c=this.sourceBuffer;if(Object.keys(c).length){if(l.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var h in c)if(!r||h===r){if((i=c[h]).ended=!1,i.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;try{for(s=0;s<i.buffered.length;s++)if(o=i.buffered.start(s),n=i.buffered.end(s),u=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,t):(a=Math.max(o,e),Math.min(n,t)),.5<Math.min(u,n)-a)return this.flushBufferCounter++,l.logger.log("flush "+h+" ["+a+","+u+"], of ["+o+","+n+"], pos:"+this.media.currentTime),i.remove(a,u),!1}catch(e){l.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else l.logger.warn("abort flushing too many retries");l.logger.log("buffer flushed")}return!0},n.prototype.rawDataToSegmnet=function(e){var t=new Uint8Array(e),e=(0,o.getTrackId)(t);return{type:this.getTypeBytrackId(e),data:t}},n.prototype.onBufferEos=function(){var e,t=this.sourceBuffer,r=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type;for(e in t)r&&e!==r||t[e].ended||(t[e].ended=!0,l.logger.log(e+" sourceBuffer now EOS"));this.checkEos()},n.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e){r=e[r];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}l.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},n.prototype.addSourceBuffer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"audio",t=this.sourceBuffer;t[e]=this.mediaSource.addSourceBuffer("video"===e?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"'),t[e].mode=a;t=t[e];"video"===e?t.addEventListener(s.BUFFER_UPDATE_END,this.onSBUpdateEnd):t.addEventListener(s.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd)},n.prototype.removeSourceBuffer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"audio",t=this.sourceBuffer[e];"audio"===e?t.removeEventListener(s.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd):t.removeEventListener(s.BUFFER_UPDATE_END,this.onSBUpdateEnd),this.mediaSource.removeSourceBuffer(t),delete this.sourceBuffer[e]},n.prototype.destroy=function(){this.init()},n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),l.logger.log("create BuffersController"),this.media=e.media,this.init(e),this.doArrayBuffer=o.doArrayBuffer.bind(this),this.maybeAppend=this.maybeAppend.bind(this),this.onSBUpdateEnd=this.onSBUpdateEnd.bind(this),this.onAudioSBUpdateEnd=this.onAudioSBUpdateEnd.bind(this)}t.default=r,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)('!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t){!function(){let o=null,a=6e4,c={},i=null;function u(){l(),clearInterval(i)}function l(){var e=c["source_id"];fetch(o+`${e?`/${e}`:""}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",body:JSON.stringify(c)})}self.addEventListener("message",function(e){var t;const{command:n,commandObj:r}=e.data;switch(n){case"start":o=r.replace(/ws:/,"http:").replace(/wss:/,"https:").replace(/mse_ld/,"sessions"),function(){i=this.setInterval(()=>{l()},a)}();break;case"time":t=r,a=t;break;case"stop":u();break;case"add":t=r,c={...c,...t},t.event&&"play_stop"===t.event&&u()}},!1)}()}]);',"Worker",void 0,r.p+"stats.worker.js")};var o,n=r(20),i=(o=n)&&o.__esModule?o:{default:o};e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EVENT_SEGMENT="event",t.MSE_INIT_SEGMENT="mse_init_segment",t.MSE_MEDIA_SEGMENT="mse_media_segment"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={NOT_HTML_MEDIA_ELEMENT:"media should be an HTMLMediaElement instance"},e.exports=t.default},,,,,,,,,,,,,,function(e,t){var r,o,e=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===n||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:n}catch(e){r=n}try{o="function"==typeof clearTimeout?clearTimeout:i}catch(e){o=i}}();var a,u=[],c=!1,h=-1;function l(){c&&a&&(c=!1,a.length?u=a.concat(u):h=-1,u.length&&d())}function d(){if(!c){var e=s(l);c=!0;for(var t=u.length;t;){for(a=u,u=[];++h<t;)a&&a[h].run();h=-1,t=u.length}a=null,c=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===i||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new f(e,t)),1!==u.length||c||s(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=p,e.addListener=p,e.once=p,e.off=p,e.removeListener=p,e.removeAllListeners=p,e.emit=p,e.prependListener=p,e.prependOnceListener=p,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}}])});